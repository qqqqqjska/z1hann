<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>iPhone Simulator</title>
    
    <!-- Âü∫Êú¨ÈÖçÁΩÆ -->
    <meta name="theme-color" content="#000000">
    
    <!-- iOSÂÖ®Â±èÈÖçÁΩÆ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="iPhone Simulator">
    
    <!-- ‰ºòÂåñËßÜÂè£ÈÖçÁΩÆ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- ÂõæÊ†áÈÖçÁΩÆ -->
    <link rel="apple-touch-icon" href="https://i.postimg.cc/7YzrzNvw/IMG-4423.jpg">
    <link rel="apple-touch-icon" sizes="152x152" href="https://i.postimg.cc/7YzrzNvw/IMG-4423.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.postimg.cc/7YzrzNvw/IMG-4423.jpg">
    
    <!-- ÂØπ‰∫éiOS 15+ÔºåÊ∑ªÂä†‰∏ªÈ¢òÈ¢úËâ≤ÈÄÇÈÖç -->
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/chat_tail_style.css">
    <link rel="stylesheet" href="css/forum_style.css">
    <link rel="stylesheet" href="css/lookus_style.css">
</head>
<body>
    <div class="screen-container" id="screen-container">
        <!-- Ê∂àÊÅØÈÄöÁü•Ê®™ÂπÖ -->
        <div id="chat-notification" class="chat-notification-banner hidden" onclick="window.handleNotificationClick()">
            <div class="chat-notification-content">
                <img id="chat-notification-avatar" src="" class="chat-notification-avatar">
                <div class="chat-notification-info">
                    <div id="chat-notification-title" class="chat-notification-title"></div>
                    <div id="chat-notification-message" class="chat-notification-message"></div>
                </div>
            </div>
            <div class="chat-notification-handle"></div>
        </div>

        <!-- LookUS Áä∂ÊÄÅÈÄöÁü•ÂºπÁ™ó -->
        <div id="lookus-notification" class="lookus-notification-banner hidden" onclick="window.handleLookusNotificationClick()">
            <div class="lookus-notification-content">
                <div class="lookus-notification-icon">
                    <i id="lookus-notification-icon" class="fas fa-bell" style="font-size: 20px;"></i>
                </div>
                <div class="lookus-notification-info">
                    <div class="lookus-notification-header">
                        <span class="lookus-notification-app">LookUs</span>
                        <span class="lookus-notification-time" id="lookus-notification-time">Áé∞Âú®</span>
                    </div>
                    <div class="lookus-notification-title" id="lookus-notification-title">Áä∂ÊÄÅÊõ¥Êñ∞</div>
                    <div class="lookus-notification-message" id="lookus-notification-message">ÂØπÊñπÁä∂ÊÄÅÂ∑≤Êõ¥Êñ∞</div>
                </div>
            </div>
            <div class="lookus-notification-handle"></div>
        </div>

        <!-- ÊÄªÁªìÈÄöÁü•Ê®™ÂπÖ -->
        <div id="summary-notification" class="notification-banner hidden">
            <i class="fas fa-spinner fa-spin"></i>
            <span id="summary-notification-text">Ê≠£Âú®ÊÄªÁªì...</span>
        </div>

        <!-- ÂøÉÂ£∞Ê∞îÊ≥° (ÁßªÂà∞Ê≠§Â§Ñ‰ª•Á°Æ‰øùÂ±ÇÁ∫ßÈ´ò‰∫éÊÄªÁªìÈÄöÁü•) -->
        <div id="thought-bubble" class="thought-bubble hidden">
            <div class="thought-content" id="thought-content-text"></div>
        </div>

        <!-- Ë°åÁ®ãÁîüÊàêÈÄöÁü•Ê®™ÂπÖ -->
        <div id="itinerary-notification" class="notification-banner hidden" style="top: 110px;">
            <i class="fas fa-spinner fa-spin"></i>
            <span id="itinerary-notification-text">Ê≠£Âú®ÁîüÊàêË°åÁ®ã...</span>
        </div>

        <!-- Áä∂ÊÄÅÊ†èÊ®°Êãü -->
        <div class="status-bar">
            <div class="time">9:41</div>
            <div class="status-icons">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

       

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content" id="main-content" style="display: block; padding: 0; overflow: hidden; position: relative;">
            <div id="pages-container" class="pages-container">
                <div id="pages-wrapper" class="pages-wrapper">
                    <!-- JS Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê page Âíå grid -->
                </div>
            </div>
            <div id="page-indicators" class="page-indicators"></div>

    <!-- ÁºñËæëÂ∑•ÂÖ∑Ê†èÁ≠â... -->
    <div id="edit-mode-toolbar" class="hidden">
        <button id="add-widget-btn" class="ios-btn-small" style="background:#007AFF;">+</button>
        <button id="save-layout-btn" class="ios-btn-small" style="background:#34C759;">‰øùÂ≠ò</button>

        <button id="exit-edit-btn" class="ios-btn-small">ÈÄÄÂá∫</button>
    </div>
    <input type="file" id="widget-file-input" accept=".json" class="file-input-hidden">
</div>

<!-- 2. „ÄêÂÖ≥ÈîÆÊ≠•È™§„ÄëÁªÑ‰ª∂‰ªìÂ∫ìÔºöÊää‰Ω†ÂéüÊù•ÁöÑÂ§çÊùÇ HTML ‰ª£Á†ÅÂéüÂ∞Å‰∏çÂä®ÁßªÂà∞ËøôÈáå -->
<div id="widget-repository">
    
    <!-- === Èü≥‰πêÂ∞èÁªÑ‰ª∂ (‰ªéÂéüÊù•ÁöÑ .top-section Ââ™ÂàáËøáÊù•) === -->
    <div class="music-widget" id="music-widget">
        <div class="vinyl-wrapper">
            <div class="vinyl-disk" id="vinyl-disk">
                <div class="vinyl-cover" id="vinyl-cover" style="background-image: url('https://api.dicebear.com/7.x/avataaars/svg?seed=Felix');"></div>
            </div>
        </div>
        <div class="music-info">
            <div class="song-title" id="song-title">Happy Together</div>
            <div class="artist-name" id="artist-name">Maximillian</div>
            <div class="lyrics-display" id="lyrics-display">
                So fast, I almost missed it<br>
                I spill another glass of wine
            </div>
            <div class="music-controls-mini">
                <i class="fas fa-play" id="play-icon"></i>
            </div>
        </div>
    </div>

    <!-- === ÊãçÁ´ãÂæóÂ∞èÁªÑ‰ª∂ (‰ªéÂéüÊù•ÁöÑ .left-area Ââ™ÂàáËøáÊù•) === -->
    <div class="polaroid-widget" id="polaroid-widget">
        <!-- Â∫ïÈÉ®ÊãçÁ´ãÂæó -->
        <div class="polaroid-card bottom-card">
            <div class="polaroid-img-container">
                <img src="https://placehold.co/300x300/eee/999?text=Photo" id="polaroid-img-2" alt="Photo">
            </div>
            <div class="polaroid-text" id="polaroid-text-2">ÁæéÂ•ΩÂõûÂøÜ</div>
        </div>
        <!-- È°∂ÈÉ®ÊãçÁ´ãÂæó -->
        <div class="polaroid-card top-card">
            <div class="polaroid-img-container">
                <img src="https://placehold.co/300x300/eee/999?text=Photo" id="polaroid-img-1" alt="Photo">
            </div>
            <div class="polaroid-text" id="polaroid-text-1">ËÆ®ÂéåÂùèÂ§©Ê∞î</div>
            <div class="tape-strip"></div>
        </div>
        <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü -->
        <input type="file" id="polaroid-input-1" accept="image/*" class="file-input-hidden">
        <input type="file" id="polaroid-input-2" accept="image/*" class="file-input-hidden">
    </div>

</div>

<!-- Â∞èÁªÑ‰ª∂Â∫ìÂºπÁ™ó -->
<div id="widget-library-modal" class="widget-library-modal">
    <div class="library-header">
        <h3 style="margin:0;">Â∞èÁªÑ‰ª∂Â∫ì</h3>
        <button id="close-library-btn" class="ios-btn-small" style="background: #e5e5ea; color: #000;">ÂÖ≥Èó≠</button>
    </div>
    
    <div class="library-body">
        
        <!-- Â∑•ÂÖ∑Ê†èÔºöÂØºÂÖ•ÊåâÈíÆ -->
        <div style="margin-bottom: 20px;">
             <button id="import-json-btn" class="ios-btn-block" style="background-color: #007AFF;">
                <i class="fas fa-file-import"></i> ÂØºÂÖ• JSON ÁªÑ‰ª∂ÂåÖ
             </button>
        </div>

        <!-- 1. Á≥ªÁªüÁªÑ‰ª∂ -->
        <div>
            <div class="library-section-title">Á≥ªÁªüÁªÑ‰ª∂</div>
            <div class="library-scroll-row" id="lib-system-row">
                <!-- JS ‰ºöËá™Âä®Âú®ËøôÈáåÁîüÊàêÈü≥‰πêÂíåÊãçÁ´ãÂæóÁöÑÈÄâÈ°π -->
            </div>
        </div>

        <!-- 2. Â∑≤ÂØºÂÖ•ÁöÑÁªÑ‰ª∂ -->
        <div style="margin-top: 20px;">
            <div class="library-section-title">Â∑≤ÂØºÂÖ•</div>
            <div class="library-scroll-row" id="lib-custom-row">
                <div style="color: #888; font-size: 14px; padding: 20px;">ÊöÇÊó†ÂØºÂÖ•ÁöÑÁªÑ‰ª∂</div>
            </div>
        </div>

    </div>
</div>
            <!-- 1. Êñ∞ÁöÑÁΩëÊ†ºÂÆπÂô® (Âíå‰∏äÊ¨°‰∏ÄÊ†∑) -->

            <!-- Â∑¶‰æßÊãçÁ´ãÂæóÂ∞èÁªÑ‰ª∂ -->
           

        <!-- Â∫ïÈÉ®DockÊ†è -->
        <div class="dock-bar">
            <div class="dock-container">
                <div class="app-item dock-item" data-app-id="shopping-app">
                    <div class="app-icon icon-shopping">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <span class="app-label">Ë¥≠Áâ©</span>
                </div>
                <div class="app-item dock-item" data-app-id="forum-app">
                    <div class="app-icon icon-forum">
                        <i class="fas fa-comments"></i>
                    </div>
                    <span class="app-label">ËÆ∫Âùõ</span>
                </div>
                <div class="app-item dock-item" data-app-id="phone-app">
                    <div class="app-icon icon-phone">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <span class="app-label">Êü•ÊâãÊú∫</span>
                </div>
            </div>
        </div>
        
        <!-- Â∫ïÈÉ®Home Indicator -->
        <div class="home-indicator"></div>

        <!-- ËÆæÁΩÆÂÖ®Â±èApp -->
        <div id="settings-app" class="app-screen hidden">
            <div class="app-header">
                <button id="close-settings-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>ËÆæÁΩÆ</h3>
                <div style="width: 60px;"></div>
            </div>
            <div class="app-body">
                <!-- ‰∏ª API ËÆæÁΩÆ -->
                <div class="section-title">‰∏ª API ËÆæÁΩÆ</div>
                
                <!-- È¢ÑËÆæ -->
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>ÈÖçÁΩÆÈ¢ÑËÆæ</label>
                            <div class="input-row full-width">
                                <select id="ai-preset-select">
                                    <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                </select>
                                <button id="save-ai-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                <button id="delete-ai-preset" class="ios-btn-small danger">Âà†Èô§</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API ËØ¶ÊÉÖ -->
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API Âú∞ÂùÄ (Base URL)</label>
                            <input type="text" id="ai-api-url" placeholder="https://api.openai.com/v1">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API ÂØÜÈí• (Key)</label>
                            <input type="password" id="ai-api-key" placeholder="sk-...">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <div class="input-row full-width">
                                <button id="fetch-models" class="ios-btn-block">ÊãâÂèñÊ®°ÂûãÂàóË°®</button>
                            </div>
                            <div class="input-row full-width" style="margin-top: 10px;">
                                <select id="ai-model-select">
                                    <option value="">ËØ∑ÂÖàÊãâÂèñÊ®°Âûã</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <div style="display: flex; justify-content: space-between; width: 100%;">
                                <label>Ê∏©Â∫¶ (Temperature)</label>
                                <span id="ai-temp-value">0.7</span>
                            </div>
                            <input type="range" id="ai-temperature" min="0" max="2" step="0.1" value="0.7" style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Whisper API ËÆæÁΩÆ -->
                <div class="section-title">ËØ≠Èü≥ËΩ¨ÊñáÂ≠ó (Whisper) ËÆæÁΩÆ</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>APIÂú∞ÂùÄ</label>
                            <select id="whisper-connection-mode" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background-color: #f2f2f7;">
                                <option value="custom">Ëá™ÂÆö‰πâÂú∞ÂùÄ</option>
                                <option value="siliconflow">Á°ÖÂü∫ÊµÅÂä® (Êé®Ëçê)</option>
                            </select>
                            <div style="font-size: 12px; color: #999; margin-top: 5px;">
                                ‚ö†Ô∏è Â¶ÇÈÅáCORSÈîôËØØÔºåËØ∑ËÅîÁ≥ªAPIÊèê‰æõÂïÜ‰øÆÂ§çÊúçÂä°Âô®ÈÖçÁΩÆ
                            </div>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API Âú∞ÂùÄ (Base URL)</label>
                            <input type="text" id="whisper-api-url" placeholder="https://api.openai.com/v1">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API ÂØÜÈí• (Key)</label>
                            <input type="password" id="whisper-api-key" placeholder="sk-...">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>Ê®°Âûã (Model)</label>
                            <div class="input-row full-width" style="margin-bottom: 10px;">
                                <button id="fetch-whisper-models" class="ios-btn-block">ÊãâÂèñÊ®°ÂûãÂàóË°®</button>
                            </div>
                            <input type="text" id="whisper-model" placeholder="whisper-1" value="whisper-1">
                            <select id="whisper-model-select" class="hidden" style="margin-top: 10px; width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background-color: #f2f2f7;">
                                <option value="">ÈÄâÊã©Ê®°Âûã...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Minimax TTS ËÆæÁΩÆ -->
                <div class="section-title">ËØ≠Èü≥ÂêàÊàê (Minimax TTS) ÂÖ®Â±ÄÈÖçÁΩÆ</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>Group ID</label>
                            <input type="text" id="minimax-group-id" placeholder="Minimax Group ID">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API Key</label>
                            <input type="password" id="minimax-api-key" placeholder="Minimax API Key">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>Ê®°Âûã (Model)</label>
                            <input type="text" id="minimax-model" placeholder="speech-01-turbo" value="speech-01-turbo" style="margin-bottom: 10px;">
                            <select id="minimax-model-select" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background-color: #f2f2f7;">
                                <option value="">-- Âø´ÈÄüÈÄâÊã©Ê®°Âûã --</option>
                                <option value="speech-01-turbo">speech-01-turbo</option>
                                <option value="speech-01-240228">speech-01-240228</option>
                                <option value="speech-01">speech-01</option>
                                <option value="speech-02">speech-02</option>
                            </select>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content">
                            <span style="font-size: 12px; color: #888;">ÊèêÁ§∫ÔºöÂêØÁî®ÂºÄÂÖ≥ÂíåÈü≥Ëâ≤ËÆæÁΩÆÂ∑≤ÁßªËá≥ÊØè‰∏™ËÅîÁ≥ª‰∫∫ÁöÑ‚ÄúËÅäÂ§©ËØ¶ÊÉÖ‚ÄùÈ°µ„ÄÇ</span>
                        </div>
                    </div>
                </div>

                <!-- È´òÂæ∑Âú∞Âõæ ËÆæÁΩÆ -->
                <div class="section-title">È´òÂæ∑Âú∞Âõæ (LookUS ‰ΩçÁΩÆ)</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API Key (WebÁ´Ø)</label>
                            <input type="password" id="amap-api-key" placeholder="È´òÂæ∑Âú∞Âõæ Key">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>ÂÆâÂÖ®ÂØÜÈí• (Security Code)</label>
                            <input type="password" id="amap-security-code" placeholder="WebÊúçÂä° ÂÆâÂÖ®ÂØÜÈí•">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content">
                            <span style="font-size: 12px; color: #888;">
                                ÊèêÁ§∫ÔºöËØ∑ÂâçÂæÄ <a href="https://console.amap.com/" target="_blank" style="color:#007AFF;">È´òÂæ∑ÊéßÂà∂Âè∞</a> Áî≥ËØ∑ WebÁ´Ø(JS API) Key„ÄÇ<br>
                                Â¶ÇÊûúÈÅáÂà∞Ë∑®ÂüüÈóÆÈ¢òÔºåËØ∑Âä°ÂøÖÂ°´ÂÜôÂÆâÂÖ®ÂØÜÈí•„ÄÇ
                            </span>
                        </div>
                    </div>
                </div>

                <!-- ÂâØ API ËÆæÁΩÆ -->
                <div class="section-title">ÂâØ API ËÆæÁΩÆ</div>
                
                <!-- È¢ÑËÆæ -->
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>ÈÖçÁΩÆÈ¢ÑËÆæ</label>
                            <div class="input-row full-width">
                                <select id="ai-preset-select-2">
                                    <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                </select>
                                <button id="save-ai-preset-2" class="ios-btn-small">‰øùÂ≠ò</button>
                                <button id="delete-ai-preset-2" class="ios-btn-small danger">Âà†Èô§</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API ËØ¶ÊÉÖ -->
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API Âú∞ÂùÄ (Base URL)</label>
                            <input type="text" id="ai-api-url-2" placeholder="https://api.openai.com/v1">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>API ÂØÜÈí• (Key)</label>
                            <input type="password" id="ai-api-key-2" placeholder="sk-...">
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <div class="input-row full-width">
                                <button id="fetch-models-2" class="ios-btn-block">ÊãâÂèñÊ®°ÂûãÂàóË°®</button>
                            </div>
                            <div class="input-row full-width" style="margin-top: 10px;">
                                <select id="ai-model-select-2">
                                    <option value="">ËØ∑ÂÖàÊãâÂèñÊ®°Âûã</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <div style="display: flex; justify-content: space-between; width: 100%;">
                                <label>Ê∏©Â∫¶ (Temperature)</label>
                                <span id="ai-temp-value-2">0.7</span>
                            </div>
                            <input type="range" id="ai-temperature-2" min="0" max="2" step="0.1" value="0.7" style="width: 100%;">
                        </div>
                    </div>
                </div>

                <!-- Á≥ªÁªüËÆæÁΩÆ -->
                <div class="section-title">Á≥ªÁªüËÆæÁΩÆ</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content">
                            <label>ÂêéÂè∞Ê∂àÊÅØÈÄöÁü•</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="system-notification-toggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                <label>ÂêéÂè∞Èü≥È¢ëÊí≠Êîæ</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="background-audio-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div style="font-size: 12px; color: #888; margin-top: 5px;">
                                ÂºÄÂêØÂêéÔºåÈü≥È¢ëÂ∞ÜÂú®ÂêéÂè∞ÁªßÁª≠Êí≠ÊîæÔºå‰ΩÜÂèØËÉΩ‰ºö‰∏≠Êñ≠ÂÖ∂‰ªñÂ∫îÁî®ÁöÑÈü≥È¢ë„ÄÇ
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êï∞ÊçÆÁÆ°ÁêÜ -->
                <div class="section-title">Êï∞ÊçÆÁÆ°ÁêÜ</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <button id="save-all-settings" class="ios-btn-block">‰øùÂ≠òÊâÄÊúâÈÖçÁΩÆ</button>
                    </div>
                    <div class="list-item">
                        <div class="list-content">
                            <label>ÂéãÁº©ÂØºÂá∫ (ZIP)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="export-as-zip" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="button-row full-width">
                            <button id="export-json" class="ios-btn-block secondary">ÂØºÂá∫Êï∞ÊçÆ</button>
                            <label for="import-json" class="ios-btn-block secondary file-label">
                                ÂØºÂÖ•Êï∞ÊçÆ
                                <input type="file" id="import-json" accept=".json,.zip" style="display: none;">
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <button id="optimize-storage" class="ios-btn-block">ÂéãÁº©ÂõæÁâáÊï∞ÊçÆ</button>
                    </div>
                    <div class="list-item">
                        <button id="analyze-storage" class="ios-btn-block">Â≠òÂÇ®Âç†Áî®ÂàÜÊûê</button>
                    </div>
                    <div class="list-item">
                        <button id="clear-all-data" class="ios-btn-block danger">Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ</button>
                    </div>
                </div>
                
                <div style="height: 50px;"></div>
            </div>
        </div>

        <!-- ÂæÆ‰ø°ÂÖ®Â±èApp -->
        <div id="wechat-app" class="app-screen hidden">
            <div class="wechat-header" id="wechat-header">
                <div class="header-left">
                    <button id="wechat-header-left-btn" class="wechat-icon-btn"><i class="fas fa-chevron-left"></i></button>
                    <span id="wechat-header-back-text" style="font-size: 16px; margin-left: -5px; display: none;">ÂæÆ‰ø°</span>
                </div>
                <span class="wechat-title" id="wechat-header-title">ÂæÆ‰ø°</span>
                <div class="header-right">
                    <button id="wechat-header-right-btn" class="wechat-icon-btn"><i class="fas fa-plus"></i></button>
                </div>
            </div>

            <div class="wechat-body" id="wechat-body">
                <!-- Â•ΩÂèãÂàóË°®È°µ -->
                <div id="wechat-tab-contacts" class="wechat-tab-content active">
                    <div class="contacts-custom-header">
                        <div class="contacts-top-bar">
                            <button class="icon-btn" id="contacts-back-btn"><i class="fas fa-bars"></i></button>
                            <div style="flex: 1;"></div>
                            <button class="icon-btn" id="add-contact-btn-custom"><i class="fas fa-search"></i></button>
                        </div>
                        <div class="contacts-title">Message</div>
                        <div class="contacts-group-tabs" id="contacts-group-tabs">
                            <!-- ÂàÜÁªÑÊ†áÁ≠æÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                        </div>
                    </div>
                    <div class="contact-list" id="contact-list">
                        <!-- ËÅîÁ≥ª‰∫∫È°πÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                    </div>
                </div>
                <!-- ÈÄöËÆØÂΩïÈ°µ -->
                <div id="wechat-tab-addressbook" class="wechat-tab-content">
                    <div class="contacts-custom-header">
                        <div class="contacts-top-bar">
                            <button class="icon-btn" style="visibility: hidden;"><i class="fas fa-bars"></i></button>
                            <div style="flex: 1;"></div>
                            <!-- <button class="icon-btn" id="add-contact-btn-addressbook"><i class="fas fa-user-plus"></i></button> -->
                        </div>
                        <div class="contacts-title" id="contacts-title-btn" style="cursor: pointer;">Contacts <i class="fas fa-chevron-right" style="font-size: 14px; color: #ccc; margin-left: 5px;"></i></div>
                    </div>
                    <div id="addressbook-list" class="contact-list">
                        <!-- ËÅîÁ≥ª‰∫∫ÂàóË°®Â∞ÜÈÄöËøáJSÁîüÊàê -->
                    </div>
                </div>
                <!-- Âä®ÊÄÅÈ°µ -->
                <div id="wechat-tab-moments" class="wechat-tab-content">
                    <div id="moments-container" class="moments-container">
                        <!-- ÊúãÂèãÂúàÂ§¥ÈÉ®Â∞ÜÈÄöËøáJSÁîüÊàê -->
                    </div>
                </div>
                <!-- ÊàëÁöÑÈ°µ -->
                <div id="wechat-tab-me" class="wechat-tab-content">
                    <div id="me-profile-container">
                        <!-- ËµÑÊñôÂç°Â∞ÜÈÄöËøáJSÁîüÊàê -->
                    </div>
                    
                    <div class="ios-list-group" style="margin-top: 20px;">
                        <div class="list-item center-content" id="switch-persona-btn">
<span style="color: #000;">ÁÆ°ÁêÜË∫´‰ªΩ</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Â∫ïÊ†è -->
            <div class="wechat-tab-bar">
                <div class="wechat-tab-item active" data-tab="contacts">
                    <i class="fas fa-comment"></i>
                    <span>ÂæÆ‰ø°</span>
                </div>
                <div class="wechat-tab-item" data-tab="addressbook">
                    <i class="fas fa-address-book"></i>
                    <span>ÈÄöËÆØÂΩï</span>
                </div>
                <div class="wechat-tab-item" data-tab="moments">
                    <i class="fas fa-star"></i>
                    <span>Âä®ÊÄÅ</span>
                </div>
                <div class="wechat-tab-item" data-tab="me">
                    <i class="fas fa-user"></i>
                    <span>Êàë</span>
                </div>
            </div>

            <!-- ËÅäÂ§©ËÆæÁΩÆÂÖ®Â±èÈ°µ -->
            <div id="chat-settings-screen" class="sub-screen hidden" style="z-index: 160;">
                <div class="chat-header">
                    <button id="close-chat-settings" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                    <span>ËÅäÂ§©ËØ¶ÊÉÖ</span>
                    <button id="save-chat-settings-btn" class="wechat-icon-btn" style="font-size: 16px; font-weight: 600; color: #07C160; width: auto; padding: 0 10px;">‰øùÂ≠ò</button>
                </div>
                <div class="app-body" style="background-color: var(--bg-color);">
                    <!-- ÂØºËà™Ê†è -->
                    <div class="chat-settings-nav">
                        <div class="nav-item active" data-tab="ai">TA</div>
                        <div class="nav-item" data-tab="user">Êàë</div>
                        <div class="nav-item" data-tab="appearance">Â§ñËßÇ</div>
                        <div class="nav-indicator"></div>
                    </div>

                    <!-- AI Tab -->
                    <div id="chat-setting-tab-ai" class="chat-setting-tab-content active">
                        <!-- AI ËÆæÁΩÆÂç°Áâá -->
                        <div class="ai-setting-card">
                            <!-- ËÉåÊôØÂõæÂå∫Âüü -->
                            <div class="ai-setting-bg" id="ai-setting-bg-container">
                                <input type="file" id="chat-setting-ai-bg-input" accept="image/*" class="file-input-hidden">
                            </div>
                            
                            <!-- Â§¥ÂÉèÂå∫Âüü -->
                            <div class="ai-setting-avatar-container">
                                <input type="file" id="chat-setting-avatar" accept="image/*" class="file-input-hidden">
                                <label for="chat-setting-avatar" class="ai-setting-avatar-wrapper">
                                    <img id="chat-setting-avatar-preview" src="" alt="Avatar">
                                </label>
                            </div>

                            <!-- ÂßìÂêç -->
                            <div class="ai-setting-name-container">
                                <input type="text" id="chat-setting-name" class="ai-setting-name-input" placeholder="ÂßìÂêç">
                            </div>

                            <!-- Â§áÊ≥® -->
                            <div class="ai-setting-remark-container">
                                <input type="text" id="chat-setting-remark" class="ai-setting-remark-input" placeholder="Â§áÊ≥®">
                            </div>

                            <!-- ÂàÜÁªÑ -->
                            <div class="ai-setting-group-container" id="chat-setting-group-trigger">
                                <span id="chat-setting-group-value" class="ai-setting-group-text">Êú™ÂàÜÁªÑ</span>
                                <i class="fas fa-chevron-right" style="font-size: 12px; color: #ccc;"></i>
                            </div>

                            <!-- ‰∫∫ËÆæ -->
                            <div class="ai-setting-persona-container">
                                <textarea id="chat-setting-persona" class="ai-setting-persona-input" placeholder="ËæìÂÖ•‰∫∫ËÆæ..."></textarea>
                            </div>
                        </div>

                        <!-- ÊâÄÂú®‰ΩçÁΩÆ -->
                        <div class="ai-setting-location-container">
                            <div class="ai-setting-location-label">üìç ÊâÄÂú®‰ΩçÁΩÆ</div>
                            <div class="ai-setting-location-selects">
                                <select id="chat-setting-location-country" class="ai-setting-location-select">
                                    <option value="">ÈÄâÊã©ÂõΩÂÆ∂</option>
                                </select>
                                <select id="chat-setting-location-province" class="ai-setting-location-select" disabled>
                                    <option value="">ÈÄâÊã©ÁúÅ‰ªΩ</option>
                                </select>
                                <select id="chat-setting-location-city" class="ai-setting-location-select" disabled>
                                    <option value="">ÈÄâÊã©ÂüéÂ∏Ç</option>
                                </select>
                            </div>
                        </div>

                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>‰∏ä‰∏ãÊñáÊù°Êï∞ÈôêÂà∂ (0‰∏∫‰∏çÈôêÂà∂)</label>
                                    <input type="number" id="chat-setting-context-limit" placeholder="ÈªòËÆ§ÂÖ®ÈÉ®" min="0">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Ëá™Âä®ÊÄªÁªìËß¶ÂèëÊù°Êï∞ (0‰∏∫ÂÖ≥Èó≠)</label>
                                    <input type="number" id="chat-setting-summary-limit" placeholder="ÈªòËÆ§ÂÖ≥Èó≠" min="0">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>‰∏ªÂä®ÂèëÊ∂àÊÅØ</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="chat-setting-active-reply">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>‰∏ªÂä®ÂèëÊ∂àÊÅØÈó¥Èöî (Áßí)</label>
                                    <input type="number" id="chat-setting-active-interval" placeholder="‰æãÂ¶Ç: 60" min="5">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>ÊòæÁ§∫AIÂøÉÂ£∞</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="chat-setting-show-thought">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>AIÂèØÁü•ÊôìÂøÉÂ£∞</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="chat-setting-thought-visible">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>AIÂèØÁü•ÊôìÁúüÂÆûÊó∂Èó¥</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="chat-setting-real-time-visible">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">ËØ≠Èü≥ÂêàÊàê (TTS)</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content">
                                    <label>ÂêØÁî® TTS (Minimax)</label>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="chat-setting-tts-enabled">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Èü≥Ëâ≤ ID (Voice ID)</label>
                                    <input type="text" id="chat-setting-tts-voice-id" placeholder="‰æãÂ¶Ç: male-qn-qingse">
                                    <div style="font-size: 12px; color: #888; margin-top: 5px;">
                                        Â∏∏Áî®: male-qn-qingse (ÈùíÊ∂©), female-shaonv (Â∞ëÂ•≥), male-qn-jingying (Á≤æËã±)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="section-title">ÂÖ≥ËÅî‰∏ñÁïå‰π¶</div>
                        <div class="ios-list-group" id="chat-setting-wb-list">
                            <!-- ‰∏ñÁïå‰π¶ÂàÜÁ±ªÂàóË°®Â∞ÜÈÄöËøáJSÁîüÊàê -->
                        </div>

                        <div class="section-title">ÂÖ≥ËÅîË°®ÊÉÖÂåÖ</div>
                        <div class="ios-list-group" id="chat-setting-sticker-list">
                            <!-- Ë°®ÊÉÖÂåÖÂàÜÁ±ªÂàóË°®Â∞ÜÈÄöËøáJSÁîüÊàê -->
                        </div>

                        <div class="ios-list-group" style="margin-top: 20px;">
                            <div class="list-item">
                                <button id="trigger-ai-moment-btn" class="ios-btn-block secondary">ËÆ©TAÂèëÂä®ÊÄÅ</button>
                            </div>
                        </div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <button id="export-character-btn" class="ios-btn-block secondary">ÂØºÂá∫ËßíËâ≤Êï∞ÊçÆ</button>
                            </div>
                            <div class="list-item">
                                <input type="file" id="import-character-input" accept=".json" class="file-input-hidden">
                                <label for="import-character-input" class="ios-btn-block secondary" style="margin-bottom:0; text-align:center;">ÂØºÂÖ•ËßíËâ≤Êï∞ÊçÆ</label>
                            </div>
                        </div>
                        <div class="ios-list-group">
                            <div class="list-item center-content" id="clear-chat-history-btn">
                                <span class="danger-text">Ê∏ÖÁ©∫ËÅäÂ§©ËÆ∞ÂΩï</span>
                            </div>
                        </div>
                    </div>

                    <!-- User Tab -->
                    <div id="chat-setting-tab-user" class="chat-setting-tab-content">
                        <!-- Áî®Êà∑ËÆæÁΩÆÂç°Áâá -->
                        <div class="ai-setting-card">
                            <!-- ËÉåÊôØÂõæÂå∫Âüü -->
                            <div class="ai-setting-bg" id="user-setting-bg-container" style="background-color: #ccc;">
                                <input type="file" id="chat-setting-user-bg-input" accept="image/*" class="file-input-hidden">
                            </div>
                            
                            <!-- Â§¥ÂÉèÂå∫Âüü -->
                            <div class="ai-setting-avatar-container">
                                <input type="file" id="chat-setting-my-avatar" accept="image/*" class="file-input-hidden">
                                <label for="chat-setting-my-avatar" class="ai-setting-avatar-wrapper">
                                    <img id="chat-setting-my-avatar-preview" src="" alt="Avatar">
                                </label>
                            </div>

                            <!-- Ë∫´‰ªΩÈÄâÊã© -->
                            <div class="ai-setting-name-container">
                                <select id="chat-setting-user-persona" class="ai-setting-name-input" style="background: transparent; border: none; text-align: center; width: auto; min-width: 150px;">
                                    <option value="">-- ÈÄâÊã©Ë∫´‰ªΩ --</option>
                                </select>
                            </div>

                            <!-- ÂàÜÈöîÁ∫ø -->
                            <div style="width: 90%; height: 1px; background-color: #eee; margin: 20px 0;"></div>

                            <!-- TAÁúº‰∏≠ÁöÑÊàë -->
                            <div style="width: 100%; padding: 0 20px;">
                                <div style="font-size: 13px; color: #6d6d72; margin-bottom: 10px; text-align: left; font-weight: 500;">TAÁúº‰∏≠ÁöÑÊàë</div>
                                
                                <!-- ÊòæÁ§∫Ê®°Âºè -->
                                <div id="user-perception-display" style="width: 100%;">
                                    <div id="user-perception-list" style="margin-bottom: 15px; min-height: 20px; text-align: left; max-height: 150px; overflow-y: auto;">
                                        <!-- ÂàóË°®È°πÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                                    </div>
                                    <button id="edit-user-perception-btn" class="ios-btn-block secondary">ÁºñËæë</button>
                                </div>

                                <!-- ÁºñËæëÊ®°Âºè -->
                                <div id="user-perception-edit" class="hidden" style="width: 100%;">
                                    <textarea id="user-perception-input" style="width: 100%; height: 150px; border: 1px solid #ddd; border-radius: 8px; padding: 8px; margin-bottom: 10px; font-family: inherit; background-color: #f9f9f9;" placeholder="ÊØèË°å‰∏ÄÊù°ËÆ§Áü•‰ø°ÊÅØ"></textarea>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="save-user-perception-btn" class="ios-btn-block" style="background-color: #000; color: white; flex: 1;">‰øùÂ≠ò</button>
                                        <button id="cancel-user-perception-btn" class="ios-btn-block" style="background-color: #8e8e93; color: white; flex: 1;">ÂèñÊ∂à</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appearance Tab -->
                    <div id="chat-setting-tab-appearance" class="chat-setting-tab-content">
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <div style="display: flex; justify-content: space-between; width: 100%;">
                                        <label>Â≠ó‰ΩìÂ§ßÂ∞è</label>
                                        <span id="chat-font-size-value">16px</span>
                                    </div>
                                    <input type="range" id="chat-font-size-slider" min="12" max="30" step="1" value="16" style="width: 100%;">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>AIÊ∂àÊÅØÈó¥Èöî (ÊØ´Áßí)</label>
                                    <div style="display: flex; gap: 10px; align-items: center;">
                                        <input type="number" id="chat-setting-interval-min" placeholder="ÊúÄÂ∞è(ÈªòËÆ§400)" style="flex: 1;width: 70%;">
                                        <span>-</span>
                                        <input type="number" id="chat-setting-interval-max" placeholder="ÊúÄÂ§ß(ÈªòËÆ§2200)" style="flex: 1;">
                                    </div>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>ËÅäÂ§©ËÉåÊôØ</label>
                                    <input type="file" id="chat-setting-bg" accept="image/*" class="file-input-hidden">
                                    <label for="chat-setting-bg" class="ios-btn">ÈÄâÊã©ÂõæÁâá</label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>ËßÜÈ¢ëÈÄöËØùËÉåÊôØ</label>
                                    <input type="file" id="chat-setting-video-bg" accept="image/*" class="file-input-hidden">
                                    <label for="chat-setting-video-bg" class="ios-btn">ÈÄâÊã©ÂõæÁâá</label>
                                </div>
                            </div>
                            <div class="list-item no-padding">
                                <div id="chat-bg-gallery" class="gallery-scroll">
                                    <!-- Â£ÅÁ∫∏Áº©Áï•ÂõæÂ∞ÜÂú®ËøôÈáåÁîüÊàê -->
                                </div>
                            </div>
                            <div class="list-item center-content" id="reset-chat-bg">
                                <span class="danger-text">ÈáçÁΩÆÈªòËÆ§ËÉåÊôØ</span>
                            </div>
                        </div>

                        <div class="section-title">ËÅäÂ§©È°µÈù¢Ëá™ÂÆö‰πâCSS</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>CSSÈ¢ÑËÆæ</label>
                                    <div class="input-row full-width">
                                        <select id="chat-css-preset-select">
                                            <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                        </select>
                                        <button id="save-chat-css-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                        <button id="delete-chat-css-preset" class="ios-btn-small danger">Âà†Èô§</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item no-padding">
                                <textarea id="chat-setting-custom-css" placeholder="/* ‰ªÖÈíàÂØπÂΩìÂâçËÅäÂ§©È°µÈù¢ÁöÑCSS */" style="height: 200px;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê∑ªÂä†ËÅîÁ≥ª‰∫∫ÂºπÁ™ó -->
            <div id="add-contact-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ê∑ªÂä†ËÅîÁ≥ª‰∫∫</h3>
                        <button class="close-btn" id="close-add-contact">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="avatar-upload-container">
                            <div class="avatar-preview" id="contact-avatar-preview">
                                <i class="fas fa-camera"></i>
                            </div>
                            <input type="file" id="contact-avatar-upload" accept="image/*" class="file-input-hidden">
                        </div>
                        <div class="setting-group">
                            <label>ÂßìÂêç</label>
                            <input type="text" id="contact-name" placeholder="ËæìÂÖ•ÂßìÂêç">
                        </div>
                        <div class="setting-group">
                            <label>Â§áÊ≥®</label>
                            <input type="text" id="contact-remark" placeholder="ËæìÂÖ•Â§áÊ≥®">
                        </div>
                        <div class="setting-group">
                            <label>‰∫∫ËÆæ (Prompt)</label>
                            <textarea id="contact-persona" placeholder="‰æãÂ¶ÇÔºö‰Ω†ÊòØ‰∏Ä‰∏™ÁÉ≠ÂøÉÁöÑÈÇªÂ±Ö..."></textarea>
                        </div>
                        <button id="save-contact-btn" class="ios-btn-block">‰øùÂ≠òÂπ∂ËÅäÂ§©</button>
                    </div>
                </div>
            </div>

            <!-- ÊâπÈáèÂØºÂÖ•Ë°®ÊÉÖÂåÖÂºπÁ™ó -->
            <div id="import-sticker-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÂØºÂÖ•Ë°®ÊÉÖÂåÖ</h3>
                        <button class="close-btn" id="close-import-sticker">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ÂàÜÁ±ªÂêçÁß∞</label>
                            <input type="text" id="sticker-category-name" placeholder="‰æãÂ¶ÇÔºöÁå´Âí™Ë°®ÊÉÖ">
                        </div>
                        <div class="setting-group">
                            <label>Ë°®ÊÉÖÂåÖÂàóË°® (Ê†ºÂºè: ÊèèËø∞ÔºöURL)</label>
                            <textarea id="sticker-import-text" placeholder="ÂºÄÂøÉÔºöhttps://example.com/1.jpg&#10;ÈöæËøáÔºöhttps://example.com/2.jpg" style="height: 200px;"></textarea>
                        </div>
                        <div class="setting-group">
                            <label>Êàñ‰∏ä‰º† JSON Êñá‰ª∂</label>
                            <input type="file" id="sticker-import-json" accept=".json" class="file-input-hidden">
                            <label for="sticker-import-json" class="ios-btn-block secondary" style="text-align: center; margin-bottom: 0;">ÈÄâÊã© JSON Êñá‰ª∂</label>
                            <div id="sticker-json-status" style="font-size: 12px; color: #888; margin-top: 5px; text-align: center;">Êú™ÈÄâÊã©Êñá‰ª∂</div>
                        </div>
                        <button id="save-sticker-import-btn" class="ios-btn-block">ÂØºÂÖ•</button>
                    </div>
                </div>
            </div>

            <!-- Ë°®ÊÉÖÂåÖÈÄâÈ°πÂºπÁ™ó -->
            <div id="sticker-options-modal" class="modal hidden" style="z-index: 200; align-items: flex-end;">
                <div class="modal-content" style="height: auto; border-radius: 12px 12px 0 0; width: 100%; max-width: 100%; background-color: transparent;">
                    <div class="ios-list-group" style="margin: 0 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item center-content" id="sticker-opt-manage" style="background: white; border-bottom: 1px solid #eee; height: 56px;">
                            <span style="font-size: 18px; color: #007AFF;">ÁÆ°ÁêÜË°®ÊÉÖ</span>
                        </div>
                        <div class="list-item center-content" id="sticker-opt-import" style="background: white; height: 56px;">
                            <span style="font-size: 18px; color: #007AFF;">ÂØºÂÖ•Ë°®ÊÉÖ</span>
                        </div>
                        <div class="list-item center-content" id="sticker-opt-deletecats" style="background: white; height: 56px;">
                            <span style="font-size: 18px; color: #FF3B30;">Âà†Èô§ÂàÜÁ±ª</span>
                        </div>
                    </div>
                    <div class="ios-list-group" style="margin: 10px 10px 20px 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item center-content" id="sticker-opt-cancel" style="background: white; height: 56px;">
                            <span style="font-size: 18px; font-weight: bold; color: #007AFF;">ÂèñÊ∂à</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Âà†Èô§Ë°®ÊÉÖÂåÖÂàÜÁ±ªÂºπÁ™ó -->
            <div id="sticker-delete-cats-modal" class="modal hidden" style="z-index: 210; align-items: flex-end;">
                <div class="modal-content" style="height: auto; border-radius: 12px 12px 0 0; width: 100%; max-width: 100%; background-color: transparent;">
                    <div class="ios-list-group" style="margin: 0 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item" style="background: white; padding: 12px 16px; font-weight: 600;">ÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑË°®ÊÉÖÂåÖÂàÜÁ±ª</div>
                        <div id="sticker-delete-cats-list" style="background: #fff; display: flex; flex-direction: column;"></div>
                    </div>
                    <div class="ios-list-group" style="margin: 10px 10px 20px 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item" style="background: white; height: 56px; display: flex; gap: 10px; justify-content: center; align-items: center;">
                            <button id="confirm-delete-sticker-cats" class="ios-btn-block" style="max-width: 160px;">Âà†Èô§ÊâÄÈÄâ</button>
                            <button id="close-delete-sticker-cats" class="ios-btn-block secondary" style="max-width: 120px;">ÂèñÊ∂à</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂàÜÁªÑÈÄâÊã©ÂºπÁ™ó -->
            <div id="group-select-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ËÆæÁΩÆÂàÜÁªÑ</h3>
                        <button class="close-btn" id="close-group-select">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="ios-list-group" id="group-list">
                            <!-- ÂàÜÁªÑÂàóË°® -->
                        </div>
                        <button id="create-group-btn" class="ios-btn-block">Êñ∞Âª∫ÂàÜÁªÑ</button>
                    </div>
                </div>
            </div>

            <!-- ËßÜÈ¢ë/ËØ≠Èü≥ÈÄöËØùÈÄâÊã©ÂºπÁ™ó -->
            <div id="video-call-modal" class="modal hidden" style="z-index: 200; align-items: flex-end;">
                <div class="modal-content" style="height: auto; border-radius: 12px 12px 0 0; width: 100%; max-width: 100%; background-color: transparent;">
                    <div class="ios-list-group" style="margin: 0 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item center-content" id="start-voice-call-btn" style="background: white; border-bottom: 1px solid #eee; height: 56px;">
                            <span style="font-size: 18px; color: #007AFF;">ËØ≠Èü≥ÈÄöËØù</span>
                        </div>
                        <div class="list-item center-content" id="start-video-call-btn" style="background: white; border-bottom: 1px solid #eee; height: 56px;">
                            <span style="font-size: 18px; color: #007AFF;">ËßÜÈ¢ëÈÄöËØù</span>
                        </div>
                        <div class="list-item center-content" id="view-call-history-btn" style="background: white; height: 56px;">
                            <span style="font-size: 18px; color: #007AFF;">ÈÄöËØùËÆ∞ÂΩï</span>
                        </div>
                    </div>
                    <div class="ios-list-group" style="margin: 10px 10px 20px 10px; border-radius: 12px; overflow: hidden;">
                        <div class="list-item center-content" id="cancel-video-call-btn" style="background: white; height: 56px;">
                            <span style="font-size: 18px; font-weight: bold; color: #007AFF;">ÂèñÊ∂à</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ËΩ¨Ë¥¶ÂºπÁ™ó -->
            <div id="transfer-modal" class="modal hidden" style="z-index: 200; align-items: center;">
                <div class="modal-content" style="height: auto; border-radius: 12px; width: 85%; max-width: 320px; background-color: #fff;">
                    <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                        <h3 style="width: 100%; text-align: center;">ËΩ¨Ë¥¶</h3>
                        <button class="close-btn" id="close-transfer-modal" style="position: absolute; right: 15px;">&times;</button>
                    </div>
                    <div class="modal-body" style="padding: 20px;">
                        <div class="setting-group">
                            <label>ÈáëÈ¢ù</label>
                            <div style="display: flex; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                                <span style="font-size: 24px; font-weight: bold;">¬•</span>
                                <input type="number" id="transfer-amount" placeholder="0.00" style="border: none; font-size: 24px; font-weight: bold; width: 100%; background: transparent; outline: none;">
                            </div>
                        </div>
                        <div class="setting-group" style="margin-top: 15px;">
                            <label>ËΩ¨Ë¥¶Â§áÊ≥®</label>
                            <input type="text" id="transfer-remark" placeholder="Ê∑ªÂä†Â§áÊ≥®(50Â≠ó‰ª•ÂÜÖ)" maxlength="50">
                        </div>
                        <button id="do-transfer-btn" class="ios-btn-block" style="margin-top: 20px; background-color: #07C160;">ËΩ¨Ë¥¶</button>
                    </div>
                </div>
            </div>
        <!-- ÂèëÈÄÅËØ≠Èü≥ÂºπÁ™ó -->
        <div id="voice-input-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ÂèëÈÄÅËØ≠Èü≥</h3>
                    <button class="close-btn" id="close-voice-input">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- È°∂ÈÉ®ÂàáÊç¢ -->
                    <div class="chat-settings-nav" style="margin: 0 0 20px 0;">
                        <div class="nav-item active" id="tab-voice-fake" onclick="switchVoiceTab('fake')">ÊñáÂ≠óËΩ¨ËØ≠Èü≥</div>
                        <div class="nav-item" id="tab-voice-real" onclick="switchVoiceTab('real')">ÂΩïÂà∂ËØ≠Èü≥</div>
                        <div class="nav-indicator" id="voice-nav-indicator" style="width: calc(50% - 4px);"></div>
                    </div>

                    <!-- Ê®°Âºè1: ‰º™ÈÄ†ËØ≠Èü≥ (ËæìÂÖ•ÊñáÂ≠ó) -->
                    <div id="voice-mode-fake">
                        <div class="setting-group">
                            <label>ËØ≠Èü≥ÂÜÖÂÆπ (ÁÇπÂáªÊ∂àÊÅØÂêéÊòæÁ§∫)</label>
                            <textarea id="voice-fake-text" placeholder="ËæìÂÖ•ËøôÊÆµËØ≠Èü≥ÂØπÂ∫îÁöÑÊñáÂ≠óÂÜÖÂÆπ..." style="height: 100px;"></textarea>
                        </div>
                        <div class="setting-group">
                            <label>ËØ≠Èü≥Êó∂Èïø: <span id="voice-fake-duration-val">3</span>Áßí</label>
                            <input type="range" id="voice-fake-duration" min="1" max="60" value="3" step="1">
                        </div>
                        <button id="send-fake-voice-btn" class="ios-btn-block" style="background-color: #07C160;">ÂèëÈÄÅ</button>
                    </div>

                    <!-- Ê®°Âºè2: ÁúüÂÆûÂΩïÈü≥ (Web Speech API) -->
                    <div id="voice-mode-real" class="hidden" style="text-align: center; padding: 20px 0;">
                        <div id="voice-recording-status" style="font-size: 18px; margin-bottom: 20px; color: #888;">ÁÇπÂáªÈ∫¶ÂÖãÈ£éÂºÄÂßãËØ¥ËØù</div>
                        <div id="voice-mic-btn" class="voice-mic-btn">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div id="voice-real-result" style="margin-top: 20px; font-style: italic; color: #333; min-height: 20px;"></div>
                        <button id="send-real-voice-btn" class="ios-btn-block" style="background-color: #07C160; margin-top: 20px;" disabled>ÂèëÈÄÅ</button>
                    </div>
                </div>
            </div>
        </div>

            <!-- Èó≤È±º‰ªòÊ¨æÊñπÂºèÈÄâÊã©ÂºπÁ™ó -->
            <div id="xianyu-payment-modal" class="modal hidden" style="z-index: 290; align-items: flex-end;">
                <div class="modal-content" style="height: auto; border-radius: 12px 12px 0 0; width: 100%; max-width: 100%; background-color: #fff; padding: 0;">
                    <div style="padding: 15px; border-bottom: 1px solid #eee; text-align: center; font-weight: bold; position: relative;">
                        Á°ÆËÆ§‰ªòÊ¨æ
                        <button id="close-xianyu-payment-btn" style="position: absolute; left: 15px; top: 15px; background: none; border: none; font-size: 16px;"><i class="fas fa-times"></i></button>
                    </div>
                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 30px; font-weight: bold;">¬•<span id="xianyu-payment-amount">0.00</span></div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
                            <span style="color: #666;">‰ªòÊ¨æÊñπÂºè</span>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <i class="fab fa-weixin" style="color: #07C160;"></i>
                                <span>ÂæÆ‰ø°Èí±ÂåÖ‰ΩôÈ¢ù</span>
                                <span style="color: #999; font-size: 12px;" id="xianyu-payment-balance">(¬•0.00)</span>
                                <i class="fas fa-chevron-right" style="color: #ccc; font-size: 12px;"></i>
                            </div>
                        </div>
                        
                        <button id="confirm-xianyu-payment-btn" class="ios-btn-block" style="background-color: #07C160; margin-top: 20px;">Á´ãÂç≥‰ªòÊ¨æ</button>
                    </div>
                </div>
            </div>

            <!-- Èó≤È±ºË¥≠‰π∞ÊàêÂäüÂºπÁ™ó -->
            <div id="xianyu-purchase-modal" class="modal hidden" style="z-index: 300; align-items: center;">
                <div class="modal-content" style="height: auto; border-radius: 12px; width: 85%; max-width: 320px; background-color: #fff; padding: 20px; display: flex; flex-direction: column; align-items: center;">
                    <div style="width: 60px; height: 60px; background: #E8F5E8; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                        <i class="fas fa-check" style="font-size: 30px; color: #00CC66;"></i>
                    </div>
                    <h3 style="margin: 0 0 10px 0; font-size: 18px;">Ë¥≠‰π∞ÊàêÂäü</h3>
                    <p style="color: #666; font-size: 14px; margin: 0 0 20px 0;">Á≠âÂæÖÂçñÂÆ∂ÂèëË¥ß</p>
                    
                    <button id="xianyu-tell-ta-btn" class="ios-btn-block" style="background-color: #07C160;">ÂëäËØâTA</button>
                    <button id="close-xianyu-purchase-btn" class="ios-btn-block secondary" style="margin-top: 10px;">ÂÖ≥Èó≠</button>
                </div>
            </div>

            <!-- ËÅäÂ§©È°µÈù¢ -->
            <div id="chat-screen" class="sub-screen hidden">
                <div class="chat-header">
                    <button id="back-to-contacts" class="back-btn"><i class="fas fa-chevron-left"></i></button>
                    <button id="multi-select-cancel" class="multi-select-cancel hidden">ÈÄÄÂá∫</button>
                    <span id="chat-title" style="cursor: pointer;">Áî®Êà∑Âêç</span>
                    <button id="chat-settings-btn" class="wechat-icon-btn"><i class="fas fa-ellipsis-h"></i></button>
                </div>
                <!-- Â§öÈÄâÂà†Èô§ÊéßÂà∂È°πÔºöÂè≥‰∏ãÂà†Èô§ÔºàÈÄÄÂá∫ÊåâÈíÆÂ∑≤ÁßªÂÖ• headerÔºâ -->
                <button id="multi-select-delete" class="multi-select-delete hidden">Âà†Èô§(<span id="multi-select-count">0</span>)</button>
                
                <div class="chat-body" id="chat-messages">
                    <!-- Ê∂àÊÅØÂàóË°® -->
                </div>
                <!-- ÂºïÁî®ÂõûÂ§çÊù° -->
                <div id="reply-bar" class="reply-bar hidden">
                    <div class="reply-content">
                        <span id="reply-name" style="font-weight: 600;"></span>: <span id="reply-text"></span>
                    </div>
                    <div class="reply-close" id="close-reply-bar"><i class="fas fa-times-circle"></i></div>
                </div>
                <!-- ‰∏¥Êó∂ÊèêÁ§∫ÁªÑ‰ª∂ -->
                <div id="chat-toast" class="chat-toast hidden">
                    <span id="chat-toast-text"></span>
                </div>
                <div class="chat-input-area">
                    <button id="chat-more-btn" class="chat-icon-btn"><i class="fas fa-plus-circle"></i></button>
                    <input type="text" id="chat-input">
                    <button id="sticker-btn" class="chat-icon-btn" style="margin-right: 5px;"><i class="far fa-smile"></i></button>
                    <button id="trigger-ai-reply-btn"><i class="fas fa-arrow-up"></i></button>
                </div>
                <!-- Ë°®ÊÉÖÂåÖÈù¢Êùø -->
                <div id="sticker-panel" class="sticker-panel hidden">
                    <div class="sticker-top-bar">
                        <div class="sticker-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="sticker-search-input" placeholder="ÊêúÁ¥¢Ë°®ÊÉÖ">
                        </div>
                    </div>
                    <div class="sticker-tab-bar" id="sticker-tab-bar">
                        <div id="sticker-tabs-container" style="display: flex; flex: 1; overflow-x: auto; height: 100%; align-items: center;">
                            <!-- Ê†áÁ≠æÂàóË°® -->
                        </div>
                        <div class="sticker-settings-tab" id="sticker-manage-btn">
                            <i class="fas fa-cog"></i>
                        </div>
                    </div>
                    <div id="sticker-manage-actions" class="sticker-manage-actions hidden">
                        <span id="sticker-select-count">Â∑≤ÈÄâ 0</span>
                        <div style="display: flex; gap: 10px;">
                            <button id="sticker-export-btn">ÂØºÂá∫</button>
                            <button id="sticker-select-all-btn">ÂÖ®ÈÄâ</button>
                            <button id="sticker-delete-btn" class="danger">Âà†Èô§</button>
                        </div>
                    </div>
                    <div id="sticker-content" class="sticker-content">
                        <!-- Ë°®ÊÉÖÂåÖÂàóË°® -->
                    </div>
                </div>
                
                <!-- Êõ¥Â§öÂäüËÉΩÈù¢Êùø -->
                <div id="chat-more-panel" class="chat-more-panel hidden">
                    <div class="chat-more-pages" id="chat-more-pages">
                        <!-- Á¨¨‰∏ÄÈ°µ -->
                        <div class="chat-more-page">
                            <div class="more-item" id="chat-more-regenerate-btn">
                                <div class="more-icon"><i class="fas fa-redo"></i></div>
                                <div class="more-label">ÈáçÂõû</div>
                            </div>
                            <div class="more-item" id="chat-more-photo-btn">
                                <div class="more-icon"><i class="fas fa-image"></i></div>
                                <div class="more-label">ÁÖßÁâá</div>
                            </div>
                            <div class="more-item" id="chat-more-camera-btn">
                                <div class="more-icon"><i class="fas fa-camera"></i></div>
                                <div class="more-label">ÊãçÊëÑ</div>
                            </div>
                            <div class="more-item" id="chat-more-video-call-btn">
                                <div class="more-icon"><i class="fas fa-video"></i></div>
                                <div class="more-label">ËßÜÈ¢ëÈÄöËØù</div>
                            </div>
                            <div class="more-item" id="chat-more-location-btn">
                                <div class="more-icon"><i class="fas fa-map-marker-alt"></i></div>
                                <div class="more-label">‰ΩçÁΩÆ</div>
                            </div>
                            <div class="more-item" id="chat-more-memory-btn">
                                <div class="more-icon"><i class="fas fa-brain"></i></div>
                                <div class="more-label">ËÆ∞ÂøÜ</div>
                            </div>
                            <div class="more-item" id="chat-more-transfer-btn">
                                <div class="more-icon"><i class="fas fa-exchange-alt"></i></div>
                                <div class="more-label">ËΩ¨Ë¥¶</div>
                            </div>
                            <div class="more-item" id="chat-more-voice-btn">
                                <div class="more-icon"><i class="fas fa-microphone"></i></div>
                                <div class="more-label">ËØ≠Èü≥ËæìÂÖ•</div>
                            </div>
                        </div>
                        <!-- Á¨¨‰∫åÈ°µ -->
                        <div class="chat-more-page">
                            <div class="more-item" id="chat-more-continue-btn">
                                <div class="more-icon"><i class="fas fa-comment-dots"></i></div>
                                <div class="more-label">ËÆ©TAÂèëÊ∂àÊÅØ</div>
                            </div>
                            <div class="more-item" id="chat-more-games-btn">
                                <div class="more-icon"><i class="fas fa-gamepad"></i></div>
                                <div class="more-label">Â∞èÊ∏∏Êàè</div>
                            </div>
                            <div class="more-item" id="chat-more-edit-msg-btn">
                                <div class="more-icon"><i class="fas fa-edit"></i></div>
                                <div class="more-label">ÁºñËæë</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-more-indicators" id="chat-more-indicators">
                        <div class="chat-more-dot active"></div>
                        <div class="chat-more-dot"></div>
                    </div>
                    
                    <input type="file" id="chat-photo-input" accept="image/*" class="file-input-hidden">
                </div>
            </div>

            <!-- Èí±ÂåÖÈ°µÈù¢ -->
            <div id="wallet-screen" class="sub-screen hidden" style="z-index: 160;">
                <div class="app-header wallet-header">
                    <button id="close-wallet-screen" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                    <h3>Èí±ÂåÖ</h3>
                    <div style="width: 60px;"></div>
                </div>
                <div class="app-body wallet-body">
                    <!-- ‰ΩôÈ¢ùÂç°Áâá -->
                    <div class="wallet-card">
                        <div class="wallet-label">ÊÄªËµÑ‰∫ß (CNY)</div>
                        <div class="wallet-balance" id="wallet-balance">¬• 0.00</div>
                    </div>
                    
                    <!-- Êìç‰ΩúÊåâÈíÆ -->
                    <div class="wallet-actions">
                        <button id="wallet-recharge-btn" class="wallet-action-btn">
                            <div class="action-icon"><i class="fas fa-plus"></i></div>
                            <span>ÂÖÖÂÄº</span>
                        </button>
                        <button class="wallet-action-btn" style="opacity: 0.5; cursor: not-allowed;">
                            <div class="action-icon"><i class="fas fa-arrow-up"></i></div>
                            <span>ÊèêÁé∞</span>
                        </button>
                    </div>

                    <!-- ‰∫§ÊòìËÆ∞ÂΩï -->
                    <div class="section-title">ÊúÄËøë‰∫§Êòì</div>
                    <div id="wallet-transactions" class="wallet-transactions">
                        <!-- ‰∫§ÊòìÂàóË°® -->
                    </div>
                </div>
            </div>

            <!-- ÂÖÖÂÄºÂºπÁ™ó -->
            <div id="wallet-recharge-modal" class="modal hidden" style="z-index: 200; align-items: center;">
                <div class="modal-content" style="height: auto; border-radius: 12px; width: 85%; max-width: 320px; background-color: #fff;">
                    <div class="modal-header" style="border-bottom: none; padding-bottom: 0;">
                        <h3 style="width: 100%; text-align: center; color: #000;">ÂÖÖÂÄº</h3>
                        <button class="close-btn" id="close-recharge-modal" style="position: absolute; right: 15px;">&times;</button>
                    </div>
                    <div class="modal-body" style="padding: 20px;">
                        <div class="setting-group">
                            <label>ÂÖÖÂÄºÈáëÈ¢ù</label>
                            <div style="display: flex; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                                <span style="font-size: 24px; font-weight: bold; color: #000;">¬•</span>
                                <input type="number" id="recharge-amount" placeholder="0.00" style="border: none; font-size: 24px; font-weight: bold; width: 100%; background: transparent; outline: none; color: #000;">
                            </div>
                        </div>
                        <button id="do-recharge-btn" class="ios-btn-block" style="margin-top: 20px; background-color: #000;">Á°ÆËÆ§ÂÖÖÂÄº</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI ËµÑÊñôÂç°ÂÖ®Â±èÈ°µ -->
        <div id="ai-profile-screen" class="sub-screen hidden" style="z-index: 170; background-color: #fff;">
            <div class="app-header transparent-header" id="ai-profile-header">
                <button id="close-ai-profile" class="back-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5);"><i class="fas fa-chevron-left"></i></button>
                <div style="flex: 1;"></div>
                <button id="ai-profile-more" class="wechat-icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); display: none;"><i class="fas fa-ellipsis-h"></i></button>
            </div>
            
            <div class="app-body full-screen" style="padding: 0;">
                <!-- Â§¥ÈÉ®ËÉåÊôØ‰∏éÂ§¥ÂÉè -->
                <div class="ai-profile-header-section">
                    <div class="profile-bg" id="ai-profile-bg"></div>
                    <div class="ai-profile-avatar-container">
                        <img src="" id="ai-profile-avatar" class="ai-profile-avatar-large">
                    </div>
                    <div class="ai-profile-info-primary">
                        <h2 id="ai-profile-name"></h2>
                        <p id="ai-profile-nickname" class="profile-nickname" style="display: none;"></p>
                        <p id="ai-profile-id" class="profile-id"></p>
                    </div>
                </div>
                

                <!-- ËØ¶ÁªÜ‰ø°ÊÅØÂàóË°® -->
                <div class="profile-content-section">
                    <!-- Â§áÊ≥®‰∏éÁ≠æÂêç -->
                    <div class="ios-list-group">
                        <div class="list-item">
                            <div class="list-content column">
                                <label class="field-label">Â§áÊ≥®Âêç</label>
                                <div id="ai-profile-remark" class="field-value"></div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                        <div class="list-item">
                            <div class="list-content column">
                                <label class="field-label">‰∏™ÊÄßÁ≠æÂêç</label>
                                <div id="ai-profile-signature" class="field-value"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ÂÖ≥Á≥ªËÆæÁΩÆ -->
                    <div class="ios-list-group">
                        <div class="list-item" id="ai-relation-item">
                            <div class="list-content">
                                <label>ÂÖ≥Á≥ª</label>
                                <span id="ai-profile-relation" class="value-right">Êú™ËÆæÁΩÆ</span>
                            </div>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>

                    <!-- ÊúãÂèãÂúàÂÖ•Âè£ -->
                    <div class="ios-list-group">
                        <div class="list-item" id="ai-moments-entry">
                            <div class="list-content">
                                <label>ÊúãÂèãÂúà</label>
                                <div class="moments-preview" id="ai-moments-preview">
                                    <!-- Áº©Áï•Âõæ -->
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                    
                    <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
                    <div class="profile-actions">
                        <button id="ai-profile-send-msg" class="ios-btn-block"><i class="fas fa-comment"></i> ËßÅÈù¢</button>
                    </div>
                </div>
            </div>

            <!-- ÂÖ≥Á≥ªÈÄâÊã©ÂºπÁ™ó -->
            <div id="relation-select-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ËÆæÁΩÆÂÖ≥Á≥ª</h3>
                        <button class="close-btn" id="close-relation-select">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="ios-list-group" id="relation-options">
                            <!-- ÈÄâÈ°πÁî±JSÁîüÊàê -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éËµÑÊñôÂç°ËÉåÊôØ‰øÆÊîπ -->
            <input type="file" id="ai-profile-bg-input" accept="image/*" class="file-input-hidden">
        </div>

        <!-- ‰∏™‰∫∫ÊúãÂèãÂúàÂÖ®Â±èÈ°µ -->
        <div id="personal-moments-screen" class="app-screen hidden" style="z-index: 180; background-color: #fff;">
            <div class="wechat-header transparent" id="personal-moments-header">
                <div class="header-left">
                    <button id="close-personal-moments" class="wechat-icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5);"><i class="fas fa-chevron-left"></i></button>
                </div>
                <div class="header-right"></div>
            </div>
            <div class="wechat-body full-screen" id="personal-moments-body" style="padding-top: 0;">
                <div id="personal-moments-container" class="moments-container">
                    <!-- ‰∏™‰∫∫ÊúãÂèãÂúàÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                </div>
            </div>
            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫é‰∏™‰∫∫ÊúãÂèãÂúàËÉåÊôØ‰øÆÊîπ -->
            <input type="file" id="personal-moments-bg-input" accept="image/*" class="file-input-hidden">
        </div>

        <!-- ÈÄöËØùËÆ∞ÂΩïÂàóË°®ÂÖ®Â±èÈ°µ -->
        <div id="call-history-screen" class="sub-screen hidden" style="z-index: 250; background-color: #f2f2f7;">
            <div class="app-header">
                <button id="close-call-history" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>ÈÄöËØùËÆ∞ÂΩï</h3>
                <div style="width: 60px;"></div>
            </div>
            <div class="app-body">
                <div id="call-history-list" class="ios-list-group" style="margin-top: 10px; background: transparent;">
                    <!-- ÂàóË°®È°πÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                </div>
                <div class="empty-state" id="call-history-empty" style="display: none; text-align: center; color: #999; margin-top: 50px;">
                    ÊöÇÊó†ÈÄöËØùËÆ∞ÂΩï
                </div>
            </div>
        </div>

        <!-- ÈÄöËØùËÆ∞ÂΩïËØ¶ÊÉÖÂÖ®Â±èÈ°µ -->
        <div id="call-detail-screen" class="sub-screen hidden" style="z-index: 260; background-color: #fff;">
            <div class="app-header">
                <button id="close-call-detail" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3 id="call-detail-title">ÈÄöËØùËØ¶ÊÉÖ</h3>
                <div style="width: 60px;"></div>
            </div>
            <div class="app-body" id="call-detail-content" style="padding: 20px;">
                <!-- ËØ¶ÊÉÖÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÁîüÊàê -->
            </div>
        </div>

        <!-- ËØ≠Èü≥ÈÄöËØùÊÇ¨ÊµÆÁ™ó -->
        <div id="voice-call-float" class="voice-call-float hidden">
            <div class="float-icon"><i class="fas fa-phone"></i></div>
            <div class="float-info">
                <div class="float-status">ÈÄöËØù‰∏≠</div>
                <div class="float-time" id="float-call-time">00:00</div>
            </div>
        </div>

        <!-- ËØ≠Èü≥ÈÄöËØùÂÖ®Â±èÈ°µ -->
        <div id="voice-call-screen" class="app-screen hidden" style="z-index: 300; background-color: #000;">
            <!-- ËÉåÊôØÂ±Ç -->
            <div id="voice-call-bg" class="voice-call-bg"></div>
            <div class="voice-call-overlay"></div>
            
            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éÊõ¥Êç¢ÈÄöËØùËÉåÊôØ -->
            <input type="file" id="voice-call-bg-input" accept="image/*" class="file-input-hidden">

            <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è -->
            <div class="voice-call-header">
                <button id="voice-call-minimize-btn" class="icon-btn-white"><i class="fas fa-compress-alt"></i></button>
                <div class="voice-call-time" id="voice-call-time">00:00</div>
                <button id="voice-call-add-btn" class="icon-btn-white"><i class="fas fa-plus"></i></button>
            </div>

            <!-- ‰∏≠Èó¥Â§¥ÂÉèÂå∫Âüü -->
            <div class="voice-call-avatar-container">
                <div class="voice-call-avatar-wrapper">
                    <img id="voice-call-avatar" src="" alt="Avatar">
                </div>
                <div class="voice-call-name" id="voice-call-name">Áî®Êà∑Âêç</div>
                <div class="voice-call-status" id="voice-call-status">Ê≠£Âú®ÈÄöËØù‰∏≠...</div>
            </div>

            <!-- ÂØπËØùÊòæÁ§∫Âå∫Âüü -->
            <div class="voice-call-content-container" id="voice-call-content">
                <!-- ÂØπËØùÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊèíÂÖ• -->
            </div>

            <!-- Â∫ïÈÉ®ËæìÂÖ•Ê°Ü -->
            <div class="voice-call-input-area">
                <input type="text" id="voice-call-input" placeholder="ÂèëÈÄÅÊ∂àÊÅØ...">
                <button id="voice-call-send-btn"><i class="fas fa-arrow-up"></i></button>
            </div>

            <!-- Â∫ïÈÉ®ÊéßÂà∂Ê†è -->
            <div class="voice-call-footer">
                <!-- ÈÄöËØù‰∏≠ÊåâÈíÆÁªÑ -->
                <div id="voice-call-actions-active" class="voice-call-actions-row">
                    <div class="voice-call-action-item">
                        <button id="voice-call-mic-btn" class="voice-action-btn white active">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <span>È∫¶ÂÖãÈ£éÂ∑≤ÂºÄ</span>
                    </div>
                    
                    <div class="voice-call-action-item">
                        <button id="voice-call-hangup-btn" class="voice-action-btn red">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                        <span>ÊåÇÊñ≠</span>
                    </div>

                    <div class="voice-call-action-item">
                        <button id="voice-call-speaker-btn" class="voice-action-btn dark">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <span>Êâ¨Â£∞Âô®Â∑≤ÂÖ≥</span>
                    </div>
                </div>

                <!-- Êù•ÁîµÊåâÈíÆÁªÑ -->
                <div id="voice-call-actions-incoming" class="voice-call-actions-row hidden" style="justify-content: space-around; width: 100%; padding: 0 40px;">
                    <div class="voice-call-action-item">
                        <button id="voice-call-reject-btn" class="voice-action-btn red" style="width: 70px; height: 70px;">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                        <span>ÊåÇÊñ≠</span>
                    </div>
                    <div class="voice-call-action-item">
                        <button id="voice-call-accept-btn" class="voice-action-btn green" style="width: 70px; height: 70px; background-color: #34C759; color: #fff;">
                            <i class="fas fa-phone"></i>
                        </button>
                        <span>Êé•ÈÄö</span>
                    </div>
                </div>

                <!-- ÂëºÂá∫ÊåâÈíÆÁªÑ (Êñ∞Â¢û) -->
                <div id="voice-call-actions-outgoing" class="voice-call-actions-row hidden" style="justify-content: center; width: 100%;">
                    <div class="voice-call-action-item">
                        <button id="voice-call-cancel-btn" class="voice-action-btn red" style="width: 70px; height: 70px;">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                        <span>ÂèñÊ∂à</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ËßÜÈ¢ëÈÄöËØùÂÖ®Â±èÈ°µ -->
        <div id="video-call-screen" class="app-screen hidden" style="z-index: 300; background-color: #000;">
            <!-- ËÉåÊôØÂ±Ç -->
            <div id="video-call-bg" class="video-call-bg"></div>
            
            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éÊõ¥Êç¢ËßÜÈ¢ëÈÄöËØùËÉåÊôØ -->
            <input type="file" id="video-call-bg-input" accept="image/*" class="file-input-hidden">

            <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è -->
            <div class="voice-call-header">
                <button id="video-call-minimize-btn" class="icon-btn-white"><i class="fas fa-compress-alt"></i></button>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div class="voice-call-time" id="video-call-time">00:00</div>
                    <div id="video-call-status" class="voice-call-status" style="font-size: 12px; opacity: 0.8;">Ê≠£Âú®ÈÄöËØù‰∏≠...</div>
                </div>
                <button id="video-call-add-btn" class="icon-btn-white"><i class="fas fa-plus"></i></button>
            </div>

            <!-- Âè≥‰∏äËßíÊú¨Âú∞ÊëÑÂÉèÂ§¥È¢ÑËßà -->
            <div id="video-local-preview" class="video-local-preview hidden">
                <video id="video-local-stream" autoplay playsinline muted></video>
            </div>

            <!-- ÂØπËØùÊòæÁ§∫Âå∫Âüü -->
            <div class="voice-call-content-container" id="video-call-content">
                <!-- ÂØπËØùÂÜÖÂÆπÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÊèíÂÖ• -->
            </div>

            <!-- Â∫ïÈÉ®ËæìÂÖ•Ê°Ü -->
            <div class="voice-call-input-area">
                <input type="text" id="video-call-input" placeholder="ÂèëÈÄÅÊ∂àÊÅØ...">
                <button id="video-call-snapshot-btn"><i class="fas fa-camera"></i></button>
                <button id="video-call-send-btn"><i class="fas fa-arrow-up"></i></button>
            </div>

            <!-- Ëá™Âä®Êà™ÂõæËÆæÁΩÆÂºπÁ™ó -->
            <div id="auto-snapshot-modal" class="modal hidden" style="z-index: 310;">
                <div class="modal-content" style="width: 80%; max-width: 300px;">
                    <div class="modal-header">
                        <h3>Ëá™Âä®Êà™ÂõæËÆæÁΩÆ</h3>
                        <button class="close-btn" id="close-auto-snapshot">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>Êà™ÂõæÈó¥Èöî (Áßí)</label>
                            <input type="number" id="auto-snapshot-interval" placeholder="ËæìÂÖ•ÁßíÊï∞Ôºå0‰∏∫ÂÖ≥Èó≠" min="5">
                        </div>
                        <div style="font-size: 12px; color: #888; margin-bottom: 15px;">
                            ÂºÄÂêØÂêéÔºåÂ∞ÜÊåâÊåáÂÆöÈó¥ÈöîËá™Âä®Êà™ÂèñËßÜÈ¢ëÁîªÈù¢Âπ∂ÂèëÈÄÅÁªôAIËøõË°åÂàÜÊûê„ÄÇÂª∫ËÆÆÈó¥Èöî‰∏ç‰Ωé‰∫é5Áßí„ÄÇ
                        </div>
                        <button id="save-auto-snapshot-btn" class="ios-btn-block">‰øùÂ≠òÂπ∂ÁîüÊïà</button>
                    </div>
                </div>
            </div>

            <!-- Â∫ïÈÉ®ÊéßÂà∂Ê†è -->
            <div class="voice-call-footer">
                <div class="voice-call-actions-row" style="justify-content: space-evenly; width: 100%;">
                    <!-- È∫¶ÂÖãÈ£é -->
                    <div class="voice-call-action-item">
                        <button id="video-call-mic-btn" class="voice-action-btn white active">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <span>È∫¶ÂÖãÈ£éÂ∑≤ÂºÄ</span>
                    </div>
                    
                    <!-- ÊåÇÊñ≠ -->
                    <div class="voice-call-action-item">
                        <button id="video-call-hangup-btn" class="voice-action-btn red">
                            <i class="fas fa-phone-slash"></i>
                        </button>
                        <span>ÊåÇÊñ≠</span>
                    </div>

                    <!-- ÂºÄÂêØÊëÑÂÉèÂ§¥ -->
                    <div class="voice-call-action-item">
                        <button id="video-call-camera-btn" class="voice-action-btn white">
                            <i class="fas fa-video"></i>
                        </button>
                        <span>ÊëÑÂÉèÂ§¥Â∑≤ÂÖ≥</span>
                    </div>

                    <!-- Êâ¨Â£∞Âô® -->
                    <div class="voice-call-action-item">
                        <button id="video-call-speaker-btn" class="voice-action-btn dark">
                            <i class="fas fa-volume-up"></i>
                        </button>
                        <span>Êâ¨Â£∞Âô®Â∑≤ÂÖ≥</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰ΩçÁΩÆ/Ë°åÁ®ãÂÖ®Â±èApp -->
        <div id="location-app" class="app-screen hidden">
            <div class="app-header">
                <button id="close-location-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>Ë°åÁ®ã</h3>
                <div class="header-actions" style="display: flex; gap: 10px;">
                    <button id="itinerary-settings-btn" class="wechat-icon-btn"><i class="fas fa-cog"></i></button>
                    <button id="refresh-location-btn" class="wechat-icon-btn"><i class="fas fa-sync-alt"></i></button>
                </div>
            </div>
            <div class="app-body">
                <div class="timeline-container">
                    <!-- Á§∫‰æãÊï∞ÊçÆ -->
                    <div class="timeline-item">
                        <div class="timeline-time">09:00</div>
                        <div class="timeline-content">
                            <div class="timeline-location"><i class="fas fa-home"></i> ÂÆ∂‰∏≠</div>
                            <div class="timeline-desc">Ëµ∑Â∫äÔºåÊ¥óÊº±ÔºåÂêÉÊó©È§ê„ÄÇ</div>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-time">10:30</div>
                        <div class="timeline-content">
                            <div class="timeline-location"><i class="fas fa-subway"></i> Âú∞ÈìÅÁ´ô</div>
                            <div class="timeline-desc">‰πòÂùêÂú∞ÈìÅÂâçÂæÄÂÖ¨Âè∏„ÄÇ</div>
                        </div>
                    </div>
                     <div class="timeline-item">
                        <div class="timeline-time">12:00</div>
                        <div class="timeline-content">
                            <div class="timeline-location"><i class="fas fa-utensils"></i> ÂÖ¨Âè∏È£üÂ†Ç</div>
                            <div class="timeline-desc">ÂêÉÂçàÈ•≠Ôºå‰ºëÊÅØ‰∏Ä‰ºöÂÑø„ÄÇ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ë°åÁ®ãËÆæÁΩÆÂºπÁ™ó -->
            <div id="itinerary-settings-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ë°åÁ®ãÁîüÊàêËÆæÁΩÆ</h3>
                        <button class="close-btn" id="close-itinerary-settings">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <label>ÂêØÁî®Ëá™Âä®ÁîüÊàêË°åÁ®ã</label>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="auto-itinerary-toggle">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            <div style="font-size: 12px; color: #888; margin-bottom: 15px;">
                                ÂΩìËÅäÂ§©Ê∂àÊÅØÁ¥ØËÆ°ËææÂà∞ÊåáÂÆöÊù°Êï∞Êó∂ÔºåËá™Âä®ÁîüÊàê‰∏ÄÊù°Êñ∞Ë°åÁ®ã„ÄÇ
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>Ëß¶ÂèëÈó¥Èöî (Ê∂àÊÅØÊù°Êï∞)</label>
                            <input type="number" id="auto-itinerary-interval" placeholder="ÈªòËÆ§ 10" min="1">
                        </div>
                        <button id="save-itinerary-settings-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>
        </div>
                <!-- ================= ËßÅÈù¢ÂäüËÉΩ HTML ÂºÄÂßã ================= -->
        <!-- 1. ËßÅÈù¢ËÆ∞ÂΩïÂàóË°®È°µ -->
        <div id="meetings-screen" class="sub-screen hidden" style="z-index: 180; background-color: #f2f2f7; position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
            <div class="app-header">
                <button id="close-meetings-screen" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>ËßÅÈù¢ËÆ∞ÂΩï</h3>
                <div class="header-actions" style="display: flex; gap: 8px;">
                    <button id="meeting-theme-btn" class="wechat-icon-btn"><i class="fas fa-palette"></i></button>
                    <button id="meeting-style-btn" class="wechat-icon-btn"><i class="fas fa-pen-nib"></i></button>
                    <button id="new-meeting-btn" class="wechat-icon-btn"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            <div class="app-body" style="padding-bottom: 20px;">
                <div id="meetings-list" class="ios-list-group" style="margin-top: 10px; background: transparent;">
                    <!-- ÂàóË°®È°π -->
                </div>
                <div class="empty-state" id="meetings-empty" style="display: none; text-align: center; color: #999; margin-top: 50px;">
                    ËøòÊ≤°ÊúâËßÅÈù¢ËÆ∞ÂΩïÔºåÁÇπÂáªÂè≥‰∏äËßí + ÂºÄÂßã
                </div>
            </div>
            
            <!-- ÊñáÈ£éËÆæÁΩÆÂºπÁ™ó -->
            <div id="meeting-style-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ËßÅÈù¢ÊñáÈ£éËÆæÁΩÆ</h3>
                        <button class="close-btn" id="close-meeting-style">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ÊñáÈ£éÈ¢ÑËÆæ</label>
                            <div class="input-row full-width">
                                <select id="meeting-style-preset-select">
                                    <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                </select>
                                <button id="save-meeting-style-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                <button id="delete-meeting-style-preset" class="ios-btn-small danger">Âà†Èô§</button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label>ÊèèÂÜôÈ£éÊ†º</label>
                            <textarea id="meeting-style-input" placeholder="‰æãÂ¶ÇÔºöÁªÜËÖª„ÄÅÂîØÁæé„ÄÅÊ≥®ÈáçÁéØÂ¢ÉÊèèÂÜô..." style="height: 100px;"></textarea>
                        </div>
                        <div class="setting-group">
                            <label>AIËæìÂá∫Â≠óÊï∞ËåÉÂõ¥</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <input type="number" id="meeting-min-words" placeholder="ÊúÄÂ∞èÂ≠óÊï∞" style="flex: 1;">
                                <span>-</span>
                                <input type="number" id="meeting-max-words" placeholder="ÊúÄÂ§ßÂ≠óÊï∞" style="flex: 1;">
                            </div>
                        </div>
                        <button id="save-meeting-style-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>

            <!-- ËßÅÈù¢Ê®°ÂºèÁæéÂåñËÆæÁΩÆÂºπÁ™ó -->
            <div id="meeting-theme-modal" class="modal hidden">
                <div class="modal-content" style="height: 85vh;">
                    <div class="modal-header">
                        <h3>ËßÅÈù¢ÁæéÂåñ</h3>
                        <button class="close-btn" id="close-meeting-theme">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- Â≠ó‰ΩìËÆæÁΩÆ (Â§çÁî®ÈÄªËæë) -->
                        <div class="section-title" style="margin-left: 0;">Â≠ó‰ΩìËÆæÁΩÆ</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <div style="display: flex; justify-content: space-between; width: 100%;">
                                        <label>Â≠ó‰ΩìÂ§ßÂ∞è</label>
                                        <span id="meeting-font-size-value">16px</span>
                                    </div>
                                    <input type="range" id="meeting-font-size-slider" min="12" max="30" step="1" value="16" style="width: 100%;">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Â≠ó‰ΩìÈ¢ÑËÆæ</label>
                                    <div class="input-row full-width">
                                        <select id="meeting-font-preset-select">
                                            <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                        </select>
                                        <button id="save-meeting-font-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                        <button id="delete-meeting-font-preset" class="ios-btn-small danger">Âà†Èô§</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>‰∏ä‰º†Â≠ó‰ΩìÊñá‰ª∂</label>
                                    <input type="file" id="meeting-font-upload" accept=".ttf,.otf,.woff,.woff2" class="file-input-hidden">
                                    <label for="meeting-font-upload" class="ios-btn">ÈÄâÊã©Êñá‰ª∂</label>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>ÁΩëÁªúÂ≠ó‰ΩìÈìæÊé•</label>
                                    <div class="input-row full-width">
                                        <input type="text" id="meeting-font-url" placeholder="https://...">
                                        <button id="apply-meeting-font-url" class="ios-btn-small">Â∫îÁî®</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item center-content" id="reset-meeting-font-btn">
                                <span class="danger-text">ÈáçÁΩÆÊàêÁ≥ªÁªüÈªòËÆ§Â≠ó‰Ωì</span>
                            </div>
                        </div>

                        <!-- Â£ÅÁ∫∏ËÆæÁΩÆ -->
                        <div class="section-title" style="margin-left: 0;">Â£ÅÁ∫∏ËÆæÁΩÆ</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content">
                                    <label>‰∏ä‰º†ËØ¶ÊÉÖÈ°µÂ£ÅÁ∫∏</label>
                                    <input type="file" id="meeting-wallpaper-upload" accept="image/*" class="file-input-hidden">
                                    <label for="meeting-wallpaper-upload" class="ios-btn">ÈÄâÊã©ÂõæÁâá</label>
                                </div>
                            </div>
                            <div class="list-item center-content" id="reset-meeting-wallpaper-btn">
                                <span class="danger-text">ÈáçÁΩÆÈªòËÆ§Â£ÅÁ∫∏</span>
                            </div>
                        </div>

                        <!-- ÂõæÊ†áËÆæÁΩÆ -->
                        <div class="section-title" style="margin-left: 0;">ÂõæÊ†áËÆæÁΩÆ</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content">
                                    <label>ÁºñËæëÂõæÊ†á</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img id="meeting-edit-icon-preview" src="" style="width: 20px; height: 20px; object-fit: contain;">
                                        <input type="file" id="meeting-edit-icon-upload" accept="image/*" class="file-input-hidden">
                                        <label for="meeting-edit-icon-upload" class="ios-btn">Êõ¥Êç¢</label>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>Âà†Èô§ÂõæÊ†á</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img id="meeting-delete-icon-preview" src="" style="width: 20px; height: 20px; object-fit: contain;">
                                        <input type="file" id="meeting-delete-icon-upload" accept="image/*" class="file-input-hidden">
                                        <label for="meeting-delete-icon-upload" class="ios-btn">Êõ¥Êç¢</label>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>ÁªìÊùüÂõæÊ†á</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img id="meeting-end-icon-preview" src="" style="width: 20px; height: 20px; object-fit: contain;">
                                        <input type="file" id="meeting-end-icon-upload" accept="image/*" class="file-input-hidden">
                                        <label for="meeting-end-icon-upload" class="ios-btn">Êõ¥Êç¢</label>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content">
                                    <label>Áª≠ÂÜôÂõæÊ†á</label>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <img id="meeting-continue-icon-preview" src="" style="width: 20px; height: 20px; object-fit: contain;">
                                        <input type="file" id="meeting-continue-icon-upload" accept="image/*" class="file-input-hidden">
                                        <label for="meeting-continue-icon-upload" class="ios-btn">Êõ¥Êç¢</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- CSS Ëá™ÂÆö‰πâ -->
                        <div class="section-title" style="margin-left: 0;">Ëá™ÂÆö‰πâ CSS (ËßÅÈù¢Ê®°Âºè)</div>
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>CSS È¢ÑËÆæ</label>
                                    <div class="input-row full-width">
                                        <select id="meeting-css-preset-select">
                                            <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                        </select>
                                        <button id="save-meeting-css-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                        <button id="delete-meeting-css-preset" class="ios-btn-small danger">Âà†Èô§</button>
                                    </div>
                                </div>
                            </div>
                            <div class="list-item no-padding">
                                <textarea id="meeting-css-editor" placeholder="/* Âú®Ê≠§ËæìÂÖ•Ëá™ÂÆö‰πâCSS */" style="height: 200px;"></textarea>
                            </div>
                            <div class="list-item">
                                <button id="apply-meeting-css-btn" class="ios-btn-block">Â∫îÁî® CSS</button>
                            </div>
                        </div>
                        <div style="height: 50px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Á∫ø‰∏ãËßÅÈù¢ËØ¶ÊÉÖÈ°µ -->
        <div id="meeting-detail-screen" class="sub-screen hidden" style="z-index: 190; background-color: #f5f5f5; position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
            <div class="app-header transparent-header" style="background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);">
                <button id="end-meeting-btn" class="back-btn" style="color: #FF3B30;">
                    <img id="meeting-end-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjRkYzQjMwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTkgMjFIMWMtMS4xIDAtMi0uOS0yLTJWMWMwLTEuMS45LTIgMi0yaDhNMjEgMTJsLTUtNW01IDVsLTUgNW01LTVoLTEzIi8+PC9zdmc+" style="width: 20px; height: 20px; object-fit: contain; margin-right: 5px;"> ÁªìÊùü
                </button>
                <h3 id="meeting-detail-title">Á∫ø‰∏ãËßÅÈù¢</h3>
                <div style="width: 60px;"></div>
            </div>
            
            <div class="meeting-body" id="meeting-card-container" style="flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px;">
                <!-- Âç°ÁâáÂÜÖÂÆπ -->
            </div>

                        <!-- Â∫ïÈÉ®ËæìÂÖ•Ê†è (‰øÆÊîπÁâàÔºöËæìÂÖ•Ê°ÜÂú®Â∑¶ÔºåÁîüÊàêÊåâÈíÆÂú®Âè≥) -->
            <div class="meeting-input-area" id="meeting-input-area">
                <!-- ËæìÂÖ•Ê°Ü -->
                <textarea id="meeting-input" placeholder="ËæìÂÖ•Âä®‰ΩúÊàñËØ≠Ë®ÄÔºåÊåâÂõûËΩ¶ÂèëÈÄÅ..."></textarea>
                
                <!-- AIÁª≠ÂÜôÊåâÈíÆ (È≠îÊ≥ïÊ£í) -->
                <button id="meeting-ai-continue-btn" class="meeting-icon-btn" title="AIÁª≠ÂÜô (ËÆ©ÂâßÊÉÖÁªßÁª≠)">
                    <img id="meeting-continue-icon" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwMDAwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTE1IDRWMiIvPjxwYXRoIGQ9Ik0xNSAxNnYtMiIvPjxwYXRoIGQ9Ik04IDloMiIvPjxwYXRoIGQ9Ik0yMCA5aDIiLz48cGF0aCBkPSJNMTcuOCAxMS44TDE5IDEzIi8+PHBhdGggZD0iTTEwLjYgNi42TDEyIDgiLz48cGF0aCBkPSJNNC44IDExLjhMNiAxMyIvPjxwYXRoIGQ9Ik0xMiA0LjhMMTAuNiA2Ii8+PHBhdGggZD0iTTE5IDQuOEwxNy44IDYiLz48cGF0aCBkPSJNMTIgMTMuMkw0LjggMjAuNGEyLjggMi44IDAgMCAwIDQgNEwxNiAxNy4yIi8+PC9zdmc+" style="width: 24px; height: 24px; object-fit: contain;">
                </button>
                
                <!-- ÂéüÂèëÈÄÅÊåâÈíÆ (ÈöêËóèÔºåÈÄªËæë‰øùÁïô) -->
                <button id="meeting-send-btn" style="display:none;"></button>
            </div>

            <!-- ËßÅÈù¢ÂâßÊÉÖÁºñËæëÂºπÁ™ó -->
            <div id="edit-meeting-msg-modal" class="modal hidden" style="z-index: 210;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÁºñËæëÂâßÊÉÖ</h3>
                        <button class="close-btn" id="close-edit-meeting-msg">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ÂâßÊÉÖÂÜÖÂÆπ</label>
                            <textarea id="edit-meeting-msg-content" placeholder="ËæìÂÖ•Êñ∞ÁöÑÂâßÊÉÖÂÜÖÂÆπ..." style="height: 150px;"></textarea>
                        </div>
                        <button id="save-edit-meeting-msg-btn" class="ios-btn-block">‰øùÂ≠ò‰øÆÊîπ</button>
                    </div>
                </div>
            </div>

        </div>
        <!-- ================= ËßÅÈù¢ÂäüËÉΩ HTML ÁªìÊùü ================= -->

        <!-- ËÆ∞ÂøÜÂÖ®Â±èApp -->
        <div id="memory-app" class="app-screen hidden">
            <div class="app-header">
                <button id="close-memory-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>ËÆ∞ÂøÜÁ¢éÁâá</h3>
                <div class="header-actions" style="display: flex; gap: 10px;">
                    <button id="add-memory-btn" class="wechat-icon-btn"><i class="fas fa-plus"></i></button>
                    <button id="manual-summary-btn" class="wechat-icon-btn"><i class="fas fa-magic"></i></button>
                    <button id="memory-settings-btn" class="wechat-icon-btn"><i class="fas fa-cog"></i></button>
                </div>
            </div>
            <div class="app-body">
                <div id="memory-list" class="ios-list-group" style="background-color: transparent; margin-top: 10px;">
                    <!-- ËÆ∞ÂøÜÂç°ÁâáÂàóË°® -->
                </div>
                <div class="empty-state" id="memory-empty" style="display: none;">
                    ÊöÇÊó†ËÆ∞ÂøÜ
                </div>
            </div>

            <!-- ÊâãÂä®Ê∑ªÂä†ËÆ∞ÂøÜÂºπÁ™ó -->
            <div id="add-memory-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Ê∑ªÂä†ËÆ∞ÂøÜ</h3>
                        <button class="close-btn" id="close-add-memory"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ËÆ∞ÂøÜÂÜÖÂÆπ</label>
                            <textarea id="manual-memory-content" placeholder="ËæìÂÖ•ËÆ∞ÂøÜÂÜÖÂÆπ..." style="height: 150px;"></textarea>
                        </div>
                        <button id="save-manual-memory-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>

            <!-- ÁºñËæëËÆ∞ÂøÜÂºπÁ™ó -->
            <div id="edit-memory-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÁºñËæëËÆ∞ÂøÜ</h3>
                        <button class="close-btn" id="close-edit-memory"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ËÆ∞ÂøÜÂÜÖÂÆπ</label>
                            <textarea id="edit-memory-content" placeholder="ËæìÂÖ•ËÆ∞ÂøÜÂÜÖÂÆπ..." style="height: 150px;"></textarea>
                        </div>
                        <button id="save-edited-memory-btn" class="ios-btn-block">‰øùÂ≠ò‰øÆÊîπ</button>
                    </div>
                </div>
            </div>

            <!-- ÊâãÂä®ÊÄªÁªìÂºπÁ™ó -->
            <div id="manual-summary-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÊâãÂä®ÊÄªÁªì</h3>
                        <button class="close-btn" id="close-manual-summary">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>Ëµ∑ÂßãÊ•ºÂ±Ç</label>
                            <input type="number" id="summary-start-index" placeholder="‰æãÂ¶Ç: 1" min="1">
                        </div>
                        <div class="setting-group">
                            <label>ÁªìÊùüÊ•ºÂ±Ç</label>
                            <input type="number" id="summary-end-index" placeholder="‰æãÂ¶Ç: 10" min="1">
                        </div>
                        <div style="font-size: 12px; color: #888; margin-bottom: 15px;">
                            Â∞ÜÊÄªÁªìÊåáÂÆöËåÉÂõ¥ÂÜÖÁöÑËÅäÂ§©ËÆ∞ÂΩï„ÄÇÂΩìÂâçÂÖ±Êúâ <span id="total-chat-count">0</span> Êù°Ê∂àÊÅØ„ÄÇ
                        </div>
                        <button id="do-manual-summary-btn" class="ios-btn-block">ÂºÄÂßãÊÄªÁªì</button>
                    </div>
                </div>
            </div>

            <!-- ËÆ∞ÂøÜËÆæÁΩÆÂºπÁ™ó -->
            <div id="memory-settings-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ËÆ∞ÂøÜËÆæÁΩÆ</h3>
                        <button class="close-btn" id="close-memory-settings">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ÂèëÈÄÅÊúÄËøëÂá†Êù°ËÆ∞ÂøÜÁªôAI</label>
                            <input type="number" id="modal-memory-send-limit" placeholder="ÈªòËÆ§3Êù°" min="0">
                        </div>
                        <button id="save-memory-settings-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ‰∏ñÁïå‰π¶ÂÖ®Â±èApp -->
        <div id="worldbook-app" class="app-screen hidden">
            <div class="app-header">
                <button id="close-worldbook-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>‰∏ñÁïå‰π¶</h3>
                <button id="add-worldbook-category" class="wechat-icon-btn"><i class="fas fa-plus"></i></button>
            </div>
            <div class="app-body">
                <div class="ios-list-group" id="worldbook-category-list">
                    <!-- ÂàÜÁ±ªÂàóË°®Â∞ÜÈÄöËøáJSÁîüÊàê -->
                </div>
                <div class="empty-state" id="worldbook-empty" style="display: none;">
                    ÊöÇÊó†ÂàÜÁ±ªÔºåÁÇπÂáªÂè≥‰∏äËßíÊ∑ªÂä†
                </div>
            </div>

            <!-- ÂàÜÁ±ªËØ¶ÊÉÖÈ°µ (Â≠êÂ±èÂπï) -->
            <div id="worldbook-detail-screen" class="sub-screen hidden">
                <div class="app-header">
                    <button id="back-to-worldbook-list" class="back-btn"><i class="fas fa-chevron-left"></i></button>
                    <h3 id="wb-category-title">ÂàÜÁ±ªÂêç</h3>
                    <button id="add-worldbook-entry" class="wechat-icon-btn"><i class="fas fa-plus"></i></button>
                </div>
                <div class="app-body">
                    <div class="ios-list-group" id="worldbook-entry-list">
                        <!-- Êù°ÁõÆÂàóË°® -->
                    </div>
                    <div class="empty-state" id="worldbook-entry-empty" style="display: none;">
                        ÊöÇÊó†Êù°ÁõÆÔºåÁÇπÂáªÂè≥‰∏äËßíÊ∑ªÂä†
                    </div>
                    <div class="ios-list-group" style="margin-top: 20px;">
                        <div class="list-item center-content" id="edit-category-btn">
<span style="color: #000;">ÁºñËæëÂΩìÂâçÂàÜÁ±ª</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Êù°ÁõÆÁºñËæëÂºπÁ™ó -->
            <div id="worldbook-edit-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="worldbook-modal-title">ÁºñËæëÊù°ÁõÆ</h3>
                        <button class="close-btn" id="close-worldbook-edit">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>Â§áÊ≥® (ÂèØÈÄâ)</label>
                            <input type="text" id="wb-remark" placeholder="ËæìÂÖ•Â§áÊ≥®">
                        </div>
                        <div class="setting-group">
                            <label>ÂÖ≥ÈîÆÂ≠ó (ÂèØÈÄâÔºåÈÄóÂè∑ÂàÜÈöî)</label>
                            <input type="text" id="wb-keys" placeholder="‰æãÂ¶Ç: ÂüéÂ†°, ÂõΩÁéã">
                        </div>
                        <div class="setting-group">
                            <label>ÂÜÖÂÆπ</label>
                            <textarea id="wb-content" placeholder="ÊèèËø∞ÂÜÖÂÆπ..." style="height: 200px;"></textarea>
                        </div>
                        <button id="save-worldbook-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                        <button id="delete-worldbook-btn" class="ios-btn-block danger" style="margin-top: 10px;">Âà†Èô§</button>
                    </div>
                </div>
            </div>

            <!-- ÂàÜÁ±ªÁºñËæëÂºπÁ™ó -->
            <div id="category-edit-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="category-modal-title">ÁºñËæëÂàÜÁ±ª</h3>
                        <button class="close-btn" id="close-category-edit">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>ÂàÜÁ±ªÂêçÁß∞</label>
                            <input type="text" id="cat-name" placeholder="ËæìÂÖ•ÂàÜÁ±ªÂêçÁß∞">
                        </div>
                        <div class="setting-group">
                            <label>ÊèèËø∞ (ÂèØÈÄâ)</label>
                            <input type="text" id="cat-desc" placeholder="ËæìÂÖ•ÊèèËø∞">
                        </div>
                        <button id="save-category-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                        <button id="delete-category-btn" class="ios-btn-block danger" style="margin-top: 10px; display: none;">Âà†Èô§ÂàÜÁ±ª</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ë∫´‰ªΩÁÆ°ÁêÜÂºπÁ™ó -->
        <div id="persona-manage-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ÁÆ°ÁêÜË∫´‰ªΩ</h3>
                    <button class="close-btn" id="close-persona-manage">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="persona-list" class="ios-list-group">
                        <!-- ÂàóË°® -->
                    </div>
                    <button id="add-persona-btn" class="ios-btn-block">Êñ∞Âª∫Ë∫´‰ªΩ</button>
                </div>
            </div>
        </div>

            <!-- Ë∫´‰ªΩÁºñËæëÂºπÁ™ó (ÁÆÄÂåñÁâà) -->
            <div id="persona-edit-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="persona-modal-title">ÁºñËæëË∫´‰ªΩ</h3>
                        <button class="close-btn" id="close-persona-edit">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>Ë∫´‰ªΩÂêçÁß∞ (ÂèëÈÄÅÁªôAIÁöÑÂêçÂ≠ó)</label>
                            <input type="text" id="persona-name" placeholder="‰æãÂ¶ÇÔºöÂì•Âì•„ÄÅËÄÅÊùø...">
                        </div>
                        <div class="setting-group">
                            <label>AIËÆ§Áü•‰∏≠ÁöÑÊàë (ÂèëÈÄÅÁªôAIÁöÑ‰∫∫ËÆæ)</label>
                            <textarea id="persona-ai-prompt" placeholder="‰æãÂ¶ÇÔºöÊàëÊòØ‰Ω†ÁöÑÂì•Âì•ÔºåÊÄßÊ†º..."></textarea>
                        </div>
                        <button id="save-persona-btn" class="ios-btn-block">‰øùÂ≠ò</button>
                        <button id="delete-persona-btn" class="ios-btn-block danger" style="display: none;">Âà†Èô§</button>
                    </div>
                </div>
            </div>
            
            <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éËµÑÊñôÂç°Áõ¥Êé•‰øÆÊîπ -->
            <input type="file" id="me-avatar-input" accept="image/*" class="file-input-hidden">
            <input type="file" id="me-bg-input" accept="image/*" class="file-input-hidden">
            <input type="file" id="moments-bg-input" accept="image/*" class="file-input-hidden">

            <!-- ÂèëÂ∏ÉÂä®ÊÄÅÂºπÁ™ó -->
            <div id="post-moment-modal" class="app-screen hidden" style="z-index: 200; background-color: #fff;">
                <div class="app-header">
                    <button id="close-post-moment" class="back-btn" style="color: #000;">ÂèñÊ∂à</button>
                    <button id="do-post-moment" class="ios-btn-small" style="background-color: #07C160; color: #fff; border-radius: 4px; padding: 4px 12px;">ÂèëË°®</button>
                </div>
                <div class="app-body" style="padding: 20px;">
                    <textarea id="post-moment-text" placeholder="Ëøô‰∏ÄÂàªÁöÑÊÉ≥Ê≥ï..." style="width: 100%; height: 100px; border: none; font-size: 16px; resize: none; margin-bottom: 20px;"></textarea>
                    <div id="post-moment-images" class="post-images-grid">
                        <!-- ÂõæÁâáÈ¢ÑËßà -->
                        <div class="add-image-btn" id="add-moment-image-btn">
                            <i class="fas fa-image"></i>
                        </div>
                        <div class="add-image-btn" id="add-virtual-image-btn" style="border: 1px dashed #007AFF; color: #007AFF;">
                            <i class="fas fa-font"></i>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 5px;">* ÁÇπÂáªÂ∑≤Ê∑ªÂä†ÁöÑÂõæÁâáÂèØÁºñËæëÂõæÁâáÊèèËø∞</div>
                    <input type="file" id="post-moment-file-input" accept="image/*" multiple class="file-input-hidden">
                </div>
            </div>

        
        <!-- ÁæéÂåñÂÖ®Â±èApp -->
        <div id="theme-app" class="app-screen hidden">
            <div class="app-header">
                <button id="close-theme-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3>ÁæéÂåñ‰∏≠ÂøÉ</h3>
                <button id="save-theme-config-btn" class="wechat-icon-btn" style="font-size: 16px; font-weight: 600; color: #007AFF; width: auto; padding: 0 10px;">‰øùÂ≠ò</button>
            </div>
            
            <div class="app-body">
                <!-- ÁæéÂåñÈÄâÈ°π -->
                <div class="section-title">‰∏™ÊÄßÂåñ</div>
                <div class="ios-list-group">
                    <div class="list-item" id="open-theme-font">
                        <div class="list-content">
                            <label>Â≠ó‰ΩìËÆæÁΩÆ</label>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                    <div class="list-item" id="open-theme-wallpaper">
                        <div class="list-content">
                            <label>Â£ÅÁ∫∏ËÆæÁΩÆ</label>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                    <div class="list-item" id="open-theme-icons">
                        <div class="list-content">
                            <label>Â∫îÁî®ÂõæÊ†á</label>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöÁî®ËÆæÁΩÆ (‰ªéËÆæÁΩÆÈ°µÁßªÊù•) -->
                <div class="section-title">ÈÄöÁî®ËÆæÁΩÆ</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content">
                            <label>ÊòæÁ§∫Áä∂ÊÄÅÊ†è</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-status-bar-toggle" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>ÈªòËÆ§ËôöÊãüÂõæÁâá URL</label>
                            <input type="text" id="default-virtual-image-url" placeholder="https://placehold.co/600x400/png?text=Photo">
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">Áî®‰∫é‚ÄúÊãçÊëÑ‚ÄùÂäüËÉΩÂíåAIÂèëÈÄÅÁöÑÂõæÁâá</div>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>Âä®ÊÄÅÂõæÁâá URL</label>
                            <input type="text" id="default-moment-virtual-image-url" placeholder="https://placehold.co/600x400/png?text=Moment">
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">Áî®‰∫éÂä®ÊÄÅÈ°µÈù¢ÁöÑÂõæÁâáÊèèËø∞</div>
                        </div>
                    </div>
                    <div class="list-item">
                        <div class="list-content column">
                            <label>ÂàùÂßãÂä†ËΩΩËÅäÂ§©Êù°Êï∞ (0‰∏∫‰∏çÈôêÂà∂)</label>
                            <input type="number" id="chat-loading-limit" placeholder="ÈªòËÆ§20" min="0">
                            <div style="font-size: 12px; color: #888; margin-top: 4px;">ÂáèÂ∞ëÊù°Êï∞ÂèØÂä†Âø´ËøõÂÖ•ËÅäÂ§©È°µÈù¢ÁöÑÈÄüÂ∫¶</div>
                        </div>
                    </div>
                </div>

                <!-- CSSÁºñËæëÂô®Âå∫Âùó -->
                <div class="section-title">È´òÁ∫ßËá™ÂÆö‰πâ (CSS)</div>
                <div class="ios-list-group">
                    <div class="list-item">
                        <div class="list-content column">
                            <label>CSSÈ¢ÑËÆæ</label>
                            <div class="input-row full-width">
                                <select id="css-preset-select">
                                    <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                </select>
                                <button id="save-css-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                <button id="delete-css-preset" class="ios-btn-small danger">Âà†Èô§</button>
                            </div>
                        </div>
                    </div>
                    <div class="list-item no-padding">
                        <textarea id="css-editor" placeholder="/* Âú®Ê≠§ËæìÂÖ•Ëá™ÂÆö‰πâCSS */"></textarea>
                    </div>
                    <div class="list-item">
                        <div class="button-row full-width">
                            <button id="save-css" class="ios-btn-block">Â∫îÁî®Âπ∂‰øùÂ≠òCSSÈÖçÁΩÆ</button>
                            <button id="export-css" class="ios-btn-block secondary">ÂØºÂá∫CSS</button>
                        </div>
                    </div>
                </div>

                <!-- ËøòÂéüÈªòËÆ§ CSS ÈÄâÈ°π -->
                <div class="section-title">ËøòÂéüÈªòËÆ§ÈÖçÁΩÆ</div>
                <div class="ios-list-group">
                     <div class="list-item" id="restore-global-css-btn">
                        <div class="list-content center-content">
                            <span class="danger-text">ËøòÂéüÂÖ®Â±ÄCSS</span>
                        </div>
                    </div>
                     <div class="list-item" id="restore-meeting-css-btn">
                        <div class="list-content center-content">
                            <span class="danger-text">ËøòÂéüËßÅÈù¢È°µCSS</span>
                        </div>
                    </div>
                     <div class="list-item" id="restore-chat-css-btn">
                        <div class="list-content center-content">
                            <span class="danger-text">ËøòÂéüËÅäÂ§©È°µÈù¢CSS...</span>
                        </div>
                    </div>
                </div>

                <div style="height: 50px;"></div> <!-- Â∫ïÈÉ®ÁïôÁôΩ -->
            </div>

            <!-- Â≠ó‰ΩìËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
            <div id="theme-font-screen" class="sub-screen hidden">
                <div class="app-header">
                    <button id="close-theme-font" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                    <h3>Â≠ó‰ΩìËÆæÁΩÆ</h3>
                    <div style="width: 60px;"></div>
                </div>
                <div class="app-body">
                    <div class="section-title">Â≠ó‰ΩìËÆæÁΩÆ</div>
                    <div class="ios-list-group">
                        <div class="list-item">
                            <div class="list-content column">
                                <label>Â≠ó‰ΩìÈ¢ÑËÆæ</label>
                                <div class="input-row full-width">
                                    <select id="font-preset-select">
                                        <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                    </select>
                                    <button id="save-font-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                    <button id="delete-font-preset" class="ios-btn-small danger">Âà†Èô§</button>
                                </div>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="list-content">
                                <label>‰∏ä‰º†Â≠ó‰ΩìÊñá‰ª∂</label>
                                <input type="file" id="font-upload" accept=".ttf,.otf,.woff,.woff2" class="file-input-hidden">
                                <label for="font-upload" class="ios-btn">ÈÄâÊã©Êñá‰ª∂</label>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="list-content column">
                                <label>ÁΩëÁªúÂ≠ó‰ΩìÈìæÊé•</label>
                                <div class="input-row full-width">
                                    <input type="text" id="font-url" placeholder="https://...">
                                    <button id="apply-font-url" class="ios-btn-small">Â∫îÁî®</button>
                                </div>
                            </div>
                        </div>
                        <div class="list-item center-content" id="reset-font-btn">
                            <span class="danger-text">ÈáçÁΩÆÊàêÁ≥ªÁªüÈªòËÆ§Â≠ó‰Ωì</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Â£ÅÁ∫∏ËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
            <div id="theme-wallpaper-screen" class="sub-screen hidden">
                <div class="app-header">
                    <button id="close-theme-wallpaper" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                    <h3>Â£ÅÁ∫∏ËÆæÁΩÆ</h3>
                    <div style="width: 60px;"></div>
                </div>
                <div class="app-body">
                    <div class="section-title">Â£ÅÁ∫∏ËÆæÁΩÆ</div>
                    <div class="ios-list-group">
                        <div class="list-item">
                            <div class="list-content">
                                <label>‰∏ä‰º†Â£ÅÁ∫∏</label>
                                <input type="file" id="wallpaper-upload" accept="image/*" class="file-input-hidden">
                                <label for="wallpaper-upload" class="ios-btn">ÈÄâÊã©ÂõæÁâá</label>
                            </div>
                        </div>
                        <div class="list-item no-padding">
                            <div id="wallpaper-gallery" class="gallery-scroll">
                                <!-- Â£ÅÁ∫∏Áº©Áï•ÂõæÂ∞ÜÂú®ËøôÈáåÁîüÊàê -->
                            </div>
                        </div>
                        <div class="list-item center-content" id="reset-wallpaper">
                            <span class="danger-text">ÈáçÁΩÆÈªòËÆ§Â£ÅÁ∫∏</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂõæÊ†áËÆæÁΩÆÂ≠êÈ°µÈù¢ -->
            <div id="theme-icons-screen" class="sub-screen hidden">
                <div class="app-header">
                    <button id="close-theme-icons" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                    <h3>Â∫îÁî®ÂõæÊ†á</h3>
                    <div style="width: 60px;"></div>
                </div>
                <div class="app-body">
                    <div class="section-title">ÂõæÊ†áÈ¢ÑËÆæ</div>
                    <div class="ios-list-group">
                        <div class="list-item">
                            <div class="list-content column">
                                <label>ÁÆ°ÁêÜÈ¢ÑËÆæ</label>
                                <div class="input-row full-width">
                                    <select id="icon-preset-select">
                                        <option value="">-- ÈÄâÊã©È¢ÑËÆæ --</option>
                                    </select>
                                    <button id="save-icon-preset" class="ios-btn-small">‰øùÂ≠ò</button>
                                    <button id="delete-icon-preset" class="ios-btn-small danger">Âà†Èô§</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-title">Â∫îÁî®ÂõæÊ†á</div>
                    <div class="ios-list-group" id="icon-setting-list">
                        <!-- ÂõæÊ†áËÆæÁΩÆÈ°πÂ∞ÜÈÄöËøáJSÂä®ÊÄÅÁîüÊàê -->
                    </div>
                    <div class="ios-list-group">
                        <div class="list-item center-content" id="reset-icons">
                            <span class="danger-text">ÈáçÁΩÆÊâÄÊúâÂõæÊ†á</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Èü≥‰πêËÆæÁΩÆÂºπÁ™ó -->
    <div id="music-settings-modal" class="modal hidden">
        <div class="modal-content" style="height: 85vh; padding-bottom: 0;">
            <div class="modal-header">
                <h3>Èü≥‰πêËÆæÁΩÆ</h3>
                <button class="close-btn" id="close-music-settings">&times;</button>
            </div>
            <div class="modal-body" style="padding: 0; display: flex; flex-direction: column;">
                
                <!-- ‰∏äÂçäÈÉ®ÂàÜÔºöÂ§ñËßÇËÆæÁΩÆ -->
                <div style="padding: 20px; border-bottom: 1px solid #eee; background-color: #fff;">
                    <div class="section-title" style="margin-left: 0; margin-bottom: 15px;">Â§ñËßÇËÆæÁΩÆ</div>
                    <div style="display: flex; gap: 20px; justify-content: center;">
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <label style="margin-bottom: 10px; font-size: 13px; color: #888;">ÂΩìÂâçÂ∞ÅÈù¢</label>
                            <div class="avatar-upload-container" style="margin-bottom: 10px;">
                                <div class="avatar-preview" id="music-cover-preview">
                                    <i class="fas fa-camera"></i>
                                </div>
                                <input type="file" id="music-cover-upload" accept="image/*" class="file-input-hidden">
                            </div>
                        </div>
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <label style="margin-bottom: 10px; font-size: 13px; color: #888;">ÁªÑ‰ª∂ËÉåÊôØ</label>
                            <div class="avatar-upload-container" style="margin-bottom: 10px;">
                                <div class="avatar-preview" id="music-widget-bg-preview" style="border-radius: 12px;">
                                    <i class="fas fa-image"></i>
                                </div>
                                <input type="file" id="music-widget-bg-upload" accept="image/*" class="file-input-hidden">
                            </div>
                        </div>
                    </div>
                    <button id="save-music-appearance" class="ios-btn-block" style="margin-top: 0;">‰øùÂ≠òÂ§ñËßÇ</button>
                </div>

                <!-- ‰∏ãÂçäÈÉ®ÂàÜÔºöÊ≠åÊõ≤ÁÆ°ÁêÜ -->
                <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden; background-color: #f2f2f7;">
                    <!-- ÂØºËà™Ê†è -->
                    <div class="chat-settings-nav" style="margin: 10px 16px; background-color: #fff;">
                        <div class="nav-item active" id="tab-music-list">Ê≠åÊõ≤ÂàóË°®</div>
                        <div class="nav-item" id="tab-music-upload">‰∏ä‰º†Ê≠åÊõ≤</div>
                        <div class="nav-indicator" id="music-nav-indicator" style="width: calc(50% - 4px);"></div>
                    </div>

                    <!-- Ê≠åÊõ≤ÂàóË°®È°µ -->
                    <div id="music-view-list" class="music-tab-content active" style="flex: 1; overflow-y: auto; padding: 0 16px calc(20px + env(safe-area-inset-bottom));">
                        <div class="ios-list-group" id="music-playlist">
                            <!-- Ê≠åÊõ≤ÂàóË°®È°π -->
                        </div>
                        <div class="empty-state" id="music-empty-state" style="display: none;">ÊöÇÊó†Ê≠åÊõ≤</div>
                    </div>

                    <!-- ‰∏ä‰º†Ê≠åÊõ≤È°µ -->
                    <div id="music-view-upload" class="music-tab-content" style="flex: 1; overflow-y: auto; padding: 0 16px calc(20px + env(safe-area-inset-bottom)); display: none;">
                        <div class="ios-list-group">
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Ê≠åÊõ≤Êñá‰ª∂</label>
                                    <div class="input-row full-width">
                                        <button id="upload-music-btn" class="ios-btn-block secondary">ÈÄâÊã©Êñá‰ª∂</button>
                                        <input type="file" id="music-file-upload" accept="audio/*" class="file-input-hidden">
                                    </div>
                                    <input type="text" id="music-url-input" placeholder="ÊàñËæìÂÖ•Ê≠åÊõ≤ URL" style="margin-top: 10px;">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Âü∫Êú¨‰ø°ÊÅØ</label>
                                    <input type="text" id="input-song-title" placeholder="Ê≠åÂêç">
                                    <input type="text" id="input-artist-name" placeholder="Ê≠åÊâã" style="margin-top: 10px;">
                                </div>
                            </div>
                            <div class="list-item">
                                <div class="list-content column">
                                    <label>Ê≠åËØç (.lrc)</label>
                                    <div class="input-row full-width">
                                        <button id="upload-lyrics-btn" class="ios-btn-block secondary">ÈÄâÊã©Ê≠åËØçÊñá‰ª∂</button>
                                        <input type="file" id="lyrics-file-upload" accept=".lrc" class="file-input-hidden">
                                    </div>
                                    <div id="lyrics-status" style="font-size: 12px; color: #888; margin-top: 5px;">Êú™ÈÄâÊã©Êñá‰ª∂</div>
                                </div>
                            </div>
                            <div class="list-item">
                                <button id="save-new-song" class="ios-btn-block">Ê∑ªÂä†Âà∞ÂàóË°®Âπ∂Êí≠Êîæ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ÂÖ®Â±èApp -->
    <div id="phone-app" class="app-screen hidden" style="background-color: #f2f2f7;">
        <div class="app-header" style="background: transparent; border: none; position: absolute; z-index: 10; padding-left: 20px; backdrop-filter: none; -webkit-backdrop-filter: none; box-shadow: none; height: auto; padding-top: max(47px, env(safe-area-inset-top));">
            <button id="close-phone-app" class="back-btn" style="background: rgba(255,255,255,0.6); width: 32px; height: 32px; border-radius: 50%; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; padding: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.1);"><i class="fas fa-chevron-left" style="margin-right: 2px; font-size: 14px;"></i></button>
        </div>

        <div class="main-content" style="display: block; padding: 0; overflow: hidden; position: relative; height: 100%;">
            <div id="phone-pages-container" class="pages-container">
                <div id="phone-pages-wrapper" class="pages-wrapper">
                    <!-- JS ÁîüÊàê -->
                </div>
            </div>
            <div id="phone-page-indicators" class="page-indicators" style="bottom: 40px;"></div>

            <!-- ÁºñËæëÂ∑•ÂÖ∑Ê†è -->
            <div id="phone-edit-mode-toolbar" class="hidden" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(255, 255, 255, 0.9); padding: 10px 20px; border-radius: 30px; display: flex; gap: 15px; z-index: 200; box-shadow: 0 5px 20px rgba(0,0,0,0.15); backdrop-filter: blur(10px);">
                <button id="phone-add-widget-btn" class="ios-btn-small" style="background:#007AFF;">+</button>
                <button id="phone-save-layout-btn" class="ios-btn-small" style="background:#34C759;">‰øùÂ≠ò</button>
                <button id="phone-exit-edit-btn" class="ios-btn-small">ÈÄÄÂá∫</button>
            </div>
        </div>

        <!-- Êü•ÊâãÊú∫‰∏ìÁî®ÁªÑ‰ª∂Â∫ìÂºπÁ™ó -->
        <div id="phone-widget-library-modal" class="widget-library-modal">
            <div class="library-header">
                <h3 style="margin:0;">ÈÄâÊã©ÁªÑ‰ª∂</h3>
                <button id="phone-close-library-btn" class="ios-btn-small" style="background: #e5e5ea; color: #000;">ÂÖ≥Èó≠</button>
            </div>
            
            <div class="library-body">
                <div style="margin-top: 20px;">
                    <div class="library-section-title">Â∑≤ÂØºÂÖ•</div>
                    <div class="library-scroll-row" id="phone-lib-custom-row">
                        <!-- JS ÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫-ÈÄâÊã©ËÅîÁ≥ª‰∫∫ÂºπÁ™ó -->
    <div id="phone-contact-select-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÈÄâÊã©Ë¶ÅÊü•ÁúãÁöÑÊâãÊú∫</h3>
                <button class="close-btn" id="close-phone-contact-select">&times;</button>
            </div>
            <div class="modal-body">
                <div class="ios-list-group" id="phone-contact-list">
                    <!-- JS ÁîüÊàêËÅîÁ≥ª‰∫∫ÂàóË°® -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ë¥≠Áâ©ÈÄâÈ°πÂºπÁ™ó -->
    <div id="shopping-options-modal" class="modal hidden" style="z-index: 200; align-items: flex-end;">
        <div class="modal-content" style="height: auto; border-radius: 12px 12px 0 0; width: 100%; max-width: 100%; background-color: transparent;">
            <div class="ios-list-group" style="margin: 0 10px; border-radius: 12px; overflow: hidden;">
                <div class="list-item center-content" id="shopping-opt-generate" style="background: white; border-bottom: 1px solid #eee; height: 56px;">
                    <span style="font-size: 18px; color: #007AFF;">ÁîüÊàêÂïÜÂìÅ</span>
                </div>
                <div class="list-item center-content" id="shopping-opt-add" style="background: white; border-bottom: 1px solid #eee; height: 56px;">
                    <span style="font-size: 18px; color: #007AFF;">Êñ∞Â¢ûÂïÜÂìÅ</span>
                </div>
                <div class="list-item center-content" id="shopping-opt-manage" style="background: white; height: 56px;">
                    <span style="font-size: 18px; color: #007AFF;">ÁÆ°ÁêÜÂïÜÂìÅ</span>
                </div>
            </div>
            <div class="ios-list-group" style="margin: 10px 10px 20px 10px; border-radius: 12px; overflow: hidden;">
                <div class="list-item center-content" id="shopping-opt-cancel" style="background: white; height: 56px;">
                    <span style="font-size: 18px; font-weight: bold; color: #007AFF;">ÂèñÊ∂à</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ë¥≠Áâ©Êñ∞Â¢ûÂïÜÂìÅÂºπÁ™ó -->
    <div id="shopping-add-product-modal" class="modal hidden" style="z-index: 210;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Êñ∞Â¢ûÂïÜÂìÅ</h3>
                <button class="close-btn" id="close-shopping-add-product">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>ÂïÜÂìÅÊ†áÈ¢ò</label>
                    <input type="text" id="shopping-add-title" placeholder="ËæìÂÖ•ÂïÜÂìÅÊ†áÈ¢ò">
                </div>
                <div class="setting-group">
                    <label>‰ª∑Ê†º</label>
                    <input type="number" id="shopping-add-price" placeholder="‰æãÂ¶Ç: 99.9">
                </div>
                <div class="setting-group">
                    <label>Â∫óÈì∫ÂêçÁß∞</label>
                    <input type="text" id="shopping-add-shop" placeholder="ËæìÂÖ•Â∫óÈì∫ÂêçÁß∞">
                </div>
                <div class="setting-group">
                    <label>‰ªòÊ¨æ‰∫∫Êï∞</label>
                    <input type="text" id="shopping-add-paid" placeholder="‰æãÂ¶Ç: 100+">
                </div>
                <div class="setting-group">
                    <label>ÂõæÁâáÊèèËø∞ (Áî®‰∫éÁîüÊàêÂõæÁâá)</label>
                    <input type="text" id="shopping-add-desc" placeholder="‰æãÂ¶Ç: Á∫¢Ëâ≤ËøûË°£Ë£ô">
                </div>
                <button id="save-shopping-product-btn" class="ios-btn-block">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Ë¥≠Áâ©ÊîØ‰ªòÊñπÂºèÈÄâÊã©ÂºπÁ™ó -->
    <div id="shopping-payment-choice-modal" class="modal hidden" style="z-index: 220;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÈÄâÊã©Ë¥≠‰π∞ÊñπÂºè</h3>
                <button class="close-btn" id="close-payment-choice">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 20px; font-size: 18px; font-weight: bold;">
                    ÊÄªËÆ°: <span id="payment-choice-total" style="color: #FF5000;">¬•0.00</span>
                </div>
                <button id="payment-choice-self" class="ios-btn-block" style="margin-bottom: 10px;">ÁªôËá™Â∑±‰π∞</button>
                <button id="payment-choice-gift" class="ios-btn-block secondary">ÈÄÅÁªôÊúãÂèã</button>
            </div>
        </div>
    </div>

    <!-- Ë¥≠Áâ©ËßÑÊ†ºÈÄâÊã©ÂºπÁ™ó -->
    <div id="shopping-spec-modal" class="modal hidden" style="z-index: 230;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÈÄâÊã©ËßÑÊ†º</h3>
                <button class="close-btn" id="close-shopping-spec">&times;</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                     <img id="shopping-spec-img" src="" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background: #eee;">
                     <div style="flex: 1;">
                         <div id="shopping-spec-price" style="color: #FF5000; font-size: 18px; font-weight: bold;"></div>
                         <div id="shopping-spec-selected-text" style="font-size: 12px; color: #666; margin-top: 4px;">ËØ∑ÈÄâÊã©ËßÑÊ†º</div>
                     </div>
                </div>
                <div id="shopping-spec-container" style="margin-bottom: 20px; max-height: 300px; overflow-y: auto;">
                    <!-- Âä®ÊÄÅÁîüÊàêËßÑÊ†ºÈÄâÈ°π -->
                </div>
                <button id="confirm-shopping-spec-btn" class="ios-btn-block">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ - ÂæÆ‰ø° -->
    <div id="phone-wechat" class="sub-screen hidden" style="z-index: 200;">
        <div class="app-header" id="phone-wechat-header" style="background: transparent; border: none; position: absolute; top: 0; left: 0; width: 100%; z-index: 10; padding-left: 20px; backdrop-filter: none; -webkit-backdrop-filter: none; box-shadow: none; height: auto; padding-top: max(47px, env(safe-area-inset-top)); justify-content: space-between;">
            <button class="icon-btn" id="phone-wechat-back-btn" onclick="document.getElementById('phone-wechat').classList.add('hidden')" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5);"><i class="fas fa-chevron-left"></i></button>
            <h3 id="phone-wechat-title" style="display: none; color: #000;">ÂæÆ‰ø°</h3>
            <button class="icon-btn" id="generate-wechat-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5);"><i class="fas fa-camera"></i></button>
        </div>
        
        <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°ÜÔºåÁî®‰∫éÊõ¥Êç¢ÊúãÂèãÂúàËÉåÊôØ -->
        <input type="file" id="phone-wechat-bg-input" accept="image/*" class="file-input-hidden">
        
        <div class="app-body" style="padding: 0; padding-bottom: 60px;">
            <!-- Tab 1: ËÅîÁ≥ª‰∫∫ -->
            <div id="phone-wechat-tab-contacts" class="phone-wechat-tab-content active" style="display:none; padding-top: 91px; padding-left: 16px; padding-right: 16px;">
                <div class="ios-list-group" style="margin-top: 10px;">
                    <div class="list-item" style="justify-content: center; color: #999;">ÊöÇÊó†ËÅîÁ≥ª‰∫∫</div>
                </div>
            </div>
            
            <!-- Tab 2: ÊúãÂèãÂúà -->
            <div id="phone-wechat-tab-moments" class="phone-wechat-tab-content" style="display:block;">
                <div class="moments-header">
                    <div class="moments-cover" id="phone-wechat-cover" style="background-image: url('https://placehold.co/600x400/333/999'); cursor: default;">
                        <div class="moments-user-info">
                            <span class="moments-user-name" id="phone-wechat-user-name">User</span>
                            <img class="moments-user-avatar" id="phone-wechat-user-avatar" src="">
                        </div>
                    </div>
                </div>
                <div class="moments-list" id="phone-wechat-moments-list">
                    <!-- Âä®ÊÄÅÂàóË°® -->
                    <div style="text-align: center; padding: 40px; color: #999;">ÁÇπÂáªÂè≥‰∏äËßíÁîüÊàêÂä®ÊÄÅ</div>
                </div>
            </div>
        </div>

        <!-- Â∫ïÈÉ® Tab Ê†è -->
        <div class="wechat-tab-bar" style="width: 100%; left: 0; bottom: 0; right: 0; border-radius: 0; padding-bottom: calc(15px + env(safe-area-inset-bottom)); padding-top: 15px; margin-bottom: 0; height: auto;">
            <div class="wechat-tab-item" onclick="switchPhoneWechatTab('contacts')">
                <i class="fas fa-address-book"></i>
                <span>ÈÄöËÆØÂΩï</span>
            </div>
            <div class="wechat-tab-item active" onclick="switchPhoneWechatTab('moments')">
                <i class="fas fa-star"></i>
                <span>ÊúãÂèãÂúà</span>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ - ÂæÆÂçö -->
    <div id="phone-weibo" class="sub-screen hidden" style="z-index: 200;">
        <div class="app-header">
            <button class="back-btn" onclick="document.getElementById('phone-weibo').classList.add('hidden')"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>ÂæÆÂçö</h3>
            <button class="icon-btn" id="generate-weibo-btn" style="font-size: 14px;">ÁîüÊàê</button>
        </div>
        <div class="app-body">
            <div id="phone-weibo-content"></div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ - iCity -->
    <div id="phone-icity" class="sub-screen hidden" style="z-index: 200;">
        <div class="app-header">
            <button class="back-btn" onclick="document.getElementById('phone-icity').classList.add('hidden')"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>iCity</h3>
            <button class="icon-btn" id="generate-icity-btn" style="font-size: 14px;">ÁîüÊàê</button>
        </div>
        <div class="app-body">
            <div id="phone-icity-content"></div>
        </div>
    </div>

    <!-- icity App -->
    <div id="icity-app" class="app-screen hidden" style="background-color: #f2f2f7;">
        
        <!-- Tab 0: Books (New) -->
        <div id="icity-tab-content-books" class="icity-tab-content" style="display: none; height: 100%; flex-direction: column;">
            <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0; justify-content: center; position: relative; padding-top: max(10px, env(safe-area-inset-top));">
                <button onclick="document.getElementById('icity-app').classList.add('hidden')" style="position: absolute; left: 15px; background: none; border: none; font-size: 16px; color: #333;"><i class="fas fa-chevron-left"></i></button>
                <div style="font-weight: bold; font-size: 17px;">‰π¶Êû∂</div>
                <button id="icity-add-book-btn" style="position: absolute; right: 15px; background: none; border: none; font-size: 20px; color: #333;"><i class="fas fa-plus"></i></button>
            </div>
            <div class="app-body" id="icity-books-list" style="padding: 0; padding-bottom: 60px; overflow-x: auto; overflow-y: hidden; background-color: #fff; flex: 1; display: flex; align-items: center; scroll-snap-type: x mandatory; position: relative;">
                <!-- Books generated here -->
            </div>
        </div>

        <!-- Tab 1: Profile (Current Content) -->
        <div id="icity-tab-content-profile" class="icity-tab-content" style="display: none; flex: 1; width: 100%; flex-direction: column;">
            <div class="app-header" style="position: absolute; top: 0; left: 0; width: 100%; z-index: 10; background: transparent; backdrop-filter: none; -webkit-backdrop-filter: none; border: none; justify-content: space-between; padding-left: 10px; padding-right: 10px; padding-top: max(10px, env(safe-area-inset-top)); pointer-events: none;">
                 <button id="close-icity-app" class="icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); pointer-events: auto;"><i class="fas fa-cog"></i></button>
                 <div style="flex: 1;"></div>
                 <button class="icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); pointer-events: auto;"><i class="fas fa-paper-plane"></i></button>
            </div>

            <div class="app-body" style="padding: 0; padding-bottom: max(20px, env(safe-area-inset-bottom)); overflow-y: auto; background-color: #fff; flex: 1; min-height: 0;">
                 <!-- Header BG -->
                 <div id="icity-bg-trigger" style="height: 280px; background-color: #eee; background-size: cover; background-position: center; position: relative; cursor: pointer;">
                 </div>
                 
                 <!-- Content -->
                 <div style="background: #fff; position: relative; border-radius: 20px 20px 0 0; padding-bottom: 20px; min-height: 500px; margin-top: 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05);">
                     <div style="display: flex; flex-direction: column; align-items: center; transform: translateY(-100px); margin-bottom: -70px;">
                         <!-- Avatar -->
                         <div id="icity-avatar-trigger" style="width: 130px; height: 130px; background: #000; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background-size: cover; background-position: center; cursor: pointer;"></div>
                         
                         <!-- Name etc -->
                         <div style="margin-top: 10px; text-align: center;">
                             <div style="font-size: 24px; font-weight: bold;">Kaneki</div>
                             <div style="color: #999; font-size: 14px;">@heanova1</div>
                             <div style="display: flex; gap: 10px; margin-top: 10px; justify-content: center;">
                                 <span id="icity-titles-btn" style="background: #f0f0f0; color: #666; font-size: 12px; padding: 2px 8px; border-radius: 10px; cursor: pointer;">+ ÊàëÁöÑÂ∏ÇÊ∞ëÁß∞Âè∑</span>
                                 <span id="icity-badges-btn" style="background: #f0f0f0; color: #666; font-size: 12px; padding: 2px 8px; border-radius: 10px; cursor: pointer;">
                                    <span id="icity-equipped-badge-icon"></span>
                                    <span id="icity-equipped-badge-name">+ ÂããÁ´†</span>
                                 </span>
                             </div>
                             <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                             <button id="icity-edit-profile-btn" style="border: 1px solid #ddd; background: #fff; padding: 8px 15px; border-radius: 4px; display: flex; align-items: center; gap: 5px; color: #666;"><i class="fas fa-pen"></i> ‰øÆÊîπËµÑÊñô</button>
                             <button style="border: 1px solid #ddd; background: #fff; padding: 8px 15px; border-radius: 4px; display: flex; align-items: center; gap: 5px; color: #666;"><i class="fas fa-comment"></i> ÁßÅ‰ø°</button>
                             <button id="icity-settings-btn" style="border: 1px solid #ddd; background: #fff; padding: 8px; border-radius: 4px; color: #666;"><i class="fas fa-cog"></i></button>
                         </div>
                     </div>
                 </div>
                     
                     <div style="display: flex; justify-content: center; gap: 20px; margin-top: -20px; border-top: 1px solid #f0f0f0; padding-top: 15px;">
                         <div style="font-size: 14px; color: #999;"><span id="icity-followers-count" style="color: #007AFF; font-size: 16px; font-weight: bold;">0</span> ÂÖ≥Ê≥®ËÄÖ</div>
                         <div style="font-size: 14px; color: #999;"><span id="icity-friends-count" style="color: #007AFF; font-size: 16px; font-weight: bold;">0</span> ÊúãÂèã</div>
                         <div style="font-size: 14px; color: #999;"><span id="icity-diary-count" style="color: #007AFF; font-size: 16px; font-weight: bold;">0</span> Êó•ËÆ∞</div>
                         <div style="font-size: 14px; color: #999;"><span id="icity-likes-count" style="color: #007AFF; font-size: 16px; font-weight: bold;">0</span> Ë¢´ÂñúÊ¨¢</div>
                     </div>

                     <div class="icity-menu-list" style="padding: 0 20px;">
                        <div id="open-icity-calendar" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer;">
                            <span style="font-size: 16px; font-weight: bold;">ÊàëÁöÑÊó•ÂéÜ</span>
                            <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                        </div>
                     </div>

                     <div class="icity-diary-list" style="padding: 15px; background: #fff; margin-top: 10px;">
                     </div>
                 </div>
                 
                 <!-- Inputs -->
                 <input type="file" id="icity-bg-input" accept="image/*" class="file-input-hidden">
                 <input type="file" id="icity-avatar-input" accept="image/*" class="file-input-hidden">
            </div>
        </div>

        <!-- Tab 2: World (New) -->
        <div id="icity-tab-content-world" class="icity-tab-content" style="display: block; height: 100%;">
            <div class="app-header" style="background: #fff; border-bottom: 1px solid #eee; justify-content: center; padding-top: max(10px, env(safe-area-inset-top)); position: relative;">
                <button onclick="document.getElementById('icity-app').classList.add('hidden')" style="position: absolute; left: 15px; background: none; border: none; font-size: 16px; color: #333;"><i class="fas fa-chevron-left"></i></button>
                <div style="display: flex; gap: 20px; font-size: 16px;">
                    <span id="icity-header-world" style="font-weight: bold; border-bottom: 2px solid #000; padding-bottom: 5px; cursor: pointer;" onclick="window.switchIcityFeedTab('world')">‰∏ñÁïå</span>
                    <span id="icity-header-friends" style="color: #999; cursor: pointer;" onclick="window.switchIcityFeedTab('friends')">ÊúãÂèã</span>
                    <span id="icity-header-notifications" style="color: #999; cursor: pointer;" onclick="window.switchIcityFeedTab('notifications')">@ ÈÄöÁü•</span>
                    <span id="icity-header-likes" style="color: #999; cursor: pointer;" onclick="window.switchIcityFeedTab('likes')">‚ô° ÂñúÊ¨¢</span>
                </div>
                <button id="icity-world-generate-btn" style="position: absolute; right: 15px; background: none; border: none; color: #007AFF; font-size: 16px;"><i class="fas fa-magic"></i></button>
            </div>
            
            <div class="app-body" style="padding: 0; padding-bottom: 60px; overflow-y: auto; background-color: #fff; flex: 1;">
                <div id="icity-world-list">
                    <!-- World content will be generated here -->
                    <div style="text-align: center; padding: 50px; color: #999;">
                        ÁÇπÂáªÂè≥‰∏äËßíÁîüÊàêÂä®ÊÄÅ
                    </div>
                </div>
                <div id="icity-notifications-list" style="display: none;"></div>
                <div id="icity-likes-list" style="display: none;"></div>
            </div>
        </div>

        <!-- Tab 3: Messages -->
        <div id="icity-tab-content-messages" class="icity-tab-content" style="display: none; height: 100%; flex-direction: column;">
            <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0; justify-content: center; position: relative;">
                <button onclick="document.getElementById('icity-app').classList.add('hidden')" style="position: absolute; left: 15px; background: none; border: none; font-size: 16px; color: #333;"><i class="fas fa-chevron-left"></i></button>
                <div style="display: flex; background: #f0f0f0; border-radius: 8px; padding: 2px;">
                    <div style="padding: 4px 15px; font-size: 14px; color: #666; cursor: pointer;">ÈÄöËÆØÂΩï</div>
                    <div style="padding: 4px 15px; font-size: 14px; font-weight: bold; background: #fff; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer;">ÁßÅ‰ø°</div>
                </div>
                <button style="position: absolute; right: 15px; background: none; border: none; font-size: 20px; color: #666;"><i class="far fa-plus-square"></i></button>
            </div>
            
            <div class="app-body" id="icity-messages-list" style="padding: 0; padding-bottom: 60px; overflow-y: auto; background-color: #fff; flex: 1;">
                <!-- Messages list will be generated here -->
                <div class="empty-state" id="icity-messages-empty" style="text-align: center; padding: 50px; color: #999; display: none;">
                    ÊöÇÊó†ÁßÅ‰ø°
                </div>
            </div>
        </div>

        <div class="icity-tab-bar">
            <button class="icon-btn" id="icity-nav-books" style="color: #ccc;"><i class="fas fa-book"></i></button>
            <button class="icon-btn" id="icity-nav-world" style="color: #000;"><i class="fas fa-globe"></i></button>
            <div id="icity-nav-compose" style="width: 40px; height: 40px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: #007AFF; cursor: pointer;"><i class="fas fa-pen-nib"></i></div>
            <button class="icon-btn" id="icity-nav-messages" style="color: #ccc;"><i class="far fa-comment"></i></button>
            <div id="icity-tab-me" style="width: 24px; height: 24px; background: #000; border-radius: 50%; border: 2px solid #007AFF; background-size: cover; background-position: center; cursor: pointer;"></div>
        </div>
    </div>

    <!-- icity Compose Modal -->
    <div id="icity-compose-modal" class="app-screen hidden" style="z-index: 200; background-color: #fff; display: flex; flex-direction: column;">
        <div style="padding: 47px 15px 10px; padding-top: max(47px, env(safe-area-inset-top)); display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; flex-shrink: 0;">
            <div id="icity-compose-avatar" style="width: 36px; height: 36px; background: #000; border-radius: 50%; margin-right: 10px; background-size: cover; background-position: center;"></div>
            <input type="text" placeholder="Ê†áÈ¢ò (ÂèØÈÄâ)" style="flex: 1; border: none; font-size: 16px; outline: none; background: transparent; color: #000;">
            <button id="close-icity-compose" style="background: none; border: none; font-size: 24px; color: #ccc; cursor: pointer;">&times;</button>
        </div>
        <textarea id="icity-compose-text" style="width: 100%; flex: 1; border: none; padding: 15px; font-size: 16px; resize: none; outline: none; background: transparent; color: #000;" placeholder="ÂÜôÁÇπ‰ªÄ‰πàÂêß"></textarea>
        
        <!-- Footer -->
        <div style="width: 100%; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; background: #fff; border-top: 1px solid #f0f0f0; padding-bottom: max(10px, env(safe-area-inset-bottom)); flex-shrink: 0;">
            <div style="display: flex; gap: 20px; color: #007AFF; font-size: 22px;">
                <i class="fas fa-camera"></i>
                <i class="fas fa-map-marker-alt"></i>
                <i class="fas fa-mobile-alt"></i>
            </div>
            <div style="display: flex; gap: 10px; align-items: flex-end;">
                 <div style="position: relative;">
                     <div id="icity-visibility-menu" class="hidden" style="position: absolute; bottom: 45px; right: 0; background: #fff; box-shadow: 0 2px 15px rgba(0,0,0,0.15); border-radius: 8px; padding: 5px; width: 100px; display: flex; flex-direction: column; gap: 2px;">
                         <div class="icity-vis-item" data-val="public" style="padding: 8px; font-size: 14px; border-radius: 4px; cursor: pointer; color: #666; display: flex; align-items: center; gap: 8px;"><i class="fas fa-globe"></i> ÂÖ¨ÂºÄ</div>
                         <div class="icity-vis-item" data-val="friends" style="padding: 8px; font-size: 14px; border-radius: 4px; cursor: pointer; color: #666; display: flex; align-items: center; gap: 8px;"><i class="fas fa-user-friends"></i> ‰ªÖÂ•ΩÂèã</div>
                         <div class="icity-vis-item active" data-val="private" style="padding: 8px; font-size: 14px; border-radius: 4px; cursor: pointer; background-color: #007AFF; color: #fff; display: flex; align-items: center; gap: 8px;"><i class="fas fa-lock"></i> ÁßÅÂØÜ</div>
                     </div>
                     <button id="icity-visibility-btn" style="background: none; border: none; color: #666; font-size: 14px; display: flex; align-items: center; gap: 5px; padding: 6px 10px; background: #f0f0f0; border-radius: 4px; cursor: pointer;">
                         <i class="fas fa-lock"></i> <span>ÁßÅÂØÜ</span>
                     </button>
                 </div>
                 <button id="icity-send-btn" style="background: #4CD964; color: #fff; border: none; padding: 6px 15px; border-radius: 4px; font-size: 14px; font-weight: bold; cursor: pointer;">ÂèëÈÄÅ</button>
            </div>
        </div>
    </div>

    <!-- iCity All Diaries Screen -->
    <div id="icity-all-diaries-screen" class="app-screen hidden" style="background-color: #f2f2f7; z-index: 210;">
        <div class="app-header" style="background: #fff; border-bottom: none;">
            <button class="back-btn" id="close-icity-all-diaries"><i class="fas fa-chevron-left"></i></button>
            <div style="flex: 1; text-align: center; font-weight: bold; font-size: 17px;" id="icity-all-diaries-title">
                Kaneki ¬∑ Êó•ËÆ∞
            </div>
            <div style="width: 60px;"></div>
        </div>
        
        <!-- Tabs -->
        <div class="icity-diary-tabs" style="display: flex; justify-content: space-around; border-bottom: 1px solid #f0f0f0; padding: 10px 0; font-size: 14px; background: #fff;">
            <div class="icity-diary-tab active" data-tab="all" style="font-weight: bold; color: #fff; padding: 5px 15px; border-radius: 15px; background: #7C9BF8;">ÂÖ®ÈÉ®</div>
            <div class="icity-diary-tab" data-tab="public" style="color: #999; padding: 5px 15px;">ÂÖ¨ÂºÄ</div>
            <div class="icity-diary-tab" data-tab="friends" style="color: #999; padding: 5px 15px;">‰ªÖÂ•ΩÂèã</div>
            <div class="icity-diary-tab" data-tab="private" style="color: #999; padding: 5px 15px;">ÁßÅÂØÜ</div>
            <div class="icity-diary-tab" data-tab="archived" style="color: #999; padding: 5px 15px;">Â∑≤Â∞ÅÂ≠ò</div>
        </div>

        <div class="app-body" style="padding: 0; padding-bottom: 20px; overflow-y: auto;">
            <div id="icity-all-diaries-list" style="padding: 0;">
                <!-- Full diary list here -->
            </div>
        </div>
    </div>

    <!-- iCity Edit Profile Screen -->
    <div id="icity-edit-profile-screen" class="app-screen hidden" style="background-color: #f2f2f7; z-index: 220;">
        <div class="app-header" style="background: #fff; border-bottom: 1px solid #eee;">
            <button class="back-btn" id="close-icity-edit-profile"><i class="fas fa-chevron-left"></i></button>
            <h3 style="flex: 1; text-align: center;">ÁºñËæëËµÑÊñô</h3>
            <button class="wechat-icon-btn" id="save-icity-profile-btn" style="width: auto; font-size: 16px; color: #007AFF; font-weight: bold;">‰øùÂ≠ò</button>
        </div>
        <div class="app-body" style="padding: 20px;">
            <div class="ios-list-group">
                <div class="list-item">
                    <div class="list-content column">
                        <label>ÊòµÁß∞</label>
                        <input type="text" id="icity-edit-nickname" placeholder="Kaneki" value="Kaneki" style="width: 100%; margin-top: 5px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                <div class="list-item">
                    <div class="list-content column">
                        <label>ID</label>
                        <input type="text" id="icity-edit-id" placeholder="@heanova1" value="@heanova1" style="width: 100%; margin-top: 5px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- iCity Calendar Screen -->
    <div id="icity-calendar-screen" class="app-screen hidden" style="background-color: #fff; z-index: 250;">
        <div class="app-header" style="background: #fff; border-bottom: none;">
            <button class="back-btn" id="close-icity-calendar"><i class="fas fa-chevron-left"></i></button>
            <div style="flex: 1; text-align: center; font-weight: bold; font-size: 17px;">
                ÊàëÁöÑÊó•ÂéÜ ¬∑ Calendar
            </div>
            <div style="width: 60px;"></div>
        </div>
        
        <div class="app-body" style="padding: 0; overflow-y: auto;">
            <!-- Year Selector -->
            <div id="icity-calendar-years" style="display: flex; justify-content: center; gap: 20px; padding: 10px 0; font-size: 16px; color: #ccc; font-weight: bold; position: sticky; top: 0; background: #fff; z-index: 10;">
                <!-- JS Generated -->
            </div>

            <div style="padding: 20px;">
                <!-- Stats Card -->
                <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                    <div style="display: flex; flex-direction: column; justify-content: center;">
                        <div style="font-size: 16px; color: #666; margin-bottom: 5px;">ËÆ∞ÂΩï <span id="icity-calendar-days" style="color: #000; font-weight: bold; font-size: 20px;">0</span> Â§©</div>
                        <div style="font-size: 16px; color: #666;">ÂÜô‰∏ã <span id="icity-calendar-count" style="color: #000; font-weight: bold; font-size: 20px;">0</span> ÁØáÊó•ËÆ∞</div>
                    </div>
                </div>

                <!-- Heatmap -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <div style="display: flex; flex-direction: column; justify-content: space-between; font-size: 10px; color: #999; padding-top: 2px; height: 120px;">
                        <span>1Êúà</span><span>2Êúà</span><span>3Êúà</span><span>4Êúà</span><span>5Êúà</span><span>6Êúà</span>
                        <span>7Êúà</span><span>8Êúà</span><span>9Êúà</span><span>10Êúà</span><span>11Êúà</span><span>12Êúà</span>
                    </div>
<div id="icity-calendar-heatmap" style="flex: 1; display: grid; grid-template-rows: repeat(12, 1fr); grid-template-columns: repeat(31, 1fr); gap: 2px;">
                        <!-- Grid cells -->
                    </div>
                </div>

                <!-- Monthly List -->
                <div id="icity-calendar-months">
                    <!-- JS generated -->
                </div>
            </div>
        </div>
    </div>

    <!-- iCity Stranger Profile Screen -->
    <div id="icity-stranger-profile-screen" class="app-screen hidden" style="background-color: #fff; z-index: 250;">
        <div class="app-header" style="position: absolute; top: 0; left: 0; width: 100%; z-index: 10; background: transparent; backdrop-filter: none; -webkit-backdrop-filter: none; border: none; justify-content: space-between; padding-left: 10px; padding-right: 10px; padding-top: max(10px, env(safe-area-inset-top)); pointer-events: none;">
             <button id="close-icity-stranger-profile" class="icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); pointer-events: auto;"><i class="fas fa-chevron-left"></i></button>
             <div style="flex: 1;"></div>
             <button class="icon-btn" style="color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5); pointer-events: auto;"><i class="fas fa-ellipsis-h"></i></button>
        </div>

        <div class="app-body" style="padding: 0; padding-bottom: 60px; overflow-y: auto; background-color: #fff; height: 100%;">
             <!-- Header BG -->
             <div id="icity-stranger-profile-bg" style="height: 280px; background-color: #eee; background-size: cover; background-position: center; position: relative;"></div>
             
             <!-- Content -->
             <div style="background: #fff; position: relative; border-radius: 20px 20px 0 0; padding-bottom: 20px; min-height: 500px; margin-top: -20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05);">
                 <div style="display: flex; flex-direction: column; align-items: center; transform: translateY(-50px); margin-bottom: -30px;">
                     <!-- Avatar -->
                     <div id="icity-stranger-profile-avatar" style="width: 100px; height: 100px; background: #ccc; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.1); background-size: cover; background-position: center;"></div>
                     
                     <!-- Name etc -->
                     <div style="margin-top: 10px; text-align: center;">
                         <div id="icity-stranger-profile-name" style="font-size: 24px; font-weight: bold;">Name</div>
                         <div id="icity-stranger-profile-id" style="color: #999; font-size: 14px;">@handle</div>
                         
                         <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                             <button id="icity-stranger-add-friend-btn" style="background: #007AFF; color: #fff; border: none; padding: 8px 25px; border-radius: 20px; font-size: 14px; font-weight: bold;">Âä†Â•ΩÂèã</button>
                             <button id="icity-stranger-chat-btn" style="border: 1px solid #ddd; background: #fff; padding: 8px 25px; border-radius: 20px; font-size: 14px; color: #333;">ÁßÅ‰ø°</button>
                         </div>
                     </div>
                 </div>
                 
                 <div class="icity-diary-list" id="icity-stranger-profile-diary-list" style="padding: 15px; background: #fff; margin-top: 10px;">
                     <!-- Diaries will be generated here -->
                 </div>
             </div>
        </div>
    </div>

    <!-- iCity Settings Modal -->
    <div id="icity-settings-modal" class="modal hidden" style="z-index: 230;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ËÆæÁΩÆ</h3>
                <button class="close-btn" id="close-icity-settings-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>ÂÖ≥ËÅîËÅîÁ≥ª‰∫∫ (Áî®‰∫éÊúãÂèãÈ°µÁîüÊàêÂä®ÊÄÅ)</label>
                    <div id="icity-link-contacts-container" style="max-height: 150px; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px; padding: 5px;">
                        <!-- Checkboxes generated by JS -->
                    </div>
                </div>
                <div class="setting-group">
                    <label>ÂÖ≥ËÅî‰∏ñÁïå‰π¶ (Áî®‰∫éÁîüÊàêÂä®ÊÄÅ)</label>
                    <select id="icity-link-wb" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; background-color: #f9f9f9;">
                        <option value="">-- ÈÄâÊã©‰∏ñÁïå‰π¶ --</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label>ËÅîÁ≥ª‰∫∫ iCity ËÆæÂÆö</label>
                    <div id="icity-contact-customization-container" style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px; background: #f9f9f9;">
                        <div style="text-align: center; color: #999; font-size: 12px;">ËØ∑ÂÖàÂãæÈÄâ‰∏äÊñπËÅîÁ≥ª‰∫∫</div>
                    </div>
                </div>

                <button id="save-icity-settings-btn" class="ios-btn-block">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- iCity Add Book Modal -->
    <div id="icity-add-book-modal" class="modal hidden" style="z-index: 250;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ê∑ªÂä†‰π¶Á±ç</h3>
                <button class="close-btn" id="close-icity-add-book">&times;</button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>‰π¶Âêç</label>
                    <input type="text" id="icity-book-name" placeholder="ËæìÂÖ•‰π¶Âêç">
                </div>
                <div class="setting-group">
                    <label>Â∞ÅÈù¢</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <div id="icity-book-cover-preview" style="width: 60px; height: 80px; background: #eee; border-radius: 4px; background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: #999; font-size: 20px;"><i class="fas fa-camera"></i></div>
                        <input type="file" id="icity-book-cover-input" accept="image/*" class="file-input-hidden">
                        <label for="icity-book-cover-input" class="ios-btn" style="margin: 0;">ÈÄâÊã©ÂõæÁâá</label>
                    </div>
                </div>
                <button id="save-icity-book-btn" class="ios-btn-block">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- iCity Badges Screen -->
    <div id="icity-badges-screen" class="app-screen hidden" style="background-color: #fff; z-index: 220;">
        <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0;">
            <button class="back-btn" id="close-icity-badges"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>ÊàëÁöÑÂããÁ´†</h3>
            <div style="width: 60px;"></div>
        </div>
        <div class="app-body" style="padding: 20px; overflow-y: auto;">
            <div style="margin-bottom: 20px; font-size: 14px; color: #666;">
                Â∑≤Ëé∑Âæó: <span id="icity-badges-count" style="font-weight: bold; color: #000;">0</span> / <span id="icity-badges-total" style="font-weight: bold;">0</span>
            </div>
            <div id="icity-badges-list" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                <!-- Badges will be rendered here -->
            </div>
        </div>
    </div>

    <!-- iCity Titles Screen -->
    <div id="icity-titles-screen" class="app-screen hidden" style="background-color: #fff; z-index: 220;">
        <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0;">
            <button class="back-btn" id="close-icity-titles"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>ÊàëÁöÑÁß∞Âè∑</h3>
            <div style="width: 60px;"></div>
        </div>
        <div class="app-body" style="padding: 20px; overflow-y: auto;">
            <div id="icity-titles-list" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: flex-start;">
                <!-- Titles will be rendered here -->
            </div>
        </div>
    </div>

    <!-- iCity Detail Screen -->
    <div id="icity-detail-screen" class="app-screen hidden" style="background-color: #fff; z-index: 230;">
        <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0;">
            <button class="back-btn" id="close-icity-detail"><i class="fas fa-chevron-left"></i></button>
            <div style="flex: 1; text-align: center; font-weight: bold; font-size: 17px;" id="icity-detail-title">
                Kaneki ¬∑ Êó•ËÆ∞
            </div>
            <div style="width: 60px;"></div>
        </div>
        <div class="app-body" style="padding: 0; padding-bottom: 60px; overflow-y: auto;">
            <!-- Content Container -->
            <div id="icity-detail-content" style="padding: 20px;">
                <!-- User Info -->
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <div id="icity-detail-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: #000; margin-right: 10px; background-size: cover; background-position: center;"></div>
                    <div>
                        <div id="icity-detail-name" style="font-weight: bold; font-size: 16px;">Kaneki</div>
                        <div id="icity-detail-handle" style="font-size: 12px; color: #999;">@heanova1</div>
                    </div>
                </div>
                
                <!-- Text -->
                <div id="icity-detail-text" style="font-size: 18px; color: #333; line-height: 1.6; margin-bottom: 15px; white-space: pre-wrap;"></div>
                
                <!-- Meta -->
                <div style="display: flex; justify-content: space-between; color: #ccc; font-size: 12px; margin-bottom: 15px;">
                    <span id="icity-detail-time">2025-08-23 02:24</span>
                    <span id="icity-detail-visibility"><i class="fas fa-lock"></i> ÁßÅÂØÜ</span>
                </div>
                
                <!-- Action Bar -->
                <div style="display: flex; justify-content: space-around; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; padding: 10px 0; color: #666; font-size: 14px;">
                    <div style="display: flex; align-items: center; gap: 5px; cursor: pointer;"><i class="far fa-heart"></i> ÂñúÊ¨¢</div>
                    <div style="display: flex; align-items: center; gap: 5px; cursor: pointer;"><i class="far fa-comment-alt"></i> Â∞èÁ∫∏Êù°</div>
                    <div style="display: flex; align-items: center; gap: 5px; cursor: pointer;"><i class="far fa-image"></i> Â≠ò‰∏∫ÂõæÁâá</div>
                    <div style="display: flex; align-items: center; gap: 5px; cursor: pointer;"><i class="fas fa-ellipsis-h"></i></div>
                </div>
                
                <!-- Comments Section -->
                <div style="margin-top: 15px;">
                    <div style="font-size: 14px; color: #999; margin-bottom: 15px;" id="icity-detail-comments-count">0 Êù°ËØÑËÆ∫ <i class="fas fa-chevron-down"></i></div>
                    <div id="icity-detail-comments-list">
                        <!-- Comments will go here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Input Bar -->
        <div style="position: absolute; bottom: 0; left: 0; width: 100%; padding: 10px 15px; background: #fff; border-top: 1px solid #f0f0f0; padding-bottom: max(10px, env(safe-area-inset-bottom)); display: flex; gap: 10px; align-items: center;">
            <input type="text" id="icity-comment-input" placeholder="ÊàëË¶ÅËØÑËÆ∫" style="flex: 1; border: 1px solid #ddd; border-radius: 4px; padding: 8px 10px; font-size: 14px; outline: none;">
            <button id="icity-comment-send-btn" style="background: #4CD964; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; font-size: 14px; cursor: pointer;"><i class="fas fa-paper-plane"></i> ÂèëÈÄÅ</button>
        </div>
    </div>

    <!-- iCity Message Detail Screen -->
    <div id="icity-message-detail-screen" class="app-screen hidden" style="background-color: #fff; z-index: 240; display: flex; flex-direction: column;">
        <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0;">
            <button class="back-btn" id="close-icity-message-detail"><i class="fas fa-chevron-left"></i></button>
            <div style="flex: 1; text-align: center;">
                <div style="font-weight: bold; font-size: 16px;" id="icity-message-detail-name">iCity Â∏ÇÊîøÂéÖ</div>
                <div style="font-size: 10px; color: #999;" id="icity-message-detail-handle">@icity</div>
            </div>
            <button class="icon-btn" style="color: #ccc;"><i class="fas fa-ellipsis-h"></i></button>
        </div>
        
        <div class="app-body" id="icity-message-detail-body" style="padding: 15px; padding-bottom: 60px; overflow-y: auto; flex: 1; display: flex; flex-direction: column;">
            <!-- Messages Container -->
            <div id="icity-message-detail-list">
                <!-- Messages will be injected here -->
            </div>
        </div>
        
        <!-- Bottom Input Bar -->
        <div style="background: #fff; padding: 10px 15px; border-top: 1px solid #f0f0f0; padding-bottom: max(10px, env(safe-area-inset-bottom)); display: flex; align-items: center; gap: 10px; flex-shrink: 0;">
            <input type="text" id="icity-message-input" style="flex: 1; border: 1px solid #ddd; border-radius: 4px; padding: 8px 10px; font-size: 14px; outline: none;">
            <button id="icity-message-send-btn" style="background: #4CD964; color: #fff; border: none; padding: 8px 15px; border-radius: 4px; font-size: 14px; cursor: pointer;"><i class="fas fa-paper-plane"></i> ÂèëÈÄÅ</button>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ - ÊµèËßàÂô® -->
    <div id="phone-browser" class="sub-screen hidden" style="z-index: 200; background-color: #fff; display: flex; flex-direction: column;">
        <!-- È°∂ÈÉ®ÂØºËà™Ê†è -->
        <div class="browser-header" style="padding-top: max(47px, env(safe-area-inset-top)); padding-left: 20px; padding-right: 20px; padding-bottom: 10px; display: flex; align-items: center; justify-content: space-between;">
             <div class="header-left" onclick="document.getElementById('phone-browser').classList.add('hidden')" style="display: flex; align-items: center; gap: 10px; color: #333; cursor: pointer;">
                 <i class="fas fa-search" style="font-size: 18px;"></i>
                 <span style="font-size: 18px; font-weight: 500;">‰∏ªÈ°µ</span>
             </div>
             <div class="header-right">
                 <!-- Âè≥‰∏äËßíÁîüÊàêÊåâÈíÆ -->
                 <button id="generate-browser-btn" class="icon-btn" style="color: #333; font-size: 20px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: transparent; border: none;">
                    <i class="fas fa-expand"></i>
                 </button>
             </div>
        </div>

        <!-- ‰∏ª‰ΩìÂÜÖÂÆπ -->
        <div class="app-body" id="browser-app-body" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding-bottom: 100px; width: 100%;">
             <!-- Logo (ÊõøÊç¢‰∏∫Â§öÂΩ©ÂõæÊ†á) -->
             <div id="browser-logo" class="browser-logo" style="margin-bottom: 50px; transition: opacity 0.3s ease;">
                 <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #007AFF, #5AC8FA); border-radius: 20px; display: flex; align-items: center; justify-content: center; transform: rotate(-10deg); box-shadow: 0 10px 20px rgba(0, 122, 255, 0.3);">
                     <i class="fas fa-compass" style="font-size: 48px; color: #fff; transform: rotate(10deg);"></i>
                 </div>
             </div>

             <!-- ÊêúÁ¥¢Âå∫ÂüüÂåÖË£ÖÂô® (Áî®‰∫éÁªùÂØπÂÆö‰ΩçËÆ∞ÂΩï) -->
             <div style="position: relative; width: 100%; display: flex; flex-direction: column; align-items: center;">
                 <!-- ÊêúÁ¥¢ËÆ∞ÂΩï (ÂàùÂßãÈöêËóèÔºåÁªùÂØπÂÆö‰ΩçÂú®ÊêúÁ¥¢Ê°Ü‰∏äÊñπ) -->
                 <div id="browser-search-records" class="hidden" style="position: absolute; bottom: 100%; width: 100%; padding: 0 20px; margin-bottom: 40px; max-height: 60vh; overflow-y: auto;">
                     <!-- Header -->
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 10px;">
                         <button class="icon-btn" onclick="exitBrowserSearchMode()" style="color: #333; font-size: 18px; padding: 5px;"><i class="fas fa-chevron-left"></i></button>
                         <div style="display: flex; gap: 15px; color: #999; font-size: 14px; align-items: center;">
                             <i class="far fa-trash-alt"></i>
                             <span>ÂéÜÂè≤ <i class="fas fa-chevron-up"></i></span>
                         </div>
                     </div>
                 <!-- Grid -->
                 <div id="browser-search-records-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px 20px;">
                     <!-- Generated records will appear here -->
                 </div>
             </div>
                 
                 <!-- ÊêúÁ¥¢Ê°Ü -->
                 <div id="browser-search-bar" class="browser-search-bar" onclick="enterBrowserSearchMode()" style="width: 85%; height: 50px; border: 1px solid #e0e0e0; border-radius: 25px; display: flex; align-items: center; padding: 0 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); background-color: #f9f9f9; cursor: text; transition: all 0.3s ease; z-index: 10;">
                     <input id="browser-search-input" type="text" placeholder="ÊêúÁ¥¢ÊàñËæìÂÖ•ÁΩëÂùÄ" readonly style="border: none; outline: none; width: 100%; font-size: 16px; text-align: center; background: transparent; color: #333; pointer-events: none;">
                     <i id="browser-search-icon" class="fas fa-search" style="color: #999; font-size: 16px; display: none;"></i>
                 </div>
             </div>

             <!-- ÁîüÊàêÂÜÖÂÆπÂ±ïÁ§∫ÂÆπÂô® -->
             <div id="phone-browser-content" style="width: 100%; margin-top: 30px; padding: 0 20px; overflow-y: auto; max-height: 40vh;">
                 <!-- ÁîüÊàêÁöÑÂéÜÂè≤ËÆ∞ÂΩï/‰π¶Á≠æÂ∞ÜÊòæÁ§∫Âú®ËøôÈáå -->
             </div>
        </div>

        <!-- Â∫ïÈÉ®Â∑•ÂÖ∑Ê†è -->
        <div class="browser-nav-bar" style="border-top: 1px solid #f0f0f0; display: flex; justify-content: space-around; align-items: center; padding-top: 12px; padding-bottom: max(20px, env(safe-area-inset-bottom)); background-color: #fff;">
             <button class="nav-btn" style="color: #333; font-size: 20px; padding: 10px; background: transparent; border: none;"><i class="fas fa-chevron-left"></i></button>
             <button class="nav-btn" style="color: #ccc; font-size: 20px; padding: 10px; background: transparent; border: none;"><i class="fas fa-chevron-right"></i></button>
             <button class="nav-btn" style="color: #333; font-size: 22px; padding: 10px; background: transparent; border: none;"><i class="fas fa-home"></i></button>
             <button class="nav-btn" style="padding: 10px; background: transparent; border: none;">
                <div style="font-size: 12px; border: 2px solid #333; border-radius: 4px; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
             </button>
             <button class="nav-btn" onclick="openBrowserMenu()" style="color: #333; font-size: 20px; padding: 10px; background: transparent; border: none;"><i class="fas fa-bars"></i></button>
        </div>

        <!-- ÊµèËßàÂô®ËèúÂçïÂºπÁ™ó -->
        <div id="browser-menu-modal" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 100;">
            <div class="menu-backdrop" style="width: 100%; height: 100%; background: rgba(0,0,0,0.4); transition: opacity 0.3s;" onclick="closeBrowserMenu()"></div>
            <div id="browser-menu-panel" class="menu-panel" style="position: absolute; bottom: 0; width: 100%; background: #f2f2f7; border-radius: 20px 20px 0 0; padding: 25px 15px 15px 15px; display: flex; flex-direction: column; align-items: center; box-sizing: border-box; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);">
                <div class="menu-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); width: 100%; row-gap: 20px; margin-bottom: 10px;">
                    <!-- Row 1 -->
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="far fa-moon"></i></div>
                        <span style="font-size: 11px; color: #333;">Â§úÈó¥Ê®°Âºè</span>
                    </div>
                    <div class="menu-item" onclick="openBrowserBookmarks()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                        <div style="font-size: 24px; color: #333;"><i class="far fa-star"></i></div>
                        <span style="font-size: 11px; color: #333;">‰π¶Á≠æ</span>
                    </div>
                    <div class="menu-item" onclick="openBrowserHistory()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                        <div style="font-size: 24px; color: #333;"><i class="far fa-clock"></i></div>
                        <span style="font-size: 11px; color: #333;">ÂéÜÂè≤</span>
                    </div>
                    <div class="menu-item" onclick="openBrowserDownloads()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-arrow-down"></i></div>
                        <span style="font-size: 11px; color: #333;">‰∏ãËΩΩ</span>
                    </div>
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-mask"></i></div>
                        <span style="font-size: 11px; color: #333;">ÈöêË∫´Ê®°Âºè</span>
                    </div>

                    <!-- Row 2 -->
                    <div class="menu-item" onclick="openBrowserShare()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-share-alt"></i></div>
                        <span style="font-size: 11px; color: #333;">ÂàÜ‰∫´</span>
                    </div>
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-star-half-alt"></i></div>
                        <span style="font-size: 11px; color: #333;">Ê∑ªÂä†‰π¶Á≠æ</span>
                    </div>
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-desktop"></i></div>
                        <span style="font-size: 11px; color: #333;">ÁîµËÑëÊ®°Âºè</span>
                    </div>
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-briefcase"></i></div>
                        <span style="font-size: 11px; color: #333;">Â∑•ÂÖ∑ÁÆ±</span>
                    </div>
                    <div class="menu-item" style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 24px; color: #333;"><i class="fas fa-cog"></i></div>
                        <span style="font-size: 11px; color: #333;">ËÆæÁΩÆ</span>
                    </div>
                </div>

                <!-- Footer -->
                <div style="margin-top: 15px; display: flex; flex-direction: column; align-items: center; gap: 10px; width: 100%;">
                     <!-- Pagination dots -->
                     <div style="display: flex; gap: 6px;">
                         <div style="width: 5px; height: 5px; background: #888; border-radius: 50%;"></div>
                         <div style="width: 5px; height: 5px; background: #d1d1d6; border-radius: 50%;"></div>
                     </div>
                     <!-- Close chevron -->
                     <div onclick="closeBrowserMenu()" style="padding: 10px 20px; cursor: pointer;">
                         <i class="fas fa-chevron-down" style="color: #888; font-size: 18px;"></i>
                     </div>
                </div>
            </div>
        </div>
        
        <!-- ÊµèËßàÂô®ÂéÜÂè≤È°µÈù¢ -->
        <div id="browser-history-modal" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 110;">
            <div class="menu-backdrop" style="width: 100%; height: 100%; background: rgba(0,0,0,0.4); transition: opacity 0.3s;" onclick="closeBrowserHistory()"></div>
            <div id="browser-history-panel" class="history-panel" style="position: absolute; bottom: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; box-sizing: border-box; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); height: 70vh;">
                <!-- ÂéÜÂè≤È°µÈù¢Â§¥ÈÉ® -->
                <div class="history-header" style="padding: 20px 20px 10px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #000; margin: 0;">ÂéÜÂè≤</h2>
                    <button onclick="closeBrowserHistory()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer;">ÂÆåÊàê</button>
                </div>
                
                
                <!-- ÂéÜÂè≤ÂÜÖÂÆπ -->
                <div class="history-content" style="flex: 1; overflow-y: auto; padding: 0;">
                    <div id="browser-history-list" style="padding: 10px 0;">
                        <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂ∞ÜÈÄöËøáJSÁîüÊàê -->
                        <div style="text-align: center; padding: 40px 20px; color: #999;">
                            <i class="far fa-clock" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>ÁÇπÂáªÂè≥‰∏äËßíÁîüÊàêÊµèËßàÂéÜÂè≤</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊµèËßàÂô®‰π¶Á≠æÈ°µÈù¢ -->
        <div id="browser-bookmarks-modal" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 110;">
            <div class="menu-backdrop" style="width: 100%; height: 100%; background: rgba(0,0,0,0.4); transition: opacity 0.3s;" onclick="closeBrowserBookmarks()"></div>
            <div id="browser-bookmarks-panel" class="history-panel" style="position: absolute; bottom: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; box-sizing: border-box; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); height: 70vh;">
                <div class="history-header" style="padding: 20px 20px 10px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #000; margin: 0;">‰π¶Á≠æ</h2>
                    <button onclick="closeBrowserBookmarks()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer;">ÂÆåÊàê</button>
                </div>
                <div class="history-content" style="flex: 1; overflow-y: auto; padding: 0;">
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; padding: 40px 20px; color: #999;">
                            <i class="far fa-star" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>ÊöÇÊó†‰π¶Á≠æ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊµèËßàÂô®‰∏ãËΩΩÈ°µÈù¢ -->
        <div id="browser-downloads-modal" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 110;">
            <div class="menu-backdrop" style="width: 100%; height: 100%; background: rgba(0,0,0,0.4); transition: opacity 0.3s;" onclick="closeBrowserDownloads()"></div>
            <div id="browser-downloads-panel" class="history-panel" style="position: absolute; bottom: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; box-sizing: border-box; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); height: 70vh;">
                <div class="history-header" style="padding: 20px 20px 10px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #000; margin: 0;">‰∏ãËΩΩ</h2>
                    <button onclick="closeBrowserDownloads()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer;">ÂÆåÊàê</button>
                </div>
                <div class="history-content" style="flex: 1; overflow-y: auto; padding: 0;">
                    <div style="padding: 10px 0;">
                        <div style="text-align: center; padding: 40px 20px; color: #999;">
                            <i class="fas fa-arrow-down" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>ÊöÇÊó†‰∏ãËΩΩËÆ∞ÂΩï</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊµèËßàÂô®ÂàÜ‰∫´È°µÈù¢ -->
        <div id="browser-share-modal" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 110;">
            <div class="menu-backdrop" style="width: 100%; height: 100%; background: rgba(0,0,0,0.4); transition: opacity 0.3s;" onclick="closeBrowserShare()"></div>
            <div id="browser-share-panel" class="history-panel" style="position: absolute; bottom: 0; width: 100%; background: #fff; border-radius: 20px 20px 0 0; display: flex; flex-direction: column; box-sizing: border-box; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); height: 70vh;">
                <div class="history-header" style="padding: 20px 20px 10px 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between;">
                    <h2 style="font-size: 20px; font-weight: 600; color: #000; margin: 0;">ÂàÜ‰∫´</h2>
                    <button onclick="closeBrowserShare()" style="background: none; border: none; color: #007AFF; font-size: 16px; cursor: pointer;">ÂÆåÊàê</button>
                </div>
                <div class="history-content" style="flex: 1; overflow-y: auto; padding: 0;">
                    <div id="browser-share-list" style="padding: 10px 0;">
                        <div style="text-align: center; padding: 40px 20px; color: #999;">
                            <i class="fas fa-share-alt" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>ÊöÇÊó†ÂàÜ‰∫´ËÆ∞ÂΩï</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÊµèËßàÂô®È°µÈù¢ËØ¶ÊÉÖ -->
        <div id="browser-page-detail" class="hidden" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 220; background: #fff; display: flex; flex-direction: column;">
            <div class="app-header" style="border-bottom: 1px solid #f0f0f0;">
                <button class="back-btn" onclick="closeBrowserPageDetail()"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
                <h3 id="browser-detail-title" style="max-width: 60%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Ê†áÈ¢ò</h3>
                <div style="width: 60px;"></div>
            </div>
            <div class="app-body" style="padding: 20px; display: flex; flex-direction: column; flex: 1; overflow-y: auto;">
                <div id="browser-detail-content" style="font-size: 16px; line-height: 1.6; color: #333;"></div>
                <div id="browser-detail-footer" style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed #eee; color: #666; font-style: italic; font-size: 14px;"></div>
            </div>
        </div>
    </div>

    <!-- ËÆ∫ÂùõÂÖ®Â±èApp (‰ªø Instagram) -->
    <div id="forum-app" class="app-screen hidden">
        <div class="app-header">
            <button id="close-forum-app" class="back-btn"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>Instagram</h3>
            <div style="width: 60px;"></div>
        </div>
        <!-- ÂÜÖÂÆπÁî± js/forum.js Âä®ÊÄÅÁîüÊàê -->
    </div>

    <!-- Ë¥≠Áâ©ÂÖ®Â±èApp -->
    <div id="shopping-app" class="app-screen hidden" style="background-color: #f2f2f7; position: fixed; height: 100dvh; height: 100vh; top: 0; left: 0; width: 100%; z-index: 100;">
        <!-- Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶ÊàêÂäüÂèçÈ¶àÂºπÁ™ó -->
        <div id="shopping-success-toast" class="hidden" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: #fff; padding: 20px 30px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; z-index: 200; pointer-events: none;">
            <i class="fas fa-check" style="font-size: 36px; margin-bottom: 10px;"></i>
            <span style="font-size: 16px; font-weight: 500;">Â∑≤Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</span>
        </div>

        <div class="app-header" style="background: #fff; border-bottom: 1px solid #e5e5e5;">
            <button class="back-btn" id="close-shopping-app"><i class="fas fa-chevron-left"></i> ËøîÂõû</button>
            <h3>Ë¥≠Áâ©‰∏≠ÂøÉ</h3>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button id="shopping-link-contact-btn" class="icon-btn" style="color: #333; font-size: 18px;"><i class="fas fa-link"></i></button>
                <button id="shopping-menu-btn" class="icon-btn" style="color: #333; font-size: 18px;"><i class="fas fa-search"></i></button>
            </div>
        </div>

        <!-- Ë¥≠Áâ©ÁÆ°ÁêÜÊ®°ÂºèÈ°∂ÈÉ®Ê†è (ÈªòËÆ§ÈöêËóè) -->
        <div id="shopping-manage-header" class="app-header hidden" style="background: #fff; border-bottom: 1px solid #e5e5e5; position: absolute; top: 0; left: 0; width: 100%; z-index: 101;">
            <div style="display: flex; gap: 15px; align-items: center;">
                <button class="back-btn" id="exit-shopping-manage-btn" style="color: #333;">ÂèñÊ∂à</button>
                <button id="shopping-select-all-btn" style="border: none; background: none; font-size: 16px; color: #007AFF;">ÂÖ®ÈÄâ</button>
            </div>
            <h3>ÁÆ°ÁêÜÂïÜÂìÅ</h3>
            <button id="delete-shopping-items-btn" class="icon-btn" style="color: #FF3B30; font-size: 16px; font-weight: bold;">Âà†Èô§(0)</button>
        </div>

        <div class="app-body" style="padding: 0; padding-bottom: calc(80px + env(safe-area-inset-bottom)); overflow-y: auto; -webkit-overflow-scrolling: touch; touch-action: pan-y; overscroll-behavior-y: contain;">
            <!-- Tab Content: Shopping -->
            <div id="shopping-tab-home" class="shopping-tab-content" style="display: block;">
                <div style="padding: 20px; text-align: center; color: #999; margin-top: 50px;">
                    <i class="fas fa-shopping-bag" style="font-size: 48px; margin-bottom: 15px; color: #FF9500;"></i>
                    <p>Á≤æÈÄâÂ•ΩÁâ©ÔºåÁ≠â‰Ω†Êù•Ë¥≠</p>
                </div>
            </div>

            <!-- Tab Content: Delivery -->
            <div id="shopping-tab-delivery" class="shopping-tab-content" style="display: none;">
                <div style="padding: 20px; text-align: center; color: #999; margin-top: 50px;">
                    <i class="fas fa-utensils" style="font-size: 48px; margin-bottom: 15px; color: #FF9500;"></i>
                    <p>ÁæéÈ£üÂ§ñÂçñÔºåÂáÜÊó∂ÈÄÅËææ</p>
                </div>
            </div>

            <!-- Tab Content: Orders -->
            <div id="shopping-tab-cart" class="shopping-tab-content" style="display: none;">
                <div style="padding: 20px; text-align: center; color: #999; margin-top: 50px;">
                    <i class="fas fa-shopping-cart" style="font-size: 48px; margin-bottom: 15px; color: #FF9500;"></i>
                    <p>Ë¥≠Áâ©ËΩ¶Á©∫Á©∫Â¶Ç‰πü</p>
                </div>
            </div>

            <div id="shopping-tab-orders" class="shopping-tab-content" style="display: none;">
                <div style="padding: 20px; text-align: center; color: #999; margin-top: 50px;">
                    <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 15px; color: #FF9500;"></i>
                    <p>ÊöÇÊó†ËÆ¢ÂçïËÆ∞ÂΩï</p>
                </div>
            </div>
        </div>

        <!-- Bottom Tab Bar -->
        <div class="wechat-tab-bar" style="width: 100%; left: 0; bottom: 0; right: 0; border-radius: 0; padding-bottom: env(safe-area-inset-bottom); margin-bottom: 0; height: auto; padding-top: 6px; min-height: 50px;">
            <div class="wechat-tab-item active" data-tab="home">
                <i class="fas fa-shopping-bag"></i>
                <span>Ë¥≠Áâ©</span>
            </div>
            <div class="wechat-tab-item" data-tab="cart">
                <i class="fas fa-shopping-cart"></i>
                <span>Ë¥≠Áâ©ËΩ¶</span>
            </div>
            <div class="wechat-tab-item" data-tab="delivery">
                <i class="fas fa-utensils"></i>
                <span>Â§ñÂçñ</span>
            </div>
            <div class="wechat-tab-item" data-tab="orders">
                <i class="fas fa-clipboard-list"></i>
                <span>ËÆ¢Âçï</span>
            </div>
        </div>

        <!-- ÂïÜÂìÅËØ¶ÊÉÖÈ°µ -->
        <div id="shopping-detail-screen" class="sub-screen hidden" style="z-index: 150; background-color: #f5f5f5;">
            <!-- Header -->
            <div class="app-header" style="background: transparent; position: absolute; width: 100%; z-index: 10; border: none; pointer-events: none;">
                <button class="back-btn" id="close-shopping-detail" style="background: rgba(0,0,0,0.4); color: #fff; border-radius: 50%; width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; pointer-events: auto; margin-left: 10px;"><i class="fas fa-chevron-left" style="margin-right: 2px;"></i></button>
                <div style="flex: 1;"></div>
                <button id="shopping-share-btn" class="icon-btn" style="background: rgba(0,0,0,0.4); color: #fff; border-radius: 50%; width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; pointer-events: auto; margin-right: 10px;"><i class="fas fa-share"></i></button>
            </div>
            
            <!-- Body -->
            <div class="app-body" style="padding: 0; padding-bottom: 60px; overflow-y: auto;">
                <img id="shopping-detail-img" src="" style="width: 100%; display: block;">
                <div style="padding: 15px; background: #fff; margin-bottom: 10px;">
                    <div style="color: #FF5000; font-size: 24px; font-weight: bold;">¬•<span id="shopping-detail-price"></span></div>
                    <div id="shopping-detail-title" style="font-size: 16px; font-weight: bold; margin: 10px 0; line-height: 1.4;"></div>
                    <div style="display: flex; justify-content: space-between; color: #999; font-size: 12px;">
                        <span>Âø´ÈÄí: ÂÖçËøêË¥π</span>
                        <span id="shopping-detail-paid"></span>
                        <span>Âπø‰∏úÊù≠Â∑û</span>
                    </div>
                </div>
                
                <div style="padding: 15px; background: #fff; margin-bottom: 10px; display: flex; align-items: center;">
                    <div style="width: 40px; height: 40px; background: #eee; border-radius: 4px; margin-right: 10px; display: flex; align-items: center; justify-content: center;"><i class="fas fa-store"></i></div>
                    <div style="flex: 1;">
                        <div id="shopping-detail-shop" style="font-weight: bold;"></div>
                        <div style="font-size: 12px; color: #999;">Â§©Áå´‰∫îÂπ¥ËÄÅÂ∫ó</div>
                    </div>
                    <button style="border: 1px solid #FF5000; color: #FF5000; background: #fff; padding: 4px 12px; border-radius: 12px; font-size: 12px;">ËøõÂ∫ó</button>
                </div>
                
                <div style="padding: 15px; background: #fff; min-height: 300px;">
                    <div style="text-align: center; color: #ccc; margin-top: 20px;">‚Äî‚Äî ÂÆùË¥ùËØ¶ÊÉÖ ‚Äî‚Äî</div>
                    <div id="shopping-detail-desc" style="margin-top: 20px; font-size: 14px; line-height: 1.6; color: #333;"></div>
                </div>
            </div>
            
            <!-- Footer -->
            <div style="position: absolute; bottom: 0; width: 100%; background: #fff; display: flex; align-items: center; height: 80px; padding-bottom: max(10px, env(safe-area-inset-bottom)); border-top: 1px solid #eee;">
                <div style="flex: 1; display: flex; justify-content: space-around;">
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666; gap: 2px;"><i class="fas fa-store" style="font-size: 20px;"></i>Â∫óÈì∫</div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666; gap: 2px;"><i class="fas fa-comment-dots" style="font-size: 20px;"></i>ÂÆ¢Êúç</div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666; gap: 2px;"><i class="far fa-star" style="font-size: 20px;"></i>Êî∂Ëóè</div>
                </div>
                <div style="flex: 1.6; display: flex; margin-right: 15px; height: 44px;">
                    <button id="detail-add-to-cart-btn" style="flex: 1; background: linear-gradient(90deg, #FFCB00, #FF9402); color: #fff; border: none; border-top-left-radius: 22px; border-bottom-left-radius: 22px; font-size: 15px; font-weight: bold;">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</button>
                    <button id="detail-buy-now-btn" style="flex: 1; background: linear-gradient(90deg, #FF5E00, #FF2A00); color: #fff; border: none; border-top-right-radius: 22px; border-bottom-right-radius: 22px; font-size: 15px; font-weight: bold;">Á´ãÂç≥Ë¥≠‰π∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Êü•ÊâãÊú∫ - Èó≤È±º -->
    <div id="phone-xianyu" class="sub-screen hidden" style="z-index: 200; background-color: #f6f6f6;">
        <!-- Â≠êÈ°µÈù¢ÔºöÊàëÂçñÂá∫ÁöÑ -->
        <div id="xianyu-page-sold" class="sub-screen hidden" style="z-index: 210; background-color: #f6f6f6; overflow-y: auto;">
            <div class="app-header" style="background: #f6f6f6; border-bottom: none; justify-content: space-between; padding-left: 10px; padding-right: 10px; padding-top: max(10px, env(safe-area-inset-top)); height: auto; padding-bottom: 5px; flex-shrink: 0;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-sold').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <div style="background: #fff; border-radius: 16px; padding: 6px 15px; flex: 1; margin: 0 10px; color: #999; font-size: 14px; display: flex; align-items: center;"><i class="fas fa-search" style="margin-right: 6px;"></i> ÊêúÁ¥¢ÂçñÂá∫ÁöÑÂÆùË¥ù</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #333; width: 40px; white-space: nowrap;">
                        <i class="far fa-file-alt" style="font-size: 16px;"></i> <span style="transform: scale(0.8);">Ë¥¶Âçï</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #333; width: 30px;">
                        <i class="fas fa-filter" style="font-size: 16px;"></i> <span style="transform: scale(0.8);">Á≠õÈÄâ</span>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div style="display: flex; justify-content: space-around; padding: 10px 0; background: #f6f6f6; font-size: 14px; color: #666; overflow-x: auto; flex-shrink: 0; min-height: 40px;">
                <span style="color: #000; font-weight: bold; font-size: 16px; position: relative; flex-shrink: 0; padding: 0 10px;">ÂÖ®ÈÉ®<div style="width: 100%; height: 3px; background: #FFDA44; position: absolute; bottom: -5px; left: 0; border-radius: 2px;"></div></span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖ‰ªòÊ¨æ</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖÂèëË¥ß</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖÊî∂Ë¥ß</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖËØÑ‰ª∑</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÈÄÄÊ¨æ/ÂîÆÂêé</span>
            </div>
            
            <div id="xianyu-sold-list" style="padding: 10px; padding-top: 0;">
                <!-- JS ÁîüÊàê -->
            </div>
        </div>

        <!-- Â≠êÈ°µÈù¢ÔºöÊàë‰π∞Âà∞ÁöÑ -->
        <div id="xianyu-page-bought" class="sub-screen hidden" style="z-index: 210; background-color: #f6f6f6; overflow-y: auto;">
            <div class="app-header" style="background: #f6f6f6; border-bottom: none; justify-content: space-between; padding-left: 10px; padding-right: 10px; padding-top: max(10px, env(safe-area-inset-top)); height: auto; padding-bottom: 5px; flex-shrink: 0;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-bought').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <div style="background: #fff; border-radius: 16px; padding: 6px 15px; flex: 1; margin: 0 10px; color: #999; font-size: 14px; display: flex; align-items: center;"><i class="fas fa-search" style="margin-right: 6px;"></i> ÊêúÁ¥¢‰π∞ËøáÁöÑÂÆùË¥ù</div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #333; width: 40px; white-space: nowrap;">
                        <i class="far fa-file-alt" style="font-size: 16px;"></i> <span style="transform: scale(0.8);">ÂÖ∂‰ªñËÆ¢Âçï</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #333; width: 30px;">
                        <i class="fas fa-filter" style="font-size: 16px;"></i> <span style="transform: scale(0.8);">Á≠õÈÄâ</span>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div style="display: flex; justify-content: space-around; padding: 10px 0; background: #f6f6f6; font-size: 14px; color: #666; overflow-x: auto; flex-shrink: 0; min-height: 40px;">
                <span style="color: #000; font-weight: bold; font-size: 16px; position: relative; flex-shrink: 0; padding: 0 10px;">ÂÖ®ÈÉ®<div style="width: 100%; height: 3px; background: #FFDA44; position: absolute; bottom: -5px; left: 0; border-radius: 2px;"></div></span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖ‰ªòÊ¨æ</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖÂèëË¥ß</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖÊî∂Ë¥ß</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÂæÖËØÑ‰ª∑</span>
                <span style="flex-shrink: 0; padding: 0 10px;">ÈÄÄÊ¨æ/ÂîÆÂêé</span>
            </div>
            
            <div id="xianyu-bought-list" style="padding: 10px; padding-top: 0;">
                <!-- JS ÁîüÊàê -->
            </div>
        </div>

        <!-- Â≠êÈ°µÈù¢ÔºöÊàëÁöÑÊî∂Ëóè -->
        <div id="xianyu-page-favorites" class="sub-screen hidden" style="z-index: 210; background-color: #f6f6f6; overflow-y: auto;">
            <div class="app-header" style="background: #f6f6f6; border-bottom: none; justify-content: space-between; padding-left: 10px; padding-right: 10px; padding-top: max(10px, env(safe-area-inset-top)); height: auto; padding-bottom: 5px; flex-shrink: 0;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-favorites').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <div style="font-size: 18px; font-weight: bold; color: #000;">Êî∂ËóèÁöÑÂÆùË¥ù <span style="font-size: 14px; color: #999; font-weight: normal;">280</span></div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-search" style="font-size: 18px; color: #333;"></i>
                    <span style="font-size: 14px; color: #333;">ÁÆ°ÁêÜ</span>
                </div>
            </div>

            <!-- Tabs -->
            <div style="display: flex; padding: 10px 15px; background: #f6f6f6; gap: 15px;">
                <span style="background: #fff; padding: 6px 12px; border-radius: 15px; font-size: 13px; font-weight: bold;">Èôç‰ª∑ÂÆùË¥ù</span>
                <span style="background: #fff; padding: 6px 12px; border-radius: 15px; font-size: 13px; font-weight: bold;">ÊúâÊïàÂÆùË¥ù</span>
                <span style="background: #fff; padding: 6px 12px; border-radius: 15px; font-size: 13px; font-weight: bold;">Â§±ÊïàÂÆùË¥ù</span>
            </div>
            
            <div id="xianyu-favorites-list" style="padding: 10px; padding-top: 0;">
                <!-- JS ÁîüÊàê -->
            </div>
        </div>

        <!-- Â≠êÈ°µÈù¢ÔºöÊàëÂèëÂ∏ÉÁöÑ -->
        <div id="xianyu-page-published" class="sub-screen hidden" style="z-index: 210; background-color: #f6f6f6; overflow-y: auto;">
            <div class="app-header" style="background: #f6f6f6; border-bottom: none; justify-content: space-between; padding-left: 10px; padding-right: 10px;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-published').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <h3 style="font-size: 18px; font-weight: bold; color: #000;">ÊàëÂèëÂ∏ÉÁöÑ</h3>
                <div style="font-size: 14px; color: #333; background: #e0e0e0; padding: 4px 8px; border-radius: 12px;"><i class="fas fa-th-large"></i> Ëê•ÈîÄÂ∑•ÂÖ∑</div>
            </div>
            
            <div style="padding: 10px;">
                <!-- Êï∞ÊçÆÂç°Áâá -->
                <div style="background: #fff; border-radius: 12px; padding: 15px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; font-size: 16px;">Êò®Êó•Êï∞ÊçÆ <span style="font-size: 10px; background: #E0F0FF; color: #007AFF; padding: 1px 4px; border-radius: 4px;">È±ºÂ∞èÈì∫</span></span>
                        <span style="font-size: 12px; color: #999;">È±ºÂ∞èÈì∫Â∑•‰ΩúÂè∞ ></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                        <div><div style="font-size: 20px; font-weight: bold;">62</div><div style="font-size: 12px; color: #999;">ÂÆùË¥ùÊõùÂÖâ</div></div>
                        <div><div style="font-size: 20px; font-weight: bold;">12</div><div style="font-size: 12px; color: #999;">ÂÆùË¥ùÊµèËßà</div></div>
                        <div><div style="font-size: 20px; font-weight: bold;">0</div><div style="font-size: 12px; color: #999;">ÊîØ‰ªòÈáëÈ¢ù</div></div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button style="flex: 1; background: #FFDA44; border: none; padding: 10px; border-radius: 20px; font-weight: bold;">‰∏ÄÈîÆÊì¶‰∫Æ</button>
                        <button style="flex: 1; background: #f0f0f0; border: none; padding: 10px; border-radius: 20px;">ËµöÊõùÂÖâ</button>
                    </div>
                </div>

                <!-- ÂàóË°® Tabs -->
                <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 15px;">
                    <span style="font-size: 18px; font-weight: bold; position: relative;">Âú®Âçñ<span style="font-size: 10px; position: absolute; top: 0; right: -8px;">4</span><div style="width: 100%; height: 3px; background: #FFDA44; position: absolute; bottom: -5px; border-radius: 2px;"></div></span>
                    <span style="font-size: 16px; color: #666;">ËçâÁ®ø</span>
                    <span style="font-size: 16px; color: #666;">Â∑≤‰∏ãÊû∂</span>
                    <i class="fas fa-search" style="margin-left: auto; color: #333;"></i>
                </div>

                <!-- ÂïÜÂìÅÂàóË°® -->
                <div id="xianyu-published-list">
                    <!-- JS ÁîüÊàê -->
                </div>
            </div>
        </div>

        <!-- Â≠êÈ°µÈù¢ÔºöÈó≤È±ºËÅäÂ§© -->
        <div id="xianyu-page-chat" class="sub-screen hidden" style="z-index: 220; background-color: #f6f6f6; display: flex; flex-direction: column;">
            <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0; justify-content: space-between; padding-left: 10px; padding-right: 10px; flex-shrink: 0;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-chat').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <div id="xianyu-chat-username" style="font-weight: bold; font-size: 16px; color: #000;"></div>
                    <div id="xianyu-chat-status" style="font-size: 12px; color: #999;"></div>
                </div>
                <button class="icon-btn" style="color: #000;"><i class="fas fa-ellipsis-h"></i></button>
            </div>
            
            <!-- ‰∫§ÊòìÁä∂ÊÄÅÂç°Áâá -->
            <div id="xianyu-chat-trade-card" style="background: #fff; margin: 10px; border-radius: 12px; padding: 15px; display: none; flex-shrink: 0;">
                <div style="display: flex; gap: 10px;">
                    <img id="xianyu-chat-trade-img" src="" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                    <div style="flex: 1;">
                        <div id="xianyu-chat-trade-title" style="font-size: 14px; font-weight: bold; color: #333; margin-bottom: 5px;"></div>
                        <div id="xianyu-chat-trade-price" style="color: #FF3B30; font-weight: bold; font-size: 16px;"></div>
                    </div>
                </div>
                <div id="xianyu-chat-trade-status" style="margin-top: 10px; padding: 8px; background: #FFF5E0; border-radius: 8px; text-align: center; color: #FF6600; font-size: 14px; font-weight: bold;"></div>
            </div>
            
            <!-- ËÅäÂ§©Ê∂àÊÅØÂå∫Âüü -->
            <div id="xianyu-chat-messages" style="padding: 10px; flex: 1; overflow-y: auto;">
                <!-- Ê∂àÊÅØÁî±JSÁîüÊàê -->
            </div>
            
            <!-- Â∫ïÈÉ®ËæìÂÖ•Ê†è -->
            <div style="width: 100%; background: #fff; padding: 10px; border-top: 1px solid #eee; display: flex; align-items: center; gap: 10px; padding-bottom: max(10px, env(safe-area-inset-bottom)); flex-shrink: 0;">
                <button style="background: none; border: none; font-size: 20px; color: #999;"><i class="fas fa-plus"></i></button>
                <input type="text" placeholder="ËØ¥ÁÇπ‰ªÄ‰πà..." style="flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 8px 15px; font-size: 14px;">
                <button style="background: #FFDA44; border: none; border-radius: 20px; padding: 8px 15px; color: #333; font-weight: bold;">ÂèëÈÄÅ</button>
            </div>
        </div>

        <!-- Â≠êÈ°µÈù¢ÔºöÂïÜÂìÅËØ¶ÊÉÖ -->
        <div id="xianyu-page-detail" class="sub-screen hidden" style="z-index: 220; background-color: #fff; overflow-y: auto; padding-bottom: 60px;">
            <div class="app-header" style="background: #fff; border-bottom: 1px solid #f0f0f0; justify-content: space-between; padding-left: 10px; padding-right: 10px;">
                <button class="icon-btn" onclick="document.getElementById('xianyu-page-detail').classList.add('hidden')" style="color: #000;"><i class="fas fa-chevron-left"></i></button>
                <div style="background: #f0f0f0; border-radius: 16px; padding: 5px 15px; flex: 1; margin: 0 10px; color: #999; font-size: 14px;"><i class="fas fa-search"></i> ÊêúÁ¥¢</div>
                <button class="icon-btn" style="color: #000;"><i class="fas fa-share"></i></button>
            </div>
            
            <div style="padding: 15px;">
                <!-- Áî®Êà∑Ê†è -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img id="xianyu-detail-avatar" src="" style="width: 40px; height: 40px; border-radius: 50%;">
                        <div>
                            <div id="xianyu-detail-username" style="font-weight: bold; font-size: 16px;"></div>
                            <div id="xianyu-detail-location" style="font-size: 10px; color: #999;">ÂàöÂàöÊù•Ëøá | ÊµôÊ±ü</div>
                        </div>
                    </div>
                    <span style="border: 1px solid #eee; padding: 4px 8px; border-radius: 12px; font-size: 12px;">ÁúãÁúãÂ§ßÂÆ∂ÂçñÂ§öÂ∞ë ></span>
                </div>

                <!-- ‰ª∑Ê†º‰∏éÊ†áÈ¢ò -->
                <div style="margin-bottom: 15px;">
                    <div style="color: #FF3B30; font-size: 24px; font-weight: bold; margin-bottom: 10px;">¬•<span id="xianyu-detail-price"></span></div>
                    <div id="xianyu-detail-desc" style="font-size: 16px; line-height: 1.5; margin-bottom: 15px;"></div>
                </div>

                <!-- ÂõæÁâá -->
                <div id="xianyu-detail-images">
                    <img id="xianyu-detail-main-img" src="" style="width: 100%; border-radius: 8px;">
                </div>
                
                <div id="xianyu-detail-id-text" style="margin-top: 20px; text-align: right; font-size: 12px; color: #999;">
                    Èó≤È±ºÂè∑ÔºöÊòµÁß∞
                </div>
            </div>

            <!-- Â∫ïÈÉ®Ê†è -->
            <div style="position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; padding: 10px 20px; border-top: 1px solid #eee; display: flex; align-items: center; justify-content: space-between; padding-bottom: max(10px, env(safe-area-inset-bottom));">
                <div style="display: flex; gap: 20px; margin-left: 10px;">
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666;">
                        <i class="far fa-star" style="font-size: 20px;"></i> 10
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666;">
                        <i class="far fa-eye" style="font-size: 20px;"></i> 156
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; font-size: 10px; color: #666;">
                        <i class="fas fa-user-slash" style="font-size: 20px;"></i> Êó†‰∫∫Âú®Ëπ≤
                    </div>
                </div>
                <button style="background: #f0f0f0; border: none; padding: 10px 30px; border-radius: 20px; font-weight: bold;">ÁÆ°ÁêÜ</button>
            </div>
        </div>

        <div class="app-body" style="padding: 0; padding-bottom: 80px; overflow-y: auto; height: 100%;">
            
            <!-- Tab: Ê∂àÊÅØ -->
            <div id="xianyu-tab-messages" class="xianyu-tab-content" style="display: none; padding-top: max(47px, env(safe-area-inset-top));">
                <div style="padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; background: #f6f6f6;">
                    <div onclick="document.getElementById('phone-xianyu').classList.add('hidden')" style="font-size: 24px; font-weight: 800; color: #000; cursor: pointer;">Ê∂àÊÅØ</div>
                    <div style="display: flex; gap: 15px;">
                        <button id="generate-xianyu-btn" style="background: transparent; border: none; cursor: pointer; padding: 5px; display: flex; align-items: center;">
                            <i class="fas fa-shopping-bag" style="font-size: 20px; color: #000;"></i>
                        </button>
                    </div>
                </div>
                
                <div id="xianyu-messages-list" style="padding-bottom: 20px;">
                    <!-- Ê∂àÊÅØÂàóË°®Áî±JSÊ∏≤Êüì -->
                </div>
            </div>

            <!-- Tab: ÊàëÁöÑ -->
            <div id="xianyu-tab-me" class="xianyu-tab-content" style="display: block;">
                <!-- È°∂ÈÉ®ËÉåÊôØ -->
                <div style="background-color: #f6f6f6; padding: 15px; padding-top: max(10px, env(safe-area-inset-top));">
                    <!-- ËøîÂõûÊåâÈíÆ -->
                    <button class="icon-btn" onclick="document.getElementById('phone-xianyu').classList.add('hidden')" style="color: #000; margin-bottom: 10px;"><i class="fas fa-chevron-left"></i></button>
                    <!-- Áî®Êà∑‰ø°ÊÅØË°å -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <img id="xianyu-me-avatar" src="" style="width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff; object-fit: cover;">
                            <div style="display: flex; flex-direction: column;">
                                <span id="xianyu-me-name" style="font-size: 20px; font-weight: 800; color: #000;">Áî®Êà∑Âêç</span>
                                <div style="display: flex; align-items: center; gap: 5px; margin-top: 4px;">
                                    <span style="background: #f0f0f0; color: #999; font-size: 11px; padding: 2px 6px; border-radius: 10px;">ÁÇπÂáªÊ∑ªÂä†ÁÆÄ‰ªã ></span>
                                </div>
                                <div style="margin-top: 4px;">
                                    <span style="background: #e0e0e0; color: #666; font-size: 10px; padding: 1px 6px; border-radius: 4px;">È±ºÂäõÂÄº 839</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 15px; margin-top: 5px;">
                            <i class="far fa-smile" style="font-size: 20px; color: #000;"></i>
                            <i class="fas fa-cog" style="font-size: 20px; color: #000;"></i>
                        </div>
                    </div>

                    <!-- Èó≤È±º‰ºöÂëòÂç°Áâá (Ë£ÖÈ•∞) -->
                    <div style="background: linear-gradient(90deg, #E0F0FF, #C0E0FF); border-radius: 12px; padding: 12px; margin-bottom: 15px; position: relative; overflow: hidden; height: 60px;">
                        <div style="position: absolute; top: 10px; left: 15px; font-weight: 800; font-size: 16px; color: #0055AA; font-style: italic;">Èó≤È±º‰ºöÂëò X8</div>
                        <div style="position: absolute; bottom: 10px; left: 15px; font-size: 11px; color: #004488;">‰ªäÊó•500ÁªèÈ™åÂÄºÂæÖÈ¢ÜÂèñÔºåÊù•Âä†ÈÄüÂçáÁ∫ßÂêß ></div>
                        <div style="position: absolute; right: -10px; bottom: -10px; font-size: 80px; color: #FFD700; opacity: 0.5;"><i class="fas fa-fish"></i></div>
                    </div>

                    <!-- ÁªüËÆ°Êï∞ÊçÆ -->
                    <div style="display: flex; justify-content: space-around; margin-bottom: 20px;">
                        <div onclick="openXianyuFavorites()" style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                            <span style="font-size: 18px; font-weight: 700;">280</span>
                            <span style="font-size: 12px; color: #666;">ÊàëÁöÑÊî∂Ëóè</span>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <span style="font-size: 18px; font-weight: 700;">2872</span>
                            <span style="font-size: 12px; color: #666;">ÂéÜÂè≤ÊµèËßà</span>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <span style="font-size: 18px; font-weight: 700;">25</span>
                            <span style="font-size: 12px; color: #666;">ÊàëÁöÑÂÖ≥Ê≥®</span>
                        </div>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <span style="font-size: 18px; font-weight: 700;">3</span>
                            <span style="font-size: 12px; color: #666;">Á∫¢ÂåÖÂç°Âà∏</span>
                        </div>
                    </div>

                    <!-- ÊêúÁ¥¢ÊèêÁ§∫Êù° -->
                    <div style="background: #fff; border-radius: 20px; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span style="background: #FF4400; color: #fff; border-radius: 4px; padding: 1px 4px; font-size: 10px;">U</span>
                            <span style="font-size: 13px; color: #333;">‰∏çÁî®ÂÜçÊêúÔºå‰Ω†ÊúÄËøëÁúãËøáÁöÑÂïÜÂìÅÈÉΩÂú®Ëøô</span>
                        </div>
                        <span style="font-size: 12px; color: #999;">ÂéªÁúãÁúã ></span>
                    </div>

                    <!-- ÊàëÁöÑ‰∫§Êòì -->
                    <div style="background: #fff; border-radius: 16px; padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div style="display: flex; align-items: baseline; gap: 5px;">
                                <span style="font-size: 16px; font-weight: 700;">ÊàëÁöÑ‰∫§Êòì</span>
                                <span style="font-size: 12px; color: #999;">Âú®Èó≤È±ºËµö‰∫Ü 30293.97 ÂÖÉ</span>
                            </div>
                            <span style="background: #FFF5E0; color: #FF6600; font-size: 11px; padding: 4px 8px; border-radius: 12px;">‰ªäÊó•ÊõùÂÖâ 43 ></span>
                        </div>
                        <div style="display: flex; justify-content: space-around;">
                            <div onclick="openXianyuPublished()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                                <i class="fas fa-shopping-bag" style="font-size: 24px; color: #333;"></i>
                                <span style="font-size: 12px; color: #333;">ÊàëÂèëÂ∏ÉÁöÑ 4</span>
                            </div>
                            <div onclick="openXianyuSold()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                                <i class="fas fa-clipboard-check" style="font-size: 24px; color: #333;"></i>
                                <span style="font-size: 12px; color: #333;">ÊàëÂçñÂá∫ÁöÑ 142</span>
                            </div>
                            <div onclick="openXianyuBought()" style="display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer;">
                                <i class="fas fa-check-circle" style="font-size: 24px; color: #333;"></i>
                                <span style="font-size: 12px; color: #333;">Êàë‰π∞Âà∞ÁöÑ 331</span>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                                <i class="fas fa-tag" style="font-size: 24px; color: #333;"></i>
                                <span style="font-size: 12px; color: #333;">ÊàëÂèØÂçñÁöÑ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Â∫ïÈÉ® Tab Ê†è -->
        <div class="xianyu-tab-bar" style="position: absolute; bottom: 0; left: 0; width: 100%; background: #fff; display: flex; align-items: center; justify-content: space-around; padding-bottom: max(10px, env(safe-area-inset-bottom)); padding-top: 10px; border-top: 1px solid #f0f0f0;">
            <div class="tab-item" style="color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                <span style="font-size: 16px; font-weight: bold;">È¶ñÈ°µ</span>
            </div>
            <div class="tab-item" style="color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                <span style="font-size: 16px; font-weight: bold;">‰ΩçÁΩÆ</span>
            </div>
            <div class="tab-item">
                <div style="background: #FFDA44; border-radius: 20px; padding: 8px 16px; display: flex; align-items: center; gap: 5px; font-weight: 700; font-size: 14px; box-shadow: 0 2px 5px rgba(255, 218, 68, 0.4);">
                    <i class="fas fa-plus"></i> ÂçñÈó≤ÁΩÆ
                </div>
            </div>
            <div class="tab-item active" onclick="switchXianyuTab('messages')" style="color: #333; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; position: relative; cursor: pointer;">
                <span style="font-size: 16px; font-weight: bold;">Ê∂àÊÅØ</span>
                <div style="position: absolute; top: 0; right: -5px; width: 8px; height: 8px; background: #FF3B30; border-radius: 50%;"></div>
            </div>
            <div class="tab-item" onclick="switchXianyuTab('me')" style="color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; cursor: pointer;">
                <span style="font-size: 16px; font-weight: bold;">ÊàëÁöÑ</span>
            </div>
        </div>
    </div>

    <!-- LookUS App -->
    <div id="lookus-app" class="app-screen hidden" style="background-color: #f9f9f9; z-index: 100; display: flex; flex-direction: column;">
        <div class="app-header" style="background: transparent; border: none; padding-top: max(10px, env(safe-area-inset-top)); flex-shrink: 0;">
            <div style="flex: 1; display: flex; align-items: center;">
                <button class="back-btn" onclick="closeLookusApp()" style="color: #000; padding-left: 15px; background: transparent; border: none; font-size: 18px;"><i class="fas fa-chevron-left"></i></button>
            </div>
            <div id="lookus-header-time-badge" style="background: rgba(0,0,0,0.6); padding: 5px 15px; border-radius: 20px; color: #fff; font-size: 12px; display: flex; align-items: center; gap: 5px; cursor: pointer;">
                <i class="fas fa-check"></i> Êõ¥Êñ∞‰∫é: <span id="lookus-update-time">--:--:--</span>
            </div>
            <div style="flex: 1; display: flex; justify-content: flex-end; padding-right: 15px;">
                <button onclick="openLookusSettings()" style="color: #000; background: transparent; border: none; font-size: 18px;"><i class="fas fa-cog"></i></button>
            </div>
        </div>
        
        <div class="app-body" style="padding: 0; padding-bottom: calc(80px + env(safe-area-inset-bottom)); overflow-y: auto; flex: 1;">
            <!-- Map Container & Test Button -->
            <div style="padding: 10px 15px;">
                <button id="lookus-test-map-btn" onclick="testAmapAPI()" style="width: 100%; padding: 12px; background: #007AFF; color: #fff; border: none; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; margin-bottom: 10px;">
                    <i class="fas fa-map-marked-alt"></i> Âä†ËΩΩÂú∞Âõæ
                </button>
                <div id="lookus-map-status" style="font-size: 13px; color: #999; text-align: center; margin-bottom: 10px; display: none;"></div>
                <div id="lookus-map-container" style="width: 100%; height: 250px; border-radius: 12px; overflow: hidden; display: none; border: 1px solid #e0e0e0;"></div>
            </div>

            <div id="lookus-content">
                <!-- Content injected by js/lookus.js -->
            </div>
            <div id="lookus-report-view" style="display: none; padding: 50px 20px; text-align: center; color: #999;">Êä•Â§áÂäüËÉΩÂºÄÂèë‰∏≠...</div>
        </div>

        <!-- Bottom Tab Bar -->
        <div class="lookus-tab-bar" style="position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; display: flex; align-items: center; justify-content: space-around; padding-bottom: max(10px, env(safe-area-inset-bottom)); padding-top: 10px; border-top: 1px solid #f0f0f0; z-index: 101;">
            <div class="tab-item active" style="display: flex; flex-direction: column; align-items: center; gap: 4px; color: #000; cursor: pointer;" onclick="switchLookusTab('home')">
                <i class="fas fa-home" style="font-size: 20px;"></i>
                <span style="font-size: 10px;">È¶ñÈ°µ</span>
            </div>
            <div class="tab-item" style="display: flex; flex-direction: column; align-items: center; gap: 4px; color: #999; cursor: pointer;" onclick="switchLookusTab('report')">
                <i class="fas fa-file-alt" style="font-size: 20px;"></i>
                <span style="font-size: 10px;">Êä•Â§á</span>
            </div>
        </div>

        <!-- Lookus Settings Modal -->
        <div id="lookus-settings-modal" class="modal hidden" style="z-index: 200; align-items: center; justify-content: center;">
            <div class="modal-content" style="width: 80%; max-width: 300px; background: #fff; border-radius: 12px; padding: 20px;">
                <h3 style="text-align: center; margin-top: 0;">Áä∂ÊÄÅÊõ¥Êñ∞ËÆæÁΩÆ</h3>
                
                <div class="setting-group">
                    <label>Êõ¥Êñ∞Ê®°Âºè</label>
                    <select id="lookus-update-mode" style="width: 100%; padding: 8px; border-radius: 8px; border: 1px solid #ddd; margin-top: 5px; background: #f9f9f9;" onchange="toggleLookusTimeInput()">
                        <option value="manual">ÊâãÂä®Âà∑Êñ∞</option>
                        <option value="random">ÈöèÊú∫Èó¥Èöî</option>
                        <option value="fixed">ÂÆöÊó∂Âà∑Êñ∞</option>
                    </select>
                </div>

                <div class="setting-group hidden" id="lookus-time-input-group">
                    <label id="lookus-time-label">Êó∂Èó¥ËåÉÂõ¥ (ÂàÜÈíü)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="number" id="lookus-update-min" placeholder="ÊúÄÂ∞è" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ddd;" min="1">
                        <span id="lookus-time-separator">-</span>
                        <input type="number" id="lookus-update-max" placeholder="ÊúÄÂ§ß" style="flex: 1; padding: 8px; border-radius: 8px; border: 1px solid #ddd;" min="1">
                    </div>
                    <div style="font-size: 12px; color: #888; margin-top: 5px;" id="lookus-time-hint">Â∞ÜÂú®ÊúÄÂ∞èÂíåÊúÄÂ§ßÊó∂Èó¥‰πãÈó¥ÈöèÊú∫Êõ¥Êñ∞</div>
                </div>

                <div class="setting-group" style="margin-top: 15px;">
                    <label>ÊâãÂä®Êìç‰Ωú</label>
                    <button id="lookus-force-update-btn" class="ios-btn-block secondary" style="margin-top: 5px;">Á´ãÂç≥Âà∑Êñ∞Áä∂ÊÄÅ (AI)</button>
                </div>

                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button onclick="saveLookusSettings()" class="ios-btn-block" style="flex: 1; background-color: #000; margin-bottom: 0;">‰øùÂ≠ò</button>
                    <button onclick="document.getElementById('lookus-settings-modal').classList.add('hidden')" class="ios-btn-block secondary" style="flex: 1; margin-bottom: 0;">ÂÖ≥Èó≠</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Èü≥È¢ëÂÖÉÁ¥† -->
    <audio id="bg-music" loop></audio>

    <!-- ÂºïÂÖ• localForage Áî®‰∫éÂ≠òÂÇ®Â§ßÊñá‰ª∂ (ÂèØÈÄâÔºåÂ¶ÇÊûúÈúÄË¶Å) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
    <!-- ÂºïÂÖ• JSZip Áî®‰∫éÂéãÁº©ÂØºÂá∫ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Bmob SDK (Êú¨Âú∞Êñá‰ª∂) -->
    <script src="js/bmob.min.js"></script>
    <!-- ËµÑÊ†ºÁ†ÅÈ™åËØÅ -->
    <script src="js/auth.js"></script>
    <script src="js/core.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/worldbook.js"></script>
    <script src="js/meeting.js"></script>
    <script src="js/apps.js"></script>
    <script src="js/icity.js"></script>
    <script src="js/home.js"></script>
    <script src="js/check_phone.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/shopping.js"></script>
    <script src="js/forum.js"></script>
    <script src="js/games.js"></script>
    <script src="js/call_history.js"></script>
    <script src="js/lookus.js"></script>
    <script>
        // ‰øÆÂ§ç ËµÑÊñôÂç° ËÉåÊôØÁÇπÂáª‰∏ä‰º†ÂõæÁâá
        document.addEventListener('DOMContentLoaded', () => {
            const aiProfileBg = document.getElementById('ai-profile-bg');
            const aiProfileBgInput = document.getElementById('ai-profile-bg-input');
            if (aiProfileBg && aiProfileBgInput) {
                // Á°Æ‰øùÁßªÈô§ÊóßÁöÑÁõëÂê¨Âô®ÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºåËôΩÁÑ∂ËøôÈáåÊòØÊñ∞Â¢ûÔºå‰ΩÜ‰∏∫‰∫ÜÂÆâÂÖ®Ôºâ
                // ÈáçÊñ∞ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
                aiProfileBg.onclick = () => {
                    aiProfileBgInput.click();
                };
                
                aiProfileBgInput.onchange = (e) => {
                    if (window.handleAiProfileBgUpload) {
                        window.handleAiProfileBgUpload(e);
                    }
                };
            }
        });
    </script>

<!-- Âú® index.html ‰∏≠ÊâæÂà∞ <!-- ÁºñËæëËÆ∞ÂøÜÂºπÁ™ó --> ÈôÑËøëÔºåÊ∑ªÂä†‰ª•‰∏ã‰ª£Á†Å -->

            <!-- ÁºñËæëÊ∂àÊÅØÂºπÁ™ó -->
            <div id="edit-chat-msg-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÁºñËæëÊ∂àÊÅØ</h3>
                        <button class="close-btn" id="close-edit-chat-msg">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="setting-group">
                            <label>Ê∂àÊÅØÂÜÖÂÆπ</label>
                            <textarea id="edit-chat-msg-content" placeholder="ËæìÂÖ•Êñ∞ÁöÑÊ∂àÊÅØÂÜÖÂÆπ..." style="height: 150px;"></textarea>
                        </div>
                        <button id="save-edit-chat-msg-btn" class="ios-btn-block">‰øùÂ≠ò‰øÆÊîπ</button>
                    </div>
                </div>
            </div>

            <!-- ÊâπÈáèÁºñËæëÊ∂àÊÅØÂºπÁ™ó -->
            <div id="edit-block-modal" class="modal hidden" style="z-index: 310;">
                <div class="modal-content" style="max-height: 80vh; display: flex; flex-direction: column;">
                    <div class="modal-header">
                        <h3>ÁºñËæëÂõûÂ§ç</h3>
                        <button class="close-btn" id="close-edit-block">&times;</button>
                    </div>
                    <div class="modal-body" style="overflow-y: auto; flex: 1; padding: 10px;">
                        <div id="edit-block-list" style="display: flex; flex-direction: column; gap: 10px;">
                            <!-- JS will generate textareas here -->
                        </div>
                    </div>
                    <div class="modal-footer" style="padding: 15px; border-top: 1px solid #eee;">
                        <button id="save-edit-block-btn" class="ios-btn-block">‰øùÂ≠ò‰øÆÊîπ</button>
                    </div>
                </div>
            </div>

            <!-- ËÅîÁ≥ª‰∫∫ÈÄâÊã©ÂºπÁ™ó (ÈÄöÁî®) -->
            <div id="contact-picker-modal" class="modal hidden" style="z-index: 300;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÈÄâÊã©ËÅîÁ≥ª‰∫∫</h3>
                        <button class="close-btn" id="close-contact-picker">&times;</button>
                    </div>
                    <div class="modal-body" style="padding: 0;">
                        <div id="contact-picker-list" class="ios-list-group" style="margin: 0; max-height: 300px; overflow-y: auto; background: transparent;">
                            <!-- Contacts will be generated here -->
                        </div>
                        <div style="padding: 15px;">
                            <button id="contact-picker-send-btn" class="ios-btn-block">ÂèëÈÄÅ</button>
                        </div>
                    </div>
                </div>
            </div>
<!-- Âú® index.html ‰∏≠ÊâæÂà∞ <!-- ÁºñËæëÊ∂àÊÅØÂºπÁ™ó --> ÈôÑËøëÔºåÊ∑ªÂä†‰ª•‰∏ã‰ª£Á†Å -->

            <!-- Ê∏∏ÊàèÈÄâÊã©ÂºπÁ™ó -->
            <div id="game-selection-modal" class="modal hidden" style="z-index: 250;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÈÄâÊã©Â∞èÊ∏∏Êàè</h3>
                        <button class="close-btn" id="close-game-selection">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="ios-list-group">
                            <div class="list-item" onclick="window.openMinesweeperModeSelection()">
                                <div class="list-content">
                                    <div style="width: 40px; height: 40px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="fas fa-bomb" style="font-size: 20px; color: #333;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">Êâ´Èõ∑</div>
                                        <div style="font-size: 12px; color: #888;">ÁªèÂÖ∏ÁõäÊô∫Ê∏∏Êàè</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                            </div>
                            <div class="list-item" onclick="window.startMiniGame('rps')">
                                <div class="list-content">
                                    <div style="width: 40px; height: 40px; background: #FF9500; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="fas fa-hand-scissors" style="font-size: 20px; color: #fff;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">ÁåúÊã≥</div>
                                        <div style="font-size: 12px; color: #888;">Áü≥Â§¥Ââ™ÂàÄÂ∏É</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                            </div>
                            <div class="list-item" onclick="window.startMiniGame('dice')">
                                <div class="list-content">
                                    <div style="width: 40px; height: 40px; background: #34C759; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="fas fa-dice" style="font-size: 20px; color: #fff;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">ÊäïÈ™∞Â≠ê</div>
                                        <div style="font-size: 12px; color: #888;">ÊØîÂ§ßÂ∞è</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                            </div>
                            <div class="list-item" onclick="window.startMiniGame('witch')">
                                <div class="list-content">
                                    <div style="width: 40px; height: 40px; background: #9b59b6; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="fas fa-flask" style="font-size: 20px; color: #fff;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">Â•≥Â∑´ÁöÑÊØíËçØ</div>
                                        <div style="font-size: 12px; color: #888;">Á≠ñÁï•ÂçöÂºà</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                            </div>
                            <div class="list-item" onclick="window.startMiniGame('truth_dare')">
                                <div class="list-content">
                                    <div style="width: 40px; height: 40px; background: #FF2D55; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                        <i class="fas fa-bullseye" style="font-size: 20px; color: #fff;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold;">ÁúüÂøÉËØùÂ§ßÂÜíÈô©</div>
                                        <div style="font-size: 12px; color: #888;">ËΩ¨ÁõòÂÜ≥ÂÆöÂëΩËøê</div>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-right" style="color: #ccc;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÈÄöÁî®Â∞èÊ∏∏ÊàèÂºπÁ™ó -->
            <!-- ÊúÄÂ∞èÂåñÊÇ¨ÊµÆÁêÉ -->
            <div id="mini-game-minimized" class="ms-icon-transition ms-icon-hidden" style="position: absolute; top: 160px; right: 20px; width: 50px; height: 50px; background-color: rgba(255, 255, 255, 0.95); border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 291; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.05);">
                <span style="font-size: 24px;">üéÆ</span>
            </div>

            <div id="mini-game-modal" class="modal hidden" style="z-index: 290; background-color: transparent; backdrop-filter: none !important; -webkit-backdrop-filter: none !important; pointer-events: none;">
                <div id="mini-game-window" class="ms-window-transition" style="background-color: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); width: 85%; max-width: 320px; position: absolute; top: 100px; left: 20px; pointer-events: auto; border: 1px solid rgba(0,0,0,0.05);">
                    <div id="mini-game-header" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; cursor: move; border-bottom: 1px solid #f0f0f0;">
                        <span id="mini-game-title" style="font-size: 18px; font-weight: 700;">Â∞èÊ∏∏Êàè</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="minimize-mini-game" style="background: #f2f2f7; border: none; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; color: #8e8e93; transition: all 0.2s;">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button id="close-mini-game" style="background: #f2f2f7; border: none; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; color: #8e8e93; transition: all 0.2s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 20px;">
                        <div id="mini-game-content" style="display: flex; flex-direction: column; align-items: center; min-height: 150px; justify-content: center;">
                            <!-- Game specific content will be injected here -->
                        </div>
                        
                        <div id="mini-game-result" style="text-align: center; margin-top: 15px; font-weight: 600; color: #333; min-height: 24px;"></div>
                    </div>
                </div>
            </div>

            <!-- Êâ´Èõ∑Ê®°ÂºèÈÄâÊã©ÂºπÁ™ó -->
            <div id="minesweeper-mode-modal" class="modal hidden" style="z-index: 260;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Êâ´Èõ∑Ê®°Âºè</h3>
                        <button class="close-btn" id="close-minesweeper-mode">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="ios-list-group">
                            <div class="list-item" id="ms-mode-solo" style="cursor: pointer;">
                                <div class="list-content center-content">
                                    <span style="color: #007AFF; font-size: 16px;">Ëá™Â∑±Áé©</span>
                                </div>
                            </div>
                            <div class="list-item" id="ms-mode-coop" style="cursor: pointer;">
                                <div class="list-content center-content">
                                    <span style="color: #007AFF; font-size: 16px;">ÂíåËÅîÁ≥ª‰∫∫‰∏ÄËµ∑Áé©</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Êâ´Èõ∑Ê∏∏ÊàèÂ∞èÁ™ó -->
            <!-- ÊúÄÂ∞èÂåñÊÇ¨ÊµÆÁêÉ (Ê∑ªÂä†Âú® modal Â§ñÈù¢) -->
            <div id="minesweeper-minimized" class="ms-icon-transition ms-icon-hidden" style="position: absolute; top: 100px; right: 20px; width: 50px; height: 50px; background-color: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 301; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid rgba(0,0,0,0.05);">
                <span style="font-size: 24px;">üí£</span>
            </div>

            <div id="minesweeper-modal" class="modal hidden" style="z-index: 300; background-color: transparent; backdrop-filter: none !important; -webkit-backdrop-filter: none !important; align-items: center; justify-content: center; pointer-events: none;">
                <div id="minesweeper-window" class="ms-window-transition" style="background-color: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.15); pointer-events: auto; min-width: 320px; position: absolute; overflow: hidden; border: 1px solid rgba(255,255,255,0.5);">
                    <!-- Ê†áÈ¢òÊ†è (ÂèØÊãñÂä®) -->
                    <div id="minesweeper-header" style="padding: 20px 20px 10px; display: flex; justify-content: space-between; align-items: center; cursor: move;">
                        <span style="font-size: 18px; font-weight: 700; color: #333;">Êâ´Èõ∑</span>
                        <div style="display: flex; gap: 8px;">
                            <button id="minimize-minesweeper" style="background: #f2f2f7; border: none; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; color: #8e8e93; transition: all 0.2s;">
                                <i class="fas fa-minus"></i>
                            </button>
                            <button id="close-minesweeper" style="background: #f2f2f7; border: none; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; color: #8e8e93; transition: all 0.2s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="app-body" style="padding: 0 20px 25px; display: flex; flex-direction: column; align-items: center; background-color: transparent;">
                        
                        <!-- Ê∏∏ÊàèÂ§¥ÈÉ®‰ø°ÊÅØ -->
                        <div style="background: #f2f2f7; border-radius: 16px; padding: 12px 20px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; width: 100%; box-sizing: border-box; box-shadow: inset 0 2px 6px rgba(0,0,0,0.03);">
                            <!-- Ââ©‰ΩôÈõ∑Êï∞ -->
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <span style="font-size: 10px; color: #8e8e93; font-weight: 600; text-transform: uppercase;">Mines</span>
                                <div id="ms-mines-count" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 20px; font-weight: 700; color: #FF3B30;">10</div>
                            </div>
                            
                            <!-- Ë°®ÊÉÖÁä∂ÊÄÅ -->
                            <button id="ms-face-btn" style="width: 44px; height: 44px; background: #fff; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: transform 0.1s;">üôÇ</button>
                            
                            <!-- ËÆ°Êó∂Âô® -->
                            <div style="display: flex; flex-direction: column; align-items: center;">
                                <span style="font-size: 10px; color: #8e8e93; font-weight: 600; text-transform: uppercase;">Time</span>
                                <div id="ms-timer" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 20px; font-weight: 700; color: #333;">000</div>
                            </div>
                        </div>

                        <!-- Ê∏∏ÊàèÁΩëÊ†º -->
                        <div id="ms-grid" style="display: grid; gap: 4px; user-select: none; background: transparent; border: none; padding: 4px;">
                            <!-- Ê†ºÂ≠êÁîüÊàêÂå∫Âüü -->
                        </div>

                        <!-- ÈöæÂ∫¶ÈÄâÊã© -->
                        <div style="margin-top: 25px; display: flex; gap: 8px; width: 100%; justify-content: center; background: #f2f2f7; padding: 4px; border-radius: 12px;">
                            <button class="ms-level-btn active" data-level="easy" style="flex: 1; padding: 8px 0; font-size: 13px; font-weight: 600; border: none; border-radius: 8px; background: #fff; color: #000; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s;">ÂàùÁ∫ß</button>
                            <button class="ms-level-btn" data-level="medium" style="flex: 1; padding: 8px 0; font-size: 13px; font-weight: 600; border: none; border-radius: 8px; background: transparent; color: #8e8e93; cursor: pointer; transition: all 0.2s;">‰∏≠Á∫ß</button>
                            <button class="ms-level-btn" data-level="hard" style="flex: 1; padding: 8px 0; font-size: 13px; font-weight: 600; border: none; border-radius: 8px; background: transparent; color: #8e8e93; cursor: pointer; transition: all 0.2s;">È´òÁ∫ß</button>
                        </div>
                        
                        <div style="margin-top: 10px; width: 100%; display: flex; justify-content: center;">
                            <button id="ms-ai-help-btn" style="background: transparent; border: 1px solid #007AFF; color: #007AFF; border-radius: 15px; padding: 5px 15px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-magic"></i> ËÆ©TAÊìç‰Ωú
                            </button>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ÂèëÈÄÅËØ≠Èü≥ÂºπÁ™ó -->
            <div id="voice-input-modal" class="modal hidden">

                <div class="modal-content">
                    <div class="modal-header">
                        <h3>ÂèëÈÄÅËØ≠Èü≥</h3>
                        <button class="close-btn" id="close-voice-input">&times;</button>
                    </div>
                    <div class="modal-body">
                        <!-- È°∂ÈÉ®ÂàáÊç¢ -->
                        <div class="chat-settings-nav" style="margin: 0 0 20px 0;">
                            <div class="nav-item active" id="tab-voice-fake" onclick="switchVoiceTab('fake')">ÊñáÂ≠óËΩ¨ËØ≠Èü≥</div>
                            <div class="nav-item" id="tab-voice-real" onclick="switchVoiceTab('real')">ÂΩïÂà∂ËØ≠Èü≥</div>
                            <div class="nav-indicator" id="voice-nav-indicator" style="width: calc(50% - 4px);"></div>
                        </div>

                        <!-- Ê®°Âºè1: ‰º™ÈÄ†ËØ≠Èü≥ (ËæìÂÖ•ÊñáÂ≠ó) -->
                        <div id="voice-mode-fake">
                            <div class="setting-group">
                                <label>ËØ≠Èü≥ÂÜÖÂÆπ (ÁÇπÂáªÊ∂àÊÅØÂêéÊòæÁ§∫)</label>
                                <textarea id="voice-fake-text" placeholder="ËæìÂÖ•ËøôÊÆµËØ≠Èü≥ÂØπÂ∫îÁöÑÊñáÂ≠óÂÜÖÂÆπ..." style="height: 100px;"></textarea>
                            </div>
                            <div class="setting-group">
                                <label>ËØ≠Èü≥Êó∂Èïø: <span id="voice-fake-duration-val">3</span>Áßí</label>
                                <input type="range" id="voice-fake-duration" min="1" max="60" value="3" step="1">
                            </div>
                            <button id="send-fake-voice-btn" class="ios-btn-block" style="background-color: #07C160;">ÂèëÈÄÅ</button>
                        </div>

                        <!-- Ê®°Âºè2: ÁúüÂÆûÂΩïÈü≥ (Web Speech API) -->
                        <div id="voice-mode-real" class="hidden" style="text-align: center; padding: 20px 0;">
                            <div id="voice-recording-status" style="font-size: 18px; margin-bottom: 20px; color: #888;">ÁÇπÂáªÈ∫¶ÂÖãÈ£éÂºÄÂßãËØ¥ËØù</div>
                            <div id="voice-mic-btn" class="voice-mic-btn">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div id="voice-real-result" style="margin-top: 20px; font-style: italic; color: #333; min-height: 20px;"></div>
                            <button id="send-real-voice-btn" class="ios-btn-block" style="background-color: #07C160; margin-top: 20px;" disabled>ÂèëÈÄÅ</button>
                        </div>
                    </div>
                </div>
            </div>

</body>
</html>

</file_content>

Áé∞Âú®ÊÇ®Â∑≤ÁªèËé∑Âæó‰∫ÜÊñá‰ª∂ÁöÑÊúÄÊñ∞Áä∂ÊÄÅÔºåËØ∑‰ΩøÁî®Êõ¥Â∞ë„ÄÅÊõ¥Á≤æÁ°ÆÁöÑ SEARCH ÂùóÂÜçÊ¨°Â∞ùËØïÊìç‰Ωú„ÄÇÁâπÂà´ÊòØÂØπ‰∫éÂ§ßÂûãÊñá‰ª∂ÔºåÊòéÊô∫ÁöÑÂÅöÊ≥ïÂèØËÉΩÊòØÂ∞ùËØïÂ∞ÜËá™Â∑±ÈôêÂà∂Âú®ÊØèÊ¨°‰∏çË∂ÖËøá 5 ‰∏™ SEARCH/REPLACE ÂùóÔºåÁÑ∂ÂêéÁ≠âÂæÖÁî®Êà∑ÂØπÊìç‰ΩúÁªìÊûúÁöÑÂìçÂ∫îÔºåÁÑ∂ÂêéÂÜçËøõË°åÂè¶‰∏Ä‰∏™ replace_in_file Ë∞ÉÁî®Êù•ËøõË°åÈ¢ùÂ§ñÁöÑÁºñËæë„ÄÇ
ÔºàÂ¶ÇÊûúÊÇ®ËøûÁª≠ 3 Ê¨°ÈÅáÂà∞Ê≠§ÈîôËØØÔºåÊÇ®ÂèØ‰ª•‰ΩøÁî® write_to_file Â∑•ÂÖ∑‰Ωú‰∏∫ÂêéÂ§áÊñπÊ°à„ÄÇÔºâ
</error><environment_details>
# VSCode Visible Files
script.js
index.html

# VSCode Open Tabs
style.css
script.js
index.html

# ÂΩìÂâçÊó∂Èó¥
2026/1/24 ‰∏ãÂçà3:18:00 (Asia/Shanghai, UTC+8:00)

# ‰∏ä‰∏ãÊñáÁ™óÂè£‰ΩøÁî®
0 / 300K ‰ª§ÁâåÂ∑≤‰ΩøÁî® (0%)

# ÂΩìÂâçÊ®°Âºè
Ë°åÂä®Ê®°Âºè
</environment_details>
